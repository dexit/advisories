(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/* globals jQuery */

var enquire = require('../../bower_components/enquire/dist/enquire.js')
require('../../bower_components/jquery-accessibleMegaMenu/js/jquery-accessibleMegaMenu.js')

'use strict'

jQuery(function ($) {
  $('.email_button').click(function (e) {
    var confirm
    if (!confirm('Are you sure?')) {
      return
    }
    var data = {
      action: 'send_email',
      target: $(e.target).attr('id'),
      subject: $(e.target).data('subject'),
      body: $($(e.target).data('body')).val()
    }
    console.log(data)
    $('.email_results').removeClass('alert-danger')
    $.post('/wp-admin/admin-ajax.php', data, function (data, status, xhr) {
      $('.email_results').html(data)
      if (status !== 'success') {
        $('.email_results').addClass('alert-danger')
      }
      $('.email_results').removeClass('hidden')
    })
  })
})

jQuery(function ($) {
  $(window).scroll(function () {
    $('.header').addClass('scrolled')
  }).removeClass('scrolled')
})

jQuery(function ($) {
  enquire.register('screen and (min-width:779px)', {
    match: function () {
      // Main Nav
      $('.menu-header-menu-container').accessibleMegaMenu({
        uuidPrefix: 'accessible-nav',
        menuClass: 'nav-menu',
        topNavItemClass: 'nav-item',
        panelClass: 'sub-nav',
        panelGroupClass: 'sub-nav-group',
        hoverClass: 'hover',
        focusClass: 'focus',
        openClass: 'open'
      })
      // hack so that the megamenu doesn't show flash of css animation after the page loads.
      setTimeout(function () {
        $('body').removeClass('init')
      }, 500)
      // Change aria-hidden state
      $('#js-navigation-toggle').attr('aria-hidden', 'true')
    },
    unmatch: function () {
    }
  })
})

jQuery(function ($) {
  $('.search-form input[name=post_type]').change(function () {
    $('form#searchform').submit()
  })
})

},{"../../bower_components/enquire/dist/enquire.js":2,"../../bower_components/jquery-accessibleMegaMenu/js/jquery-accessibleMegaMenu.js":3}],2:[function(require,module,exports){
/*!
 * enquire.js v2.1.2 - Awesome Media Queries in JavaScript
 * Copyright (c) 2014 Nick Williams - http://wicky.nillia.ms/enquire.js
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */

;(function (name, context, factory) {
	var matchMedia = window.matchMedia;

	if (typeof module !== 'undefined' && module.exports) {
		module.exports = factory(matchMedia);
	}
	else if (typeof define === 'function' && define.amd) {
		define(function() {
			return (context[name] = factory(matchMedia));
		});
	}
	else {
		context[name] = factory(matchMedia);
	}
}('enquire', this, function (matchMedia) {

	'use strict';

    /*jshint unused:false */
    /**
     * Helper function for iterating over a collection
     *
     * @param collection
     * @param fn
     */
    function each(collection, fn) {
        var i      = 0,
            length = collection.length,
            cont;

        for(i; i < length; i++) {
            cont = fn(collection[i], i);
            if(cont === false) {
                break; //allow early exit
            }
        }
    }

    /**
     * Helper function for determining whether target object is an array
     *
     * @param target the object under test
     * @return {Boolean} true if array, false otherwise
     */
    function isArray(target) {
        return Object.prototype.toString.apply(target) === '[object Array]';
    }

    /**
     * Helper function for determining whether target object is a function
     *
     * @param target the object under test
     * @return {Boolean} true if function, false otherwise
     */
    function isFunction(target) {
        return typeof target === 'function';
    }

    /**
     * Delegate to handle a media query being matched and unmatched.
     *
     * @param {object} options
     * @param {function} options.match callback for when the media query is matched
     * @param {function} [options.unmatch] callback for when the media query is unmatched
     * @param {function} [options.setup] one-time callback triggered the first time a query is matched
     * @param {boolean} [options.deferSetup=false] should the setup callback be run immediately, rather than first time query is matched?
     * @constructor
     */
    function QueryHandler(options) {
        this.options = options;
        !options.deferSetup && this.setup();
    }
    QueryHandler.prototype = {

        /**
         * coordinates setup of the handler
         *
         * @function
         */
        setup : function() {
            if(this.options.setup) {
                this.options.setup();
            }
            this.initialised = true;
        },

        /**
         * coordinates setup and triggering of the handler
         *
         * @function
         */
        on : function() {
            !this.initialised && this.setup();
            this.options.match && this.options.match();
        },

        /**
         * coordinates the unmatch event for the handler
         *
         * @function
         */
        off : function() {
            this.options.unmatch && this.options.unmatch();
        },

        /**
         * called when a handler is to be destroyed.
         * delegates to the destroy or unmatch callbacks, depending on availability.
         *
         * @function
         */
        destroy : function() {
            this.options.destroy ? this.options.destroy() : this.off();
        },

        /**
         * determines equality by reference.
         * if object is supplied compare options, if function, compare match callback
         *
         * @function
         * @param {object || function} [target] the target for comparison
         */
        equals : function(target) {
            return this.options === target || this.options.match === target;
        }

    };
    /**
     * Represents a single media query, manages it's state and registered handlers for this query
     *
     * @constructor
     * @param {string} query the media query string
     * @param {boolean} [isUnconditional=false] whether the media query should run regardless of whether the conditions are met. Primarily for helping older browsers deal with mobile-first design
     */
    function MediaQuery(query, isUnconditional) {
        this.query = query;
        this.isUnconditional = isUnconditional;
        this.handlers = [];
        this.mql = matchMedia(query);

        var self = this;
        this.listener = function(mql) {
            self.mql = mql;
            self.assess();
        };
        this.mql.addListener(this.listener);
    }
    MediaQuery.prototype = {

        /**
         * add a handler for this query, triggering if already active
         *
         * @param {object} handler
         * @param {function} handler.match callback for when query is activated
         * @param {function} [handler.unmatch] callback for when query is deactivated
         * @param {function} [handler.setup] callback for immediate execution when a query handler is registered
         * @param {boolean} [handler.deferSetup=false] should the setup callback be deferred until the first time the handler is matched?
         */
        addHandler : function(handler) {
            var qh = new QueryHandler(handler);
            this.handlers.push(qh);

            this.matches() && qh.on();
        },

        /**
         * removes the given handler from the collection, and calls it's destroy methods
         * 
         * @param {object || function} handler the handler to remove
         */
        removeHandler : function(handler) {
            var handlers = this.handlers;
            each(handlers, function(h, i) {
                if(h.equals(handler)) {
                    h.destroy();
                    return !handlers.splice(i,1); //remove from array and exit each early
                }
            });
        },

        /**
         * Determine whether the media query should be considered a match
         * 
         * @return {Boolean} true if media query can be considered a match, false otherwise
         */
        matches : function() {
            return this.mql.matches || this.isUnconditional;
        },

        /**
         * Clears all handlers and unbinds events
         */
        clear : function() {
            each(this.handlers, function(handler) {
                handler.destroy();
            });
            this.mql.removeListener(this.listener);
            this.handlers.length = 0; //clear array
        },

        /*
         * Assesses the query, turning on all handlers if it matches, turning them off if it doesn't match
         */
        assess : function() {
            var action = this.matches() ? 'on' : 'off';

            each(this.handlers, function(handler) {
                handler[action]();
            });
        }
    };
    /**
     * Allows for registration of query handlers.
     * Manages the query handler's state and is responsible for wiring up browser events
     *
     * @constructor
     */
    function MediaQueryDispatch () {
        if(!matchMedia) {
            throw new Error('matchMedia not present, legacy browsers require a polyfill');
        }

        this.queries = {};
        this.browserIsIncapable = !matchMedia('only all').matches;
    }

    MediaQueryDispatch.prototype = {

        /**
         * Registers a handler for the given media query
         *
         * @param {string} q the media query
         * @param {object || Array || Function} options either a single query handler object, a function, or an array of query handlers
         * @param {function} options.match fired when query matched
         * @param {function} [options.unmatch] fired when a query is no longer matched
         * @param {function} [options.setup] fired when handler first triggered
         * @param {boolean} [options.deferSetup=false] whether setup should be run immediately or deferred until query is first matched
         * @param {boolean} [shouldDegrade=false] whether this particular media query should always run on incapable browsers
         */
        register : function(q, options, shouldDegrade) {
            var queries         = this.queries,
                isUnconditional = shouldDegrade && this.browserIsIncapable;

            if(!queries[q]) {
                queries[q] = new MediaQuery(q, isUnconditional);
            }

            //normalise to object in an array
            if(isFunction(options)) {
                options = { match : options };
            }
            if(!isArray(options)) {
                options = [options];
            }
            each(options, function(handler) {
                if (isFunction(handler)) {
                    handler = { match : handler };
                }
                queries[q].addHandler(handler);
            });

            return this;
        },

        /**
         * unregisters a query and all it's handlers, or a specific handler for a query
         *
         * @param {string} q the media query to target
         * @param {object || function} [handler] specific handler to unregister
         */
        unregister : function(q, handler) {
            var query = this.queries[q];

            if(query) {
                if(handler) {
                    query.removeHandler(handler);
                }
                else {
                    query.clear();
                    delete this.queries[q];
                }
            }

            return this;
        }
    };

	return new MediaQueryDispatch();

}));
},{}],3:[function(require,module,exports){
/*
Copyright © 2013 Adobe Systems Incorporated.

Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

/**
 * See <a href="http://jquery.com">http://jquery.com</a>.
 * @name jquery
 * @class
 * See the jQuery Library  (<a href="http://jquery.com">http://jquery.com</a>) for full details.  This just
 * documents the function and classes that are added to jQuery by this plug-in.
 */

/**
 * See <a href="http://jquery.com">http://jquery.com</a>
 * @name fn
 * @class
 * See the jQuery Library  (<a href="http://jquery.com">http://jquery.com</a>) for full details.  This just
 * documents the function and classes that are added to jQuery by this plug-in.
 * @memberOf jquery
 */

/**
 * @fileOverview accessibleMegaMenu plugin
 *
 *<p>Licensed under the Apache License, Version 2.0 (the “License”)
 *<br />Copyright © 2013 Adobe Systems Incorporated.
 *<br />Project page <a href="https://github.com/adobe-accessibility/Accessible-Mega-Menu">https://github.com/adobe-accessibility/Accessible-Mega-Menu</a>
 * @version 0.1
 * @author Michael Jordan
 * @requires jquery
 */

/*jslint browser: true, devel: true, plusplus: true, nomen: true */
/*global jQuery */
(function ($, window, document) {
    "use strict";
    var pluginName = "accessibleMegaMenu",
        defaults = {
            uuidPrefix: "accessible-megamenu", // unique ID's are required to indicate aria-owns, aria-controls and aria-labelledby
            menuClass: "accessible-megamenu", // default css class used to define the megamenu styling
            topNavItemClass: "accessible-megamenu-top-nav-item", // default css class for a top-level navigation item in the megamenu
            panelClass: "accessible-megamenu-panel", // default css class for a megamenu panel
            panelGroupClass: "accessible-megamenu-panel-group", // default css class for a group of items within a megamenu panel
            hoverClass: "hover", // default css class for the hover state
            focusClass: "focus", // default css class for the focus state
            openClass: "open" // default css class for the open state
        },
        Keyboard = {
            BACKSPACE: 8,
            COMMA: 188,
            DELETE: 46,
            DOWN: 40,
            END: 35,
            ENTER: 13,
            ESCAPE: 27,
            HOME: 36,
            LEFT: 37,
            PAGE_DOWN: 34,
            PAGE_UP: 33,
            PERIOD: 190,
            RIGHT: 39,
            SPACE: 32,
            TAB: 9,
            UP: 38,
            keyMap: {
                48: "0",
                49: "1",
                50: "2",
                51: "3",
                52: "4",
                53: "5",
                54: "6",
                55: "7",
                56: "8",
                57: "9",
                59: ";",
                65: "a",
                66: "b",
                67: "c",
                68: "d",
                69: "e",
                70: "f",
                71: "g",
                72: "h",
                73: "i",
                74: "j",
                75: "k",
                76: "l",
                77: "m",
                78: "n",
                79: "o",
                80: "p",
                81: "q",
                82: "r",
                83: "s",
                84: "t",
                85: "u",
                86: "v",
                87: "w",
                88: "x",
                89: "y",
                90: "z",
                96: "0",
                97: "1",
                98: "2",
                99: "3",
                100: "4",
                101: "5",
                102: "6",
                103: "7",
                104: "8",
                105: "9",
                190: "."
            }
        };
    /**
     * @desc Creates a new accessible mega menu instance.
     * @param {jquery} element
     * @param {object} [options] Mega Menu options
     * @param {string} [options.uuidPrefix=accessible-megamenu] - Prefix for generated unique id attributes, which are required to indicate aria-owns, aria-controls and aria-labelledby
     * @param {string} [options.menuClass=accessible-megamenu] - CSS class used to define the megamenu styling
     * @param {string} [options.topNavItemClass=accessible-megamenu-top-nav-item] - CSS class for a top-level navigation item in the megamenu
     * @param {string} [options.panelClass=accessible-megamenu-panel] - CSS class for a megamenu panel
     * @param {string} [options.panelGroupClass=accessible-megamenu-panel-group] - CSS class for a group of items within a megamenu panel
     * @param {string} [options.hoverClass=hover] - CSS class for the hover state
     * @param {string} [options.focusClass=focus] - CSS class for the focus state
     * @param {string} [options.openClass=open] - CSS class for the open state
     * @constructor
     */
    function AccessibleMegaMenu(element, options) {
        this.element = element;

        // merge optional settings and defaults into settings
        this.settings = $.extend({}, defaults, options);

        this._defaults = defaults;
        this._name = pluginName;

        this.mouseTimeoutID = null;
        this.focusTimeoutID = null;
        this.mouseFocused = false;
        this.justFocused = false;

        this.init();
    }

    AccessibleMegaMenu.prototype = (function () {

        /* private attributes and methods ------------------------ */
        var uuid = 0,
            keydownTimeoutDuration = 1000,
            keydownSearchString = "",
            isTouch = typeof window.hasOwnProperty === "function" && !!window.hasOwnProperty("ontouchstart"),
            _getPlugin,
            _addUniqueId,
            _togglePanel,
            _clickHandler,
            _clickOutsideHandler,
            _DOMAttrModifiedHandler,
            _focusInHandler,
            _focusOutHandler,
            _keyDownHandler,
            _mouseDownHandler,
            _mouseOverHandler,
            _mouseOutHandler,
            _toggleExpandedEventHandlers;

        /**
         * @name jQuery.fn.accessibleMegaMenu~_getPlugin
         * @desc Returns the parent accessibleMegaMenu instance for a given element
         * @param {jQuery} element
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _getPlugin = function (element) {
            return $(element).closest(':data(plugin_' + pluginName + ')').data("plugin_" + pluginName);
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_addUniqueId
         * @desc Adds a unique id and element.
         * The id string starts with the
         * string defined in settings.uuidPrefix.
         * @param {jQuery} element
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _addUniqueId = function (element) {
            element = $(element);
            var settings = this.settings;
            if (!element.attr("id")) {
                element.attr("id", settings.uuidPrefix + "-" + new Date().getTime() + "-" + (++uuid));
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_togglePanel
         * @desc Toggle the display of mega menu panels in response to an event.
         * The optional boolean value 'hide' forces all panels to hide.
         * @param {event} event
         * @param {Boolean} [hide] Hide all mega menu panels when true
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _togglePanel = function (event, hide) {
            var target = $(event.target),
                that = this,
                settings = this.settings,
                menu = this.menu,
                topli = target.closest('.' + settings.topNavItemClass),
                panel = target.hasClass(settings.panelClass) ? target : target.closest('.' + settings.panelClass),
                newfocus;

            _toggleExpandedEventHandlers.call(this, true);

            if (hide) {
                topli = menu.find('.' + settings.topNavItemClass + ' .' + settings.openClass + ':first').closest('.' + settings.topNavItemClass);
                if (!(topli.is(event.relatedTarget) || topli.has(event.relatedTarget).length > 0)) {
                    if ((event.type === 'mouseout' || event.type === 'focusout') && topli.has(document.activeElement).length > 0) {
                        return;
                    }
                    topli.find('[aria-expanded]')
                        .attr('aria-expanded', 'false')
                        .removeClass(settings.openClass)
                        .filter('.' + settings.panelClass)
                        .attr('aria-hidden', 'true');
                    if ((event.type === 'keydown' && event.keyCode === Keyboard.ESCAPE) || event.type === 'DOMAttrModified') {
                        newfocus = topli.find(':tabbable:first');
                        setTimeout(function () {
                            menu.find('[aria-expanded].' + that.settings.panelClass).off('DOMAttrModified.accessible-megamenu');
                            newfocus.focus();
                            that.justFocused = false;
                        }, 99);
                    }
                } else if (topli.length === 0) {
                    menu.find('[aria-expanded=true]')
                        .attr('aria-expanded', 'false')
                        .removeClass(settings.openClass)
                        .filter('.' + settings.panelClass)
                        .attr('aria-hidden', 'true');
                }
            } else {
                clearTimeout(that.focusTimeoutID);
                topli.siblings()
                    .find('[aria-expanded]')
                    .attr('aria-expanded', 'false')
                    .removeClass(settings.openClass)
                    .filter('.' + settings.panelClass)
                    .attr('aria-hidden', 'true');
                topli.find('[aria-expanded]')
                    .attr('aria-expanded', 'true')
                    .addClass(settings.openClass)
                    .filter('.' + settings.panelClass)
                    .attr('aria-hidden', 'false');
                if (event.type === 'mouseover' && target.is(':tabbable') && topli.length === 1 && panel.length === 0 && menu.has(document.activeElement).length > 0) {
                    target.focus();
                    that.justFocused = false;
                }

                _toggleExpandedEventHandlers.call(that);
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_clickHandler
         * @desc Handle click event on mega menu item
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _clickHandler = function (event) {
            var target = $(event.currentTarget),
                topli = target.closest('.' + this.settings.topNavItemClass),
                panel = target.closest('.' + this.settings.panelClass);
            if (topli.length === 1
                    && panel.length === 0
                    && topli.find('.' + this.settings.panelClass).length === 1) {
                if (!target.hasClass(this.settings.openClass)) {
                    event.preventDefault();
                    event.stopPropagation();
                    _togglePanel.call(this, event);
                    this.justFocused = false;
                } else {
                    if (this.justFocused) {
                        event.preventDefault();
                        event.stopPropagation();
                        this.justFocused = false;
                    } else if (isTouch) {
                        event.preventDefault();
                        event.stopPropagation();
                        _togglePanel.call(this, event, target.hasClass(this.settings.openClass));
                    }
                }
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_clickOutsideHandler
         * @desc Handle click event outside of a the megamenu
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _clickOutsideHandler = function (event) {
            if ($(event.target).closest(this.menu).length === 0) {
                event.preventDefault();
                event.stopPropagation();
                _togglePanel.call(this, event, true);
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_DOMAttrModifiedHandler
         * @desc Handle DOMAttrModified event on panel to respond to Windows 8 Narrator ExpandCollapse pattern
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _DOMAttrModifiedHandler = function (event) {
            if (event.originalEvent.attrName === 'aria-expanded'
                    && event.originalEvent.newValue === 'false'
                    && $(event.target).hasClass(this.settings.openClass)) {
                event.preventDefault();
                event.stopPropagation();
                _togglePanel.call(this, event, true);
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_focusInHandler
         * @desc Handle focusin event on mega menu item.
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _focusInHandler = function (event) {
            clearTimeout(this.focusTimeoutID);
            var target = $(event.target),
                panel = target.closest('.' + this.settings.panelClass);
            target
                .addClass(this.settings.focusClass)
                .on('click.accessible-megamenu', $.proxy(_clickHandler, this));
            this.justFocused = !this.mouseFocused;
            this.mouseFocused = false;
            if (this.panels.not(panel).filter('.' + this.settings.openClass).length) {
                _togglePanel.call(this, event);
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_focusOutHandler
         * @desc Handle focusout event on mega menu item.
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _focusOutHandler = function (event) {
            this.justFocused = false;
            var that = this,
                target = $(event.target),
                topli = target.closest('.' + this.settings.topNavItemClass),
                keepOpen = false;
            target
                .removeClass(this.settings.focusClass)
                .off('click.accessible-megamenu');

            if (window.cvox) {
                // If ChromeVox is running...
                that.focusTimeoutID = setTimeout(function () {
                    window.cvox.Api.getCurrentNode(function (node) {
                        if (topli.has(node).length) {
                            // and the current node being voiced is in
                            // the mega menu, clearTimeout,
                            // so the panel stays open.
                            clearTimeout(that.focusTimeoutID);
                        } else {
                            that.focusTimeoutID = setTimeout(function (scope, event, hide) {
                                _togglePanel.call(scope, event, hide);
                            }, 275, that, event, true);
                        }
                    });
                }, 25);
            } else {
                that.focusTimeoutID = setTimeout(function () {
                    _togglePanel.call(that, event, true);
                }, 300);
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_keyDownHandler
         * @desc Handle keydown event on mega menu.
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _keyDownHandler = function (event) {
            var that = (this.constructor === AccessibleMegaMenu) ? this : _getPlugin(this), // determine the AccessibleMegaMenu plugin instance
                settings = that.settings,
                target = $($(this).is('.' + settings.hoverClass + ':tabbable') ? this : event.target), // if the element is hovered the target is this, otherwise, its the focused element
                menu = that.menu,
                topnavitems = that.topnavitems,
                topli = target.closest('.' + settings.topNavItemClass),
                tabbables = menu.find(':tabbable'),
                panel = target.hasClass(settings.panelClass) ? target : target.closest('.' + settings.panelClass),
                panelGroups = panel.find('.' + settings.panelGroupClass),
                currentPanelGroup = target.closest('.' + settings.panelGroupClass),
                next,
                keycode = event.keyCode || event.which,
                start,
                i,
                o,
                label,
                found = false,
                newString = Keyboard.keyMap[event.keyCode] || '',
                regex,
                isTopNavItem = (topli.length === 1 && panel.length === 0);

            if (target.is("input:focus, select:focus, textarea:focus, button:focus")) {
                // if the event target is a form element we should handle keydown normally
                return;
            }

            if (target.is('.' + settings.hoverClass + ':tabbable')) {
                $('html').off('keydown.accessible-megamenu');
            }

            switch (keycode) {
            case Keyboard.ESCAPE:
                _togglePanel.call(that, event, true);
                break;
            case Keyboard.DOWN:
                event.preventDefault();
                if (isTopNavItem) {
                    _togglePanel.call(that, event);
                    found = (topli.find('.' + settings.panelClass + ' :tabbable:first').focus().length === 1);
                } else {
                    found = (tabbables.filter(':gt(' + tabbables.index(target) + '):first').focus().length === 1);
                }

                if (!found && window.opera && opera.toString() === "[object Opera]" && (event.ctrlKey || event.metaKey)) {
                    tabbables = $(':tabbable');
                    i = tabbables.index(target);
                    found = ($(':tabbable:gt(' + $(':tabbable').index(target) + '):first').focus().length === 1);
                }
                break;
            case Keyboard.UP:
                event.preventDefault();
                if (isTopNavItem && target.hasClass(settings.openClass)) {
                    _togglePanel.call(that, event, true);
                    next = topnavitems.filter(':lt(' + topnavitems.index(topli) + '):last');
                    if (next.children('.' + settings.panelClass).length) {
                        found = (next.children()
                            .attr('aria-expanded', 'true')
                            .addClass(settings.openClass)
                            .filter('.' + settings.panelClass)
                            .attr('aria-hidden', 'false')
                            .find(':tabbable:last')
                            .focus() === 1);
                    }
                } else if (!isTopNavItem) {
                    found = (tabbables.filter(':lt(' + tabbables.index(target) + '):last').focus().length === 1);
                }

                if (!found && window.opera && opera.toString() === "[object Opera]" && (event.ctrlKey || event.metaKey)) {
                    tabbables = $(':tabbable');
                    i = tabbables.index(target);
                    found = ($(':tabbable:lt(' + $(':tabbable').index(target) + '):first').focus().length === 1);
                }
                break;
            case Keyboard.RIGHT:
                event.preventDefault();
                if (isTopNavItem) {
                    found = (topnavitems.filter(':gt(' + topnavitems.index(topli) + '):first').find(':tabbable:first').focus().length === 1);
                } else {
                    if (panelGroups.length && currentPanelGroup.length) {
                        // if the current panel contains panel groups, and we are able to focus the first tabbable element of the next panel group
                        found = (panelGroups.filter(':gt(' + panelGroups.index(currentPanelGroup) + '):first').find(':tabbable:first').focus().length === 1);
                    }

                    if (!found) {
                        found = (topli.find(':tabbable:first').focus().length === 1);
                    }
                }
                break;
            case Keyboard.LEFT:
                event.preventDefault();
                if (isTopNavItem) {
                    found = (topnavitems.filter(':lt(' + topnavitems.index(topli) + '):last').find(':tabbable:first').focus().length === 1);
                } else {
                    if (panelGroups.length && currentPanelGroup.length) {
                        // if the current panel contains panel groups, and we are able to focus the first tabbable element of the previous panel group
                        found = (panelGroups.filter(':lt(' + panelGroups.index(currentPanelGroup) + '):last').find(':tabbable:first').focus().length === 1);
                    }

                    if (!found) {
                        found = (topli.find(':tabbable:first').focus().length === 1);
                    }
                }
                break;
            case Keyboard.TAB:
                i = tabbables.index(target);
                if (event.shiftKey && isTopNavItem && target.hasClass(settings.openClass)) {
                    _togglePanel.call(that, event, true);
                    next = topnavitems.filter(':lt(' + topnavitems.index(topli) + '):last');
                    if (next.children('.' + settings.panelClass).length) {
                        found = next.children()
                            .attr('aria-expanded', 'true')
                            .addClass(settings.openClass)
                            .filter('.' + settings.panelClass)
                            .attr('aria-hidden', 'false')
                            .find(':tabbable:last')
                            .focus();
                    }
                } else if (event.shiftKey && i > 0) {
                    found = (tabbables.filter(':lt(' + i + '):last').focus().length === 1);
                } else if (!event.shiftKey && i < tabbables.length - 1) {
                    found = (tabbables.filter(':gt(' + i + '):first').focus().length === 1);
                } else if (window.opera && opera.toString() === "[object Opera]") {
                    tabbables = $(':tabbable');
                    i = tabbables.index(target);
                    if (event.shiftKey) {
                        found = ($(':tabbable:lt(' + $(':tabbable').index(target) + '):last').focus().length === 1);
                    } else {
                        found = ($(':tabbable:gt(' + $(':tabbable').index(target) + '):first').focus().length === 1);
                    }
                }

                if (found) {
                    event.preventDefault();
                }
                break;
            case Keyboard.SPACE:
                if (isTopNavItem) {
                    event.preventDefault();
                    _clickHandler.call(that, event);
                } else {
                    return true;
                }
                break;
            case Keyboard.ENTER:
                return true;
                break;
            default:
                // alphanumeric filter
                clearTimeout(this.keydownTimeoutID);

                keydownSearchString += newString !== keydownSearchString ? newString : '';

                if (keydownSearchString.length === 0) {
                    return;
                }

                this.keydownTimeoutID = setTimeout(function () {
                    keydownSearchString = '';
                }, keydownTimeoutDuration);

                if (isTopNavItem && !target.hasClass(settings.openClass)) {
                    tabbables = tabbables.filter(':not(.' + settings.panelClass + ' :tabbable)');
                } else {
                    tabbables = topli.find(':tabbable');
                }

                if (event.shiftKey) {
                    tabbables = $(tabbables.get()
                        .reverse());
                }

                for (i = 0; i < tabbables.length; i++) {
                    o = tabbables.eq(i);
                    if (o.is(target)) {
                        start = (keydownSearchString.length === 1) ? i + 1 : i;
                        break;
                    }
                }

                regex = new RegExp('^' + keydownSearchString.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&'), 'i');

                for (i = start; i < tabbables.length; i++) {
                    o = tabbables.eq(i);
                    label = $.trim(o.text());
                    if (regex.test(label)) {
                        found = true;
                        o.focus();
                        break;
                    }
                }
                if (!found) {
                    for (i = 0; i < start; i++) {
                        o = tabbables.eq(i);
                        label = $.trim(o.text());
                        if (regex.test(label)) {
                            o.focus();
                            break;
                        }
                    }
                }
                break;
            }
            that.justFocused = false;
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_mouseDownHandler
         * @desc Handle mousedown event on mega menu.
         * @param {event} Event object
         * @memberof accessibleMegaMenu
         * @inner
         * @private
         */
        _mouseDownHandler = function (event) {
            if ($(event.target).is(this.settings.panelClass) || $(event.target).closest(":focusable").length) {
                this.mouseFocused = true;
            }
            this.mouseTimeoutID = setTimeout(function () {
                clearTimeout(this.focusTimeoutID);
            }, 1);
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_mouseOverHandler
         * @desc Handle mouseover event on mega menu.
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _mouseOverHandler = function (event) {
            clearTimeout(this.mouseTimeoutID);
            $(event.target)
                .addClass(this.settings.hoverClass);
            _togglePanel.call(this, event);
            if ($(event.target).is(':tabbable')) {
                $('html').on('keydown.accessible-megamenu', $.proxy(_keyDownHandler, event.target));
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_mouseOutHandler
         * @desc Handle mouseout event on mega menu.
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _mouseOutHandler = function (event) {
            var that = this;
            $(event.target)
                .removeClass(that.settings.hoverClass);

            that.mouseTimeoutID = setTimeout(function () {
                _togglePanel.call(that, event, true);
            }, 250);
            if ($(event.target).is(':tabbable')) {
                $('html').off('keydown.accessible-megamenu');
            }
        };

        _toggleExpandedEventHandlers = function (hide) {
            var menu = this.menu;
            if (hide) {
                $('html').off('mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu');

                menu.find('[aria-expanded].' + this.settings.panelClass).off('DOMAttrModified.accessible-megamenu');
            } else {
                $('html').on('mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu', $.proxy(_clickOutsideHandler, this));

                /* Narrator in Windows 8 automatically toggles the aria-expanded property on double tap or click.
                   To respond to the change to collapse the panel, we must add a listener for a DOMAttrModified event. */
                menu.find('[aria-expanded=true].' + this.settings.panelClass).on('DOMAttrModified.accessible-megamenu', $.proxy(_DOMAttrModifiedHandler, this));
            }
        };

        /* public attributes and methods ------------------------- */
        return {
            constructor: AccessibleMegaMenu,

            /**
             * @lends jQuery.fn.accessibleMegaMenu
             * @desc Initializes an instance of the accessibleMegaMenu plugins
             * @memberof jQuery.fn.accessibleMegaMenu
             * @instance
             */
            init: function () {
                var settings = this.settings,
                    nav = $(this.element),
                    menu = nav.children().first(),
                    topnavitems = menu.children();
                this.start(settings, nav, menu, topnavitems);
            },

            start: function(settings, nav, menu, topnavitems) {
                var that = this;
                this.settings = settings;
                this.menu = menu;
                this.topnavitems = topnavitems;

                nav.attr("role", "navigation");
                menu.addClass(settings.menuClass);
                topnavitems.each(function (i, topnavitem) {
                    var topnavitemlink, topnavitempanel;
                    topnavitem = $(topnavitem);
                    topnavitem.addClass(settings.topNavItemClass);
                    topnavitemlink = topnavitem.find(":tabbable:first");
                    topnavitempanel = topnavitem.children(":not(:tabbable):last");
                    _addUniqueId.call(that, topnavitemlink);
                    if (topnavitempanel.length) {
                        _addUniqueId.call(that, topnavitempanel);
                        topnavitemlink.attr({
                            "aria-haspopup": true,
                            "aria-controls": topnavitempanel.attr("id"),
                            "aria-expanded": false
                        });

                        topnavitempanel.attr({
                            "role": "group",
                            "aria-expanded": false,
                            "aria-hidden": true
                        })
                            .addClass(settings.panelClass)
                            .not("[aria-labelledby]")
                            .attr("aria-labelledby", topnavitemlink.attr("id"));
                    }
                });

                this.panels = menu.find("." + settings.panelClass);

                menu.on("focusin.accessible-megamenu", ":focusable, ." + settings.panelClass, $.proxy(_focusInHandler, this))
                    .on("focusout.accessible-megamenu", ":focusable, ." + settings.panelClass, $.proxy(_focusOutHandler, this))
                    .on("keydown.accessible-megamenu", $.proxy(_keyDownHandler, this))
                    .on("mouseover.accessible-megamenu", $.proxy(_mouseOverHandler, this))
                    .on("mouseout.accessible-megamenu", $.proxy(_mouseOutHandler, this))
                    .on("mousedown.accessible-megamenu", $.proxy(_mouseDownHandler, this));

                if (isTouch) {
                    menu.on("touchstart.accessible-megamenu",  $.proxy(_clickHandler, this));
                }

                menu.find("hr").attr("role", "separator");

                if ($(document.activeElement).closest(menu).length) {
                  $(document.activeElement).trigger("focusin.accessible-megamenu");
                }
            },

            /**
             * @desc Get default values
             * @example $(selector).accessibleMegaMenu("getDefaults");
             * @return {object}
             * @memberof jQuery.fn.accessibleMegaMenu
             * @instance
             */
            getDefaults: function () {
                return this._defaults;
            },

            /**
             * @desc Get any option set to plugin using its name (as string)
             * @example $(selector).accessibleMegaMenu("getOption", some_option);
             * @param {string} opt
             * @return {string}
             * @memberof jQuery.fn.accessibleMegaMenu
             * @instance
             */
            getOption: function (opt) {
                return this.settings[opt];
            },

            /**
             * @desc Get all options
             * @example $(selector).accessibleMegaMenu("getAllOptions");
             * @return {object}
             * @memberof jQuery.fn.accessibleMegaMenu
             * @instance
             */
            getAllOptions: function () {
                return this.settings;
            },

            /**
             * @desc Set option
             * @example $(selector).accessibleMegaMenu("setOption", "option_name",  "option_value",  reinitialize);
             * @param {string} opt - Option name
             * @param {string} val - Option value
             * @param {boolean} [reinitialize] - boolean to re-initialize the menu.
             * @memberof jQuery.fn.accessibleMegaMenu
             * @instance
             */
            setOption: function (opt, value, reinitialize) {
                this.settings[opt] = value;
                if (reinitialize) {
                    this.init();
                }
            }
        };
    }());

    /* lightweight plugin wrapper around the constructor,
       to prevent against multiple instantiations */

    /**
     * @class accessibleMegaMenu
     * @memberOf jQuery.fn
     * @classdesc Implements an accessible mega menu as a jQuery plugin.
     * <p>The mega-menu It is modeled after the mega menu on {@link http://adobe.com|adobe.com} but has been simplified for use by others. A brief description of the interaction design choices can be found in a blog post at {@link http://blogs.adobe.com/accessibility/2013/05/adobe-com.html|Mega menu accessibility on adobe.com}.</p>
     * <h3>Keyboard Accessibility</h3>
     * <p>The accessible mega menu supports keyboard interaction modeled after the behavior described in the {@link http://www.w3.org/TR/wai-aria-practices/#menu|WAI-ARIA Menu or Menu bar (widget) design pattern}, however we also try to respect users' general expectations for the behavior of links in a global navigation. To this end, the accessible mega menu implementation permits tab focus on each of the six top-level menu items. When one of the menu items has focus, pressing the Enter key, Spacebar or Down arrow will open the submenu panel, and pressing the Left or Right arrow key will shift focus to the adjacent menu item. Links within the submenu panels are included in the tab order when the panel is open. They can also be navigated with the arrow keys or by typing the first character in the link name, which speeds up keyboard navigation considerably. Pressing the Escape key closes the submenu and restores focus to the parent menu item.</p>
     * <h3>Screen Reader Accessibility</h3>
     * <p>The accessible mega menu models its use of WAI-ARIA Roles, States, and Properties after those described in the {@link http://www.w3.org/TR/wai-aria-practices/#menu|WAI-ARIA Menu or Menu bar (widget) design pattern} with some notable exceptions, so that it behaves better with screen reader user expectations for global navigation. We don't use <code class="prettyprint prettyprinted" style=""><span class="pln">role</span><span class="pun">=</span><span class="str">"menu"</span></code> for the menu container and <code class="prettyprint prettyprinted" style=""><span class="pln">role</span><span class="pun">=</span><span class="str">"menuitem"</span></code> for each of the links therein, because if we do, assistive technology will no longer interpret the links as links, but instead, as menu items, and the links in our global navigation will no longer show up when a screen reader user executes a shortcut command to bring up a list of links in the page.</p>
     * @example <h4>HTML</h4><hr/>
&lt;nav&gt;
    &lt;ul class=&quot;nav-menu&quot;&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
            &lt;a href=&quot;?movie&quot;&gt;Movies&lt;/a&gt;
            &lt;div class=&quot;sub-nav&quot;&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=0&quot;&gt;Action &amp;amp; Adventure&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=2&quot;&gt;Children &amp;amp; Family&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=7&quot;&gt;Dramas&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=9&quot;&gt;Foreign&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=14&quot;&gt;Musicals&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=15&quot;&gt;Romance&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
            &lt;a href=&quot;?tv&quot;&gt;TV Shows&lt;/a&gt;
            &lt;div class=&quot;sub-nav&quot;&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=20&quot;&gt;Classic TV&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=21&quot;&gt;Crime TV&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=27&quot;&gt;Reality TV&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=30&quot;&gt;TV Action&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=33&quot;&gt;TV Dramas&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=34&quot;&gt;TV Horror&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;/nav&gt;
     * @example <h4>CSS</h4><hr/>
&#47;* Rudimentary mega menu CSS for demonstration *&#47;

&#47;* mega menu list *&#47;
.nav-menu {
    display: block;
    position: relative;
    list-style: none;
    margin: 0;
    padding: 0;
    z-index: 15;
}

&#47;* a top level navigation item in the mega menu *&#47;
.nav-item {
    list-style: none;
    display: inline-block;
    padding: 0;
    margin: 0;
}

&#47;* first descendant link within a top level navigation item *&#47;
.nav-item &gt; a {
    position: relative;
    display: inline-block;
    padding: 0.5em 1em;
    margin: 0 0 -1px 0;
    border: 1px solid transparent;
}

&#47;* focus/open states of first descendant link within a top level
   navigation item *&#47;
.nav-item &gt; a:focus,
.nav-item &gt; a.open {
    border: 1px solid #dedede;
}

&#47;* open state of first descendant link within a top level
   navigation item *&#47;
.nav-item &gt; a.open {
    background-color: #fff;
    border-bottom: none;
    z-index: 1;
}

&#47;* sub-navigation panel *&#47;
.sub-nav {
    position: absolute;
    display: none;
    top: 2.2em;
    margin-top: -1px;
    padding: 0.5em 1em;
    border: 1px solid #dedede;
    background-color: #fff;
}

&#47;* sub-navigation panel open state *&#47;
.sub-nav.open {
    display: block;
}

&#47;* list of items within sub-navigation panel *&#47;
.sub-nav ul {
    display: inline-block;
    vertical-align: top;
    margin: 0 1em 0 0;
    padding: 0;
}

&#47;* list item within sub-navigation panel *&#47;
.sub-nav li {
    display: block;
    list-style-type: none;
    margin: 0;
    padding: 0;
}
     * @example <h4>JavaScript</h4><hr/>
&lt;!-- include jquery --&gt;
&lt;script src=&quot;http://code.jquery.com/jquery-1.10.1.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- include the jquery-accessibleMegaMenu plugin script --&gt;
&lt;script src=&quot;js/jquery-accessibleMegaMenu.js&quot;&gt;&lt;/script&gt;

&lt;!-- initialize a selector as an accessibleMegaMenu --&gt;
&lt;script&gt;
    $(&quot;nav:first&quot;).accessibleMegaMenu({
        &#47;* prefix for generated unique id attributes, which are required to indicate aria-owns, aria-controls and aria-labelledby *&#47;
        uuidPrefix: &quot;accessible-megamenu&quot;,

        &#47;* css class used to define the megamenu styling *&#47;
        menuClass: &quot;nav-menu&quot;,

        &#47;* css class for a top-level navigation item in the megamenu *&#47;
        topNavItemClass: &quot;nav-item&quot;,

        &#47;* css class for a megamenu panel *&#47;
        panelClass: &quot;sub-nav&quot;,

        &#47;* css class for a group of items within a megamenu panel *&#47;
        panelGroupClass: &quot;sub-nav-group&quot;,

        &#47;* css class for the hover state *&#47;
        hoverClass: &quot;hover&quot;,

        &#47;* css class for the focus state *&#47;
        focusClass: &quot;focus&quot;,

        &#47;* css class for the open state *&#47;
        openClass: &quot;open&quot;
    });
&lt;/script&gt;
     * @param {object} [options] Mega Menu options
     * @param {string} [options.uuidPrefix=accessible-megamenu] - Prefix for generated unique id attributes, which are required to indicate aria-owns, aria-controls and aria-labelledby
     * @param {string} [options.menuClass=accessible-megamenu] - CSS class used to define the megamenu styling
     * @param {string} [options.topNavItemClass=accessible-megamenu-top-nav-item] - CSS class for a top-level navigation item in the megamenu
     * @param {string} [options.panelClass=accessible-megamenu-panel] - CSS class for a megamenu panel
     * @param {string} [options.panelGroupClass=accessible-megamenu-panel-group] - CSS class for a group of items within a megamenu panel
     * @param {string} [options.hoverClass=hover] - CSS class for the hover state
     * @param {string} [options.focusClass=focus] - CSS class for the focus state
     * @param {string} [options.openClass=open] - CSS class for the open state
     */
    $.fn[pluginName] = function (options) {
        return this.each(function () {
            if (!$.data(this, "plugin_" + pluginName)) {
                $.data(this, "plugin_" + pluginName, new $.fn[pluginName].AccessibleMegaMenu(this, options));
            }
        });
    };

    $.fn[pluginName].AccessibleMegaMenu = AccessibleMegaMenu;

    /* :focusable and :tabbable selectors from
       https://raw.github.com/jquery/jquery-ui/master/ui/jquery.ui.core.js */

    /**
     * @private
     */
    function visible(element) {
        return $.expr.filters.visible(element) && !$(element).parents().addBack().filter(function () {
            return $.css(this, "visibility") === "hidden";
        }).length;
    }

    /**
     * @private
     */
    function focusable(element, isTabIndexNotNaN) {
        var map, mapName, img,
            nodeName = element.nodeName.toLowerCase();
        if ("area" === nodeName) {
            map = element.parentNode;
            mapName = map.name;
            if (!element.href || !mapName || map.nodeName.toLowerCase() !== "map") {
                return false;
            }
            img = $("img[usemap=#" + mapName + "]")[0];
            return !!img && visible(img);
        }
        return (/input|select|textarea|button|object/.test(nodeName) ? !element.disabled :
                "a" === nodeName ?
                        element.href || isTabIndexNotNaN :
                        isTabIndexNotNaN) &&
                            // the element and all of its ancestors must be visible
                            visible(element);
    }

    $.extend($.expr[":"], {
        data: $.expr.createPseudo ? $.expr.createPseudo(function (dataName) {
            return function (elem) {
                return !!$.data(elem, dataName);
            };
        }) : // support: jQuery <1.8
                function (elem, i, match) {
                    return !!$.data(elem, match[3]);
                },

        focusable: function (element) {
            return focusable(element, !isNaN($.attr(element, "tabindex")));
        },

        tabbable: function (element) {
            var tabIndex = $.attr(element, "tabindex"),
                isTabIndexNaN = isNaN(tabIndex);
            return (isTabIndexNaN || tabIndex >= 0) && focusable(element, !isTabIndexNaN);
        }
    });
}(jQuery, window, document));

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhc3NldHMvanMvbWFpbi5qcyIsImJvd2VyX2NvbXBvbmVudHMvZW5xdWlyZS9kaXN0L2VucXVpcmUuanMiLCJib3dlcl9jb21wb25lbnRzL2pxdWVyeS1hY2Nlc3NpYmxlTWVnYU1lbnUvanMvanF1ZXJ5LWFjY2Vzc2libGVNZWdhTWVudS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyogZ2xvYmFscyBqUXVlcnkgKi9cblxudmFyIGVucXVpcmUgPSByZXF1aXJlKCcuLi8uLi9ib3dlcl9jb21wb25lbnRzL2VucXVpcmUvZGlzdC9lbnF1aXJlLmpzJylcbnJlcXVpcmUoJy4uLy4uL2Jvd2VyX2NvbXBvbmVudHMvanF1ZXJ5LWFjY2Vzc2libGVNZWdhTWVudS9qcy9qcXVlcnktYWNjZXNzaWJsZU1lZ2FNZW51LmpzJylcblxuJ3VzZSBzdHJpY3QnXG5cbmpRdWVyeShmdW5jdGlvbiAoJCkge1xuICAkKCcuZW1haWxfYnV0dG9uJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgY29uZmlybVxuICAgIGlmICghY29uZmlybSgnQXJlIHlvdSBzdXJlPycpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgdmFyIGRhdGEgPSB7XG4gICAgICBhY3Rpb246ICdzZW5kX2VtYWlsJyxcbiAgICAgIHRhcmdldDogJChlLnRhcmdldCkuYXR0cignaWQnKSxcbiAgICAgIHN1YmplY3Q6ICQoZS50YXJnZXQpLmRhdGEoJ3N1YmplY3QnKSxcbiAgICAgIGJvZHk6ICQoJChlLnRhcmdldCkuZGF0YSgnYm9keScpKS52YWwoKVxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhkYXRhKVxuICAgICQoJy5lbWFpbF9yZXN1bHRzJykucmVtb3ZlQ2xhc3MoJ2FsZXJ0LWRhbmdlcicpXG4gICAgJC5wb3N0KCcvd3AtYWRtaW4vYWRtaW4tYWpheC5waHAnLCBkYXRhLCBmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCB4aHIpIHtcbiAgICAgICQoJy5lbWFpbF9yZXN1bHRzJykuaHRtbChkYXRhKVxuICAgICAgaWYgKHN0YXR1cyAhPT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICQoJy5lbWFpbF9yZXN1bHRzJykuYWRkQ2xhc3MoJ2FsZXJ0LWRhbmdlcicpXG4gICAgICB9XG4gICAgICAkKCcuZW1haWxfcmVzdWx0cycpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKVxuICAgIH0pXG4gIH0pXG59KVxuXG5qUXVlcnkoZnVuY3Rpb24gKCQpIHtcbiAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbiAoKSB7XG4gICAgJCgnLmhlYWRlcicpLmFkZENsYXNzKCdzY3JvbGxlZCcpXG4gIH0pLnJlbW92ZUNsYXNzKCdzY3JvbGxlZCcpXG59KVxuXG5qUXVlcnkoZnVuY3Rpb24gKCQpIHtcbiAgZW5xdWlyZS5yZWdpc3Rlcignc2NyZWVuIGFuZCAobWluLXdpZHRoOjc3OXB4KScsIHtcbiAgICBtYXRjaDogZnVuY3Rpb24gKCkge1xuICAgICAgLy8gTWFpbiBOYXZcbiAgICAgICQoJy5tZW51LWhlYWRlci1tZW51LWNvbnRhaW5lcicpLmFjY2Vzc2libGVNZWdhTWVudSh7XG4gICAgICAgIHV1aWRQcmVmaXg6ICdhY2Nlc3NpYmxlLW5hdicsXG4gICAgICAgIG1lbnVDbGFzczogJ25hdi1tZW51JyxcbiAgICAgICAgdG9wTmF2SXRlbUNsYXNzOiAnbmF2LWl0ZW0nLFxuICAgICAgICBwYW5lbENsYXNzOiAnc3ViLW5hdicsXG4gICAgICAgIHBhbmVsR3JvdXBDbGFzczogJ3N1Yi1uYXYtZ3JvdXAnLFxuICAgICAgICBob3ZlckNsYXNzOiAnaG92ZXInLFxuICAgICAgICBmb2N1c0NsYXNzOiAnZm9jdXMnLFxuICAgICAgICBvcGVuQ2xhc3M6ICdvcGVuJ1xuICAgICAgfSlcbiAgICAgIC8vIGhhY2sgc28gdGhhdCB0aGUgbWVnYW1lbnUgZG9lc24ndCBzaG93IGZsYXNoIG9mIGNzcyBhbmltYXRpb24gYWZ0ZXIgdGhlIHBhZ2UgbG9hZHMuXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdpbml0JylcbiAgICAgIH0sIDUwMClcbiAgICAgIC8vIENoYW5nZSBhcmlhLWhpZGRlbiBzdGF0ZVxuICAgICAgJCgnI2pzLW5hdmlnYXRpb24tdG9nZ2xlJykuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpXG4gICAgfSxcbiAgICB1bm1hdGNoOiBmdW5jdGlvbiAoKSB7XG4gICAgfVxuICB9KVxufSlcblxualF1ZXJ5KGZ1bmN0aW9uICgkKSB7XG4gICQoJy5zZWFyY2gtZm9ybSBpbnB1dFtuYW1lPXBvc3RfdHlwZV0nKS5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICQoJ2Zvcm0jc2VhcmNoZm9ybScpLnN1Ym1pdCgpXG4gIH0pXG59KVxuIiwiLyohXG4gKiBlbnF1aXJlLmpzIHYyLjEuMiAtIEF3ZXNvbWUgTWVkaWEgUXVlcmllcyBpbiBKYXZhU2NyaXB0XG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQgTmljayBXaWxsaWFtcyAtIGh0dHA6Ly93aWNreS5uaWxsaWEubXMvZW5xdWlyZS5qc1xuICogTGljZW5zZTogTUlUIChodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocClcbiAqL1xuXG47KGZ1bmN0aW9uIChuYW1lLCBjb250ZXh0LCBmYWN0b3J5KSB7XG5cdHZhciBtYXRjaE1lZGlhID0gd2luZG93Lm1hdGNoTWVkaWE7XG5cblx0aWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KG1hdGNoTWVkaWEpO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuXHRcdGRlZmluZShmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiAoY29udGV4dFtuYW1lXSA9IGZhY3RvcnkobWF0Y2hNZWRpYSkpO1xuXHRcdH0pO1xuXHR9XG5cdGVsc2Uge1xuXHRcdGNvbnRleHRbbmFtZV0gPSBmYWN0b3J5KG1hdGNoTWVkaWEpO1xuXHR9XG59KCdlbnF1aXJlJywgdGhpcywgZnVuY3Rpb24gKG1hdGNoTWVkaWEpIHtcblxuXHQndXNlIHN0cmljdCc7XG5cbiAgICAvKmpzaGludCB1bnVzZWQ6ZmFsc2UgKi9cbiAgICAvKipcbiAgICAgKiBIZWxwZXIgZnVuY3Rpb24gZm9yIGl0ZXJhdGluZyBvdmVyIGEgY29sbGVjdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0gZm5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBlYWNoKGNvbGxlY3Rpb24sIGZuKSB7XG4gICAgICAgIHZhciBpICAgICAgPSAwLFxuICAgICAgICAgICAgbGVuZ3RoID0gY29sbGVjdGlvbi5sZW5ndGgsXG4gICAgICAgICAgICBjb250O1xuXG4gICAgICAgIGZvcihpOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnQgPSBmbihjb2xsZWN0aW9uW2ldLCBpKTtcbiAgICAgICAgICAgIGlmKGNvbnQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7IC8vYWxsb3cgZWFybHkgZXhpdFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGVscGVyIGZ1bmN0aW9uIGZvciBkZXRlcm1pbmluZyB3aGV0aGVyIHRhcmdldCBvYmplY3QgaXMgYW4gYXJyYXlcbiAgICAgKlxuICAgICAqIEBwYXJhbSB0YXJnZXQgdGhlIG9iamVjdCB1bmRlciB0ZXN0XG4gICAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiBhcnJheSwgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNBcnJheSh0YXJnZXQpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkodGFyZ2V0KSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIZWxwZXIgZnVuY3Rpb24gZm9yIGRldGVybWluaW5nIHdoZXRoZXIgdGFyZ2V0IG9iamVjdCBpcyBhIGZ1bmN0aW9uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGFyZ2V0IHRoZSBvYmplY3QgdW5kZXIgdGVzdFxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgZnVuY3Rpb24sIGZhbHNlIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzRnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgdGFyZ2V0ID09PSAnZnVuY3Rpb24nO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlbGVnYXRlIHRvIGhhbmRsZSBhIG1lZGlhIHF1ZXJ5IGJlaW5nIG1hdGNoZWQgYW5kIHVubWF0Y2hlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gb3B0aW9ucy5tYXRjaCBjYWxsYmFjayBmb3Igd2hlbiB0aGUgbWVkaWEgcXVlcnkgaXMgbWF0Y2hlZFxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtvcHRpb25zLnVubWF0Y2hdIGNhbGxiYWNrIGZvciB3aGVuIHRoZSBtZWRpYSBxdWVyeSBpcyB1bm1hdGNoZWRcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbb3B0aW9ucy5zZXR1cF0gb25lLXRpbWUgY2FsbGJhY2sgdHJpZ2dlcmVkIHRoZSBmaXJzdCB0aW1lIGEgcXVlcnkgaXMgbWF0Y2hlZFxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMuZGVmZXJTZXR1cD1mYWxzZV0gc2hvdWxkIHRoZSBzZXR1cCBjYWxsYmFjayBiZSBydW4gaW1tZWRpYXRlbHksIHJhdGhlciB0aGFuIGZpcnN0IHRpbWUgcXVlcnkgaXMgbWF0Y2hlZD9cbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBRdWVyeUhhbmRsZXIob3B0aW9ucykge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICAhb3B0aW9ucy5kZWZlclNldHVwICYmIHRoaXMuc2V0dXAoKTtcbiAgICB9XG4gICAgUXVlcnlIYW5kbGVyLnByb3RvdHlwZSA9IHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogY29vcmRpbmF0ZXMgc2V0dXAgb2YgdGhlIGhhbmRsZXJcbiAgICAgICAgICpcbiAgICAgICAgICogQGZ1bmN0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBzZXR1cCA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLnNldHVwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnNldHVwKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpc2VkID0gdHJ1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogY29vcmRpbmF0ZXMgc2V0dXAgYW5kIHRyaWdnZXJpbmcgb2YgdGhlIGhhbmRsZXJcbiAgICAgICAgICpcbiAgICAgICAgICogQGZ1bmN0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBvbiA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgIXRoaXMuaW5pdGlhbGlzZWQgJiYgdGhpcy5zZXR1cCgpO1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1hdGNoICYmIHRoaXMub3B0aW9ucy5tYXRjaCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBjb29yZGluYXRlcyB0aGUgdW5tYXRjaCBldmVudCBmb3IgdGhlIGhhbmRsZXJcbiAgICAgICAgICpcbiAgICAgICAgICogQGZ1bmN0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBvZmYgOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy51bm1hdGNoICYmIHRoaXMub3B0aW9ucy51bm1hdGNoKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGNhbGxlZCB3aGVuIGEgaGFuZGxlciBpcyB0byBiZSBkZXN0cm95ZWQuXG4gICAgICAgICAqIGRlbGVnYXRlcyB0byB0aGUgZGVzdHJveSBvciB1bm1hdGNoIGNhbGxiYWNrcywgZGVwZW5kaW5nIG9uIGF2YWlsYWJpbGl0eS5cbiAgICAgICAgICpcbiAgICAgICAgICogQGZ1bmN0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBkZXN0cm95IDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuZGVzdHJveSA/IHRoaXMub3B0aW9ucy5kZXN0cm95KCkgOiB0aGlzLm9mZigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBkZXRlcm1pbmVzIGVxdWFsaXR5IGJ5IHJlZmVyZW5jZS5cbiAgICAgICAgICogaWYgb2JqZWN0IGlzIHN1cHBsaWVkIGNvbXBhcmUgb3B0aW9ucywgaWYgZnVuY3Rpb24sIGNvbXBhcmUgbWF0Y2ggY2FsbGJhY2tcbiAgICAgICAgICpcbiAgICAgICAgICogQGZ1bmN0aW9uXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0IHx8IGZ1bmN0aW9ufSBbdGFyZ2V0XSB0aGUgdGFyZ2V0IGZvciBjb21wYXJpc29uXG4gICAgICAgICAqL1xuICAgICAgICBlcXVhbHMgOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMgPT09IHRhcmdldCB8fCB0aGlzLm9wdGlvbnMubWF0Y2ggPT09IHRhcmdldDtcbiAgICAgICAgfVxuXG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBSZXByZXNlbnRzIGEgc2luZ2xlIG1lZGlhIHF1ZXJ5LCBtYW5hZ2VzIGl0J3Mgc3RhdGUgYW5kIHJlZ2lzdGVyZWQgaGFuZGxlcnMgZm9yIHRoaXMgcXVlcnlcbiAgICAgKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeSB0aGUgbWVkaWEgcXVlcnkgc3RyaW5nXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbaXNVbmNvbmRpdGlvbmFsPWZhbHNlXSB3aGV0aGVyIHRoZSBtZWRpYSBxdWVyeSBzaG91bGQgcnVuIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB0aGUgY29uZGl0aW9ucyBhcmUgbWV0LiBQcmltYXJpbHkgZm9yIGhlbHBpbmcgb2xkZXIgYnJvd3NlcnMgZGVhbCB3aXRoIG1vYmlsZS1maXJzdCBkZXNpZ25cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBNZWRpYVF1ZXJ5KHF1ZXJ5LCBpc1VuY29uZGl0aW9uYWwpIHtcbiAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5O1xuICAgICAgICB0aGlzLmlzVW5jb25kaXRpb25hbCA9IGlzVW5jb25kaXRpb25hbDtcbiAgICAgICAgdGhpcy5oYW5kbGVycyA9IFtdO1xuICAgICAgICB0aGlzLm1xbCA9IG1hdGNoTWVkaWEocXVlcnkpO1xuXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5saXN0ZW5lciA9IGZ1bmN0aW9uKG1xbCkge1xuICAgICAgICAgICAgc2VsZi5tcWwgPSBtcWw7XG4gICAgICAgICAgICBzZWxmLmFzc2VzcygpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1xbC5hZGRMaXN0ZW5lcih0aGlzLmxpc3RlbmVyKTtcbiAgICB9XG4gICAgTWVkaWFRdWVyeS5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGFkZCBhIGhhbmRsZXIgZm9yIHRoaXMgcXVlcnksIHRyaWdnZXJpbmcgaWYgYWxyZWFkeSBhY3RpdmVcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IGhhbmRsZXJcbiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gaGFuZGxlci5tYXRjaCBjYWxsYmFjayBmb3Igd2hlbiBxdWVyeSBpcyBhY3RpdmF0ZWRcbiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gW2hhbmRsZXIudW5tYXRjaF0gY2FsbGJhY2sgZm9yIHdoZW4gcXVlcnkgaXMgZGVhY3RpdmF0ZWRcbiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gW2hhbmRsZXIuc2V0dXBdIGNhbGxiYWNrIGZvciBpbW1lZGlhdGUgZXhlY3V0aW9uIHdoZW4gYSBxdWVyeSBoYW5kbGVyIGlzIHJlZ2lzdGVyZWRcbiAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBbaGFuZGxlci5kZWZlclNldHVwPWZhbHNlXSBzaG91bGQgdGhlIHNldHVwIGNhbGxiYWNrIGJlIGRlZmVycmVkIHVudGlsIHRoZSBmaXJzdCB0aW1lIHRoZSBoYW5kbGVyIGlzIG1hdGNoZWQ/XG4gICAgICAgICAqL1xuICAgICAgICBhZGRIYW5kbGVyIDogZnVuY3Rpb24oaGFuZGxlcikge1xuICAgICAgICAgICAgdmFyIHFoID0gbmV3IFF1ZXJ5SGFuZGxlcihoYW5kbGVyKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlcnMucHVzaChxaCk7XG5cbiAgICAgICAgICAgIHRoaXMubWF0Y2hlcygpICYmIHFoLm9uKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIHJlbW92ZXMgdGhlIGdpdmVuIGhhbmRsZXIgZnJvbSB0aGUgY29sbGVjdGlvbiwgYW5kIGNhbGxzIGl0J3MgZGVzdHJveSBtZXRob2RzXG4gICAgICAgICAqIFxuICAgICAgICAgKiBAcGFyYW0ge29iamVjdCB8fCBmdW5jdGlvbn0gaGFuZGxlciB0aGUgaGFuZGxlciB0byByZW1vdmVcbiAgICAgICAgICovXG4gICAgICAgIHJlbW92ZUhhbmRsZXIgOiBmdW5jdGlvbihoYW5kbGVyKSB7XG4gICAgICAgICAgICB2YXIgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzO1xuICAgICAgICAgICAgZWFjaChoYW5kbGVycywgZnVuY3Rpb24oaCwgaSkge1xuICAgICAgICAgICAgICAgIGlmKGguZXF1YWxzKGhhbmRsZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGguZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWhhbmRsZXJzLnNwbGljZShpLDEpOyAvL3JlbW92ZSBmcm9tIGFycmF5IGFuZCBleGl0IGVhY2ggZWFybHlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIG1lZGlhIHF1ZXJ5IHNob3VsZCBiZSBjb25zaWRlcmVkIGEgbWF0Y2hcbiAgICAgICAgICogXG4gICAgICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgbWVkaWEgcXVlcnkgY2FuIGJlIGNvbnNpZGVyZWQgYSBtYXRjaCwgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICAgICAqL1xuICAgICAgICBtYXRjaGVzIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tcWwubWF0Y2hlcyB8fCB0aGlzLmlzVW5jb25kaXRpb25hbDtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2xlYXJzIGFsbCBoYW5kbGVycyBhbmQgdW5iaW5kcyBldmVudHNcbiAgICAgICAgICovXG4gICAgICAgIGNsZWFyIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBlYWNoKHRoaXMuaGFuZGxlcnMsIGZ1bmN0aW9uKGhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5tcWwucmVtb3ZlTGlzdGVuZXIodGhpcy5saXN0ZW5lcik7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZXJzLmxlbmd0aCA9IDA7IC8vY2xlYXIgYXJyYXlcbiAgICAgICAgfSxcblxuICAgICAgICAvKlxuICAgICAgICAgKiBBc3Nlc3NlcyB0aGUgcXVlcnksIHR1cm5pbmcgb24gYWxsIGhhbmRsZXJzIGlmIGl0IG1hdGNoZXMsIHR1cm5pbmcgdGhlbSBvZmYgaWYgaXQgZG9lc24ndCBtYXRjaFxuICAgICAgICAgKi9cbiAgICAgICAgYXNzZXNzIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgYWN0aW9uID0gdGhpcy5tYXRjaGVzKCkgPyAnb24nIDogJ29mZic7XG5cbiAgICAgICAgICAgIGVhY2godGhpcy5oYW5kbGVycywgZnVuY3Rpb24oaGFuZGxlcikge1xuICAgICAgICAgICAgICAgIGhhbmRsZXJbYWN0aW9uXSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEFsbG93cyBmb3IgcmVnaXN0cmF0aW9uIG9mIHF1ZXJ5IGhhbmRsZXJzLlxuICAgICAqIE1hbmFnZXMgdGhlIHF1ZXJ5IGhhbmRsZXIncyBzdGF0ZSBhbmQgaXMgcmVzcG9uc2libGUgZm9yIHdpcmluZyB1cCBicm93c2VyIGV2ZW50c1xuICAgICAqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgZnVuY3Rpb24gTWVkaWFRdWVyeURpc3BhdGNoICgpIHtcbiAgICAgICAgaWYoIW1hdGNoTWVkaWEpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbWF0Y2hNZWRpYSBub3QgcHJlc2VudCwgbGVnYWN5IGJyb3dzZXJzIHJlcXVpcmUgYSBwb2x5ZmlsbCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5xdWVyaWVzID0ge307XG4gICAgICAgIHRoaXMuYnJvd3NlcklzSW5jYXBhYmxlID0gIW1hdGNoTWVkaWEoJ29ubHkgYWxsJykubWF0Y2hlcztcbiAgICB9XG5cbiAgICBNZWRpYVF1ZXJ5RGlzcGF0Y2gucHJvdG90eXBlID0ge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWdpc3RlcnMgYSBoYW5kbGVyIGZvciB0aGUgZ2l2ZW4gbWVkaWEgcXVlcnlcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHEgdGhlIG1lZGlhIHF1ZXJ5XG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0IHx8IEFycmF5IHx8IEZ1bmN0aW9ufSBvcHRpb25zIGVpdGhlciBhIHNpbmdsZSBxdWVyeSBoYW5kbGVyIG9iamVjdCwgYSBmdW5jdGlvbiwgb3IgYW4gYXJyYXkgb2YgcXVlcnkgaGFuZGxlcnNcbiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gb3B0aW9ucy5tYXRjaCBmaXJlZCB3aGVuIHF1ZXJ5IG1hdGNoZWRcbiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gW29wdGlvbnMudW5tYXRjaF0gZmlyZWQgd2hlbiBhIHF1ZXJ5IGlzIG5vIGxvbmdlciBtYXRjaGVkXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtvcHRpb25zLnNldHVwXSBmaXJlZCB3aGVuIGhhbmRsZXIgZmlyc3QgdHJpZ2dlcmVkXG4gICAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMuZGVmZXJTZXR1cD1mYWxzZV0gd2hldGhlciBzZXR1cCBzaG91bGQgYmUgcnVuIGltbWVkaWF0ZWx5IG9yIGRlZmVycmVkIHVudGlsIHF1ZXJ5IGlzIGZpcnN0IG1hdGNoZWRcbiAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBbc2hvdWxkRGVncmFkZT1mYWxzZV0gd2hldGhlciB0aGlzIHBhcnRpY3VsYXIgbWVkaWEgcXVlcnkgc2hvdWxkIGFsd2F5cyBydW4gb24gaW5jYXBhYmxlIGJyb3dzZXJzXG4gICAgICAgICAqL1xuICAgICAgICByZWdpc3RlciA6IGZ1bmN0aW9uKHEsIG9wdGlvbnMsIHNob3VsZERlZ3JhZGUpIHtcbiAgICAgICAgICAgIHZhciBxdWVyaWVzICAgICAgICAgPSB0aGlzLnF1ZXJpZXMsXG4gICAgICAgICAgICAgICAgaXNVbmNvbmRpdGlvbmFsID0gc2hvdWxkRGVncmFkZSAmJiB0aGlzLmJyb3dzZXJJc0luY2FwYWJsZTtcblxuICAgICAgICAgICAgaWYoIXF1ZXJpZXNbcV0pIHtcbiAgICAgICAgICAgICAgICBxdWVyaWVzW3FdID0gbmV3IE1lZGlhUXVlcnkocSwgaXNVbmNvbmRpdGlvbmFsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9ub3JtYWxpc2UgdG8gb2JqZWN0IGluIGFuIGFycmF5XG4gICAgICAgICAgICBpZihpc0Z1bmN0aW9uKG9wdGlvbnMpKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IHsgbWF0Y2ggOiBvcHRpb25zIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZighaXNBcnJheShvcHRpb25zKSkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBbb3B0aW9uc107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlYWNoKG9wdGlvbnMsIGZ1bmN0aW9uKGhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNGdW5jdGlvbihoYW5kbGVyKSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyID0geyBtYXRjaCA6IGhhbmRsZXIgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXVlcmllc1txXS5hZGRIYW5kbGVyKGhhbmRsZXIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiB1bnJlZ2lzdGVycyBhIHF1ZXJ5IGFuZCBhbGwgaXQncyBoYW5kbGVycywgb3IgYSBzcGVjaWZpYyBoYW5kbGVyIGZvciBhIHF1ZXJ5XG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBxIHRoZSBtZWRpYSBxdWVyeSB0byB0YXJnZXRcbiAgICAgICAgICogQHBhcmFtIHtvYmplY3QgfHwgZnVuY3Rpb259IFtoYW5kbGVyXSBzcGVjaWZpYyBoYW5kbGVyIHRvIHVucmVnaXN0ZXJcbiAgICAgICAgICovXG4gICAgICAgIHVucmVnaXN0ZXIgOiBmdW5jdGlvbihxLCBoYW5kbGVyKSB7XG4gICAgICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLnF1ZXJpZXNbcV07XG5cbiAgICAgICAgICAgIGlmKHF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgaWYoaGFuZGxlcikge1xuICAgICAgICAgICAgICAgICAgICBxdWVyeS5yZW1vdmVIYW5kbGVyKGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnkuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMucXVlcmllc1txXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgfTtcblxuXHRyZXR1cm4gbmV3IE1lZGlhUXVlcnlEaXNwYXRjaCgpO1xuXG59KSk7IiwiLypcbkNvcHlyaWdodCDCqSAyMDEzIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUg4oCcTGljZW5zZeKAnSk7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIOKAnEFTIElT4oCdIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbi8qKlxuICogU2VlIDxhIGhyZWY9XCJodHRwOi8vanF1ZXJ5LmNvbVwiPmh0dHA6Ly9qcXVlcnkuY29tPC9hPi5cbiAqIEBuYW1lIGpxdWVyeVxuICogQGNsYXNzXG4gKiBTZWUgdGhlIGpRdWVyeSBMaWJyYXJ5ICAoPGEgaHJlZj1cImh0dHA6Ly9qcXVlcnkuY29tXCI+aHR0cDovL2pxdWVyeS5jb208L2E+KSBmb3IgZnVsbCBkZXRhaWxzLiAgVGhpcyBqdXN0XG4gKiBkb2N1bWVudHMgdGhlIGZ1bmN0aW9uIGFuZCBjbGFzc2VzIHRoYXQgYXJlIGFkZGVkIHRvIGpRdWVyeSBieSB0aGlzIHBsdWctaW4uXG4gKi9cblxuLyoqXG4gKiBTZWUgPGEgaHJlZj1cImh0dHA6Ly9qcXVlcnkuY29tXCI+aHR0cDovL2pxdWVyeS5jb208L2E+XG4gKiBAbmFtZSBmblxuICogQGNsYXNzXG4gKiBTZWUgdGhlIGpRdWVyeSBMaWJyYXJ5ICAoPGEgaHJlZj1cImh0dHA6Ly9qcXVlcnkuY29tXCI+aHR0cDovL2pxdWVyeS5jb208L2E+KSBmb3IgZnVsbCBkZXRhaWxzLiAgVGhpcyBqdXN0XG4gKiBkb2N1bWVudHMgdGhlIGZ1bmN0aW9uIGFuZCBjbGFzc2VzIHRoYXQgYXJlIGFkZGVkIHRvIGpRdWVyeSBieSB0aGlzIHBsdWctaW4uXG4gKiBAbWVtYmVyT2YganF1ZXJ5XG4gKi9cblxuLyoqXG4gKiBAZmlsZU92ZXJ2aWV3IGFjY2Vzc2libGVNZWdhTWVudSBwbHVnaW5cbiAqXG4gKjxwPkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSDigJxMaWNlbnNl4oCdKVxuICo8YnIgLz5Db3B5cmlnaHQgwqkgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC5cbiAqPGJyIC8+UHJvamVjdCBwYWdlIDxhIGhyZWY9XCJodHRwczovL2dpdGh1Yi5jb20vYWRvYmUtYWNjZXNzaWJpbGl0eS9BY2Nlc3NpYmxlLU1lZ2EtTWVudVwiPmh0dHBzOi8vZ2l0aHViLmNvbS9hZG9iZS1hY2Nlc3NpYmlsaXR5L0FjY2Vzc2libGUtTWVnYS1NZW51PC9hPlxuICogQHZlcnNpb24gMC4xXG4gKiBAYXV0aG9yIE1pY2hhZWwgSm9yZGFuXG4gKiBAcmVxdWlyZXMganF1ZXJ5XG4gKi9cblxuLypqc2xpbnQgYnJvd3NlcjogdHJ1ZSwgZGV2ZWw6IHRydWUsIHBsdXNwbHVzOiB0cnVlLCBub21lbjogdHJ1ZSAqL1xuLypnbG9iYWwgalF1ZXJ5ICovXG4oZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB2YXIgcGx1Z2luTmFtZSA9IFwiYWNjZXNzaWJsZU1lZ2FNZW51XCIsXG4gICAgICAgIGRlZmF1bHRzID0ge1xuICAgICAgICAgICAgdXVpZFByZWZpeDogXCJhY2Nlc3NpYmxlLW1lZ2FtZW51XCIsIC8vIHVuaXF1ZSBJRCdzIGFyZSByZXF1aXJlZCB0byBpbmRpY2F0ZSBhcmlhLW93bnMsIGFyaWEtY29udHJvbHMgYW5kIGFyaWEtbGFiZWxsZWRieVxuICAgICAgICAgICAgbWVudUNsYXNzOiBcImFjY2Vzc2libGUtbWVnYW1lbnVcIiwgLy8gZGVmYXVsdCBjc3MgY2xhc3MgdXNlZCB0byBkZWZpbmUgdGhlIG1lZ2FtZW51IHN0eWxpbmdcbiAgICAgICAgICAgIHRvcE5hdkl0ZW1DbGFzczogXCJhY2Nlc3NpYmxlLW1lZ2FtZW51LXRvcC1uYXYtaXRlbVwiLCAvLyBkZWZhdWx0IGNzcyBjbGFzcyBmb3IgYSB0b3AtbGV2ZWwgbmF2aWdhdGlvbiBpdGVtIGluIHRoZSBtZWdhbWVudVxuICAgICAgICAgICAgcGFuZWxDbGFzczogXCJhY2Nlc3NpYmxlLW1lZ2FtZW51LXBhbmVsXCIsIC8vIGRlZmF1bHQgY3NzIGNsYXNzIGZvciBhIG1lZ2FtZW51IHBhbmVsXG4gICAgICAgICAgICBwYW5lbEdyb3VwQ2xhc3M6IFwiYWNjZXNzaWJsZS1tZWdhbWVudS1wYW5lbC1ncm91cFwiLCAvLyBkZWZhdWx0IGNzcyBjbGFzcyBmb3IgYSBncm91cCBvZiBpdGVtcyB3aXRoaW4gYSBtZWdhbWVudSBwYW5lbFxuICAgICAgICAgICAgaG92ZXJDbGFzczogXCJob3ZlclwiLCAvLyBkZWZhdWx0IGNzcyBjbGFzcyBmb3IgdGhlIGhvdmVyIHN0YXRlXG4gICAgICAgICAgICBmb2N1c0NsYXNzOiBcImZvY3VzXCIsIC8vIGRlZmF1bHQgY3NzIGNsYXNzIGZvciB0aGUgZm9jdXMgc3RhdGVcbiAgICAgICAgICAgIG9wZW5DbGFzczogXCJvcGVuXCIgLy8gZGVmYXVsdCBjc3MgY2xhc3MgZm9yIHRoZSBvcGVuIHN0YXRlXG4gICAgICAgIH0sXG4gICAgICAgIEtleWJvYXJkID0ge1xuICAgICAgICAgICAgQkFDS1NQQUNFOiA4LFxuICAgICAgICAgICAgQ09NTUE6IDE4OCxcbiAgICAgICAgICAgIERFTEVURTogNDYsXG4gICAgICAgICAgICBET1dOOiA0MCxcbiAgICAgICAgICAgIEVORDogMzUsXG4gICAgICAgICAgICBFTlRFUjogMTMsXG4gICAgICAgICAgICBFU0NBUEU6IDI3LFxuICAgICAgICAgICAgSE9NRTogMzYsXG4gICAgICAgICAgICBMRUZUOiAzNyxcbiAgICAgICAgICAgIFBBR0VfRE9XTjogMzQsXG4gICAgICAgICAgICBQQUdFX1VQOiAzMyxcbiAgICAgICAgICAgIFBFUklPRDogMTkwLFxuICAgICAgICAgICAgUklHSFQ6IDM5LFxuICAgICAgICAgICAgU1BBQ0U6IDMyLFxuICAgICAgICAgICAgVEFCOiA5LFxuICAgICAgICAgICAgVVA6IDM4LFxuICAgICAgICAgICAga2V5TWFwOiB7XG4gICAgICAgICAgICAgICAgNDg6IFwiMFwiLFxuICAgICAgICAgICAgICAgIDQ5OiBcIjFcIixcbiAgICAgICAgICAgICAgICA1MDogXCIyXCIsXG4gICAgICAgICAgICAgICAgNTE6IFwiM1wiLFxuICAgICAgICAgICAgICAgIDUyOiBcIjRcIixcbiAgICAgICAgICAgICAgICA1MzogXCI1XCIsXG4gICAgICAgICAgICAgICAgNTQ6IFwiNlwiLFxuICAgICAgICAgICAgICAgIDU1OiBcIjdcIixcbiAgICAgICAgICAgICAgICA1NjogXCI4XCIsXG4gICAgICAgICAgICAgICAgNTc6IFwiOVwiLFxuICAgICAgICAgICAgICAgIDU5OiBcIjtcIixcbiAgICAgICAgICAgICAgICA2NTogXCJhXCIsXG4gICAgICAgICAgICAgICAgNjY6IFwiYlwiLFxuICAgICAgICAgICAgICAgIDY3OiBcImNcIixcbiAgICAgICAgICAgICAgICA2ODogXCJkXCIsXG4gICAgICAgICAgICAgICAgNjk6IFwiZVwiLFxuICAgICAgICAgICAgICAgIDcwOiBcImZcIixcbiAgICAgICAgICAgICAgICA3MTogXCJnXCIsXG4gICAgICAgICAgICAgICAgNzI6IFwiaFwiLFxuICAgICAgICAgICAgICAgIDczOiBcImlcIixcbiAgICAgICAgICAgICAgICA3NDogXCJqXCIsXG4gICAgICAgICAgICAgICAgNzU6IFwia1wiLFxuICAgICAgICAgICAgICAgIDc2OiBcImxcIixcbiAgICAgICAgICAgICAgICA3NzogXCJtXCIsXG4gICAgICAgICAgICAgICAgNzg6IFwiblwiLFxuICAgICAgICAgICAgICAgIDc5OiBcIm9cIixcbiAgICAgICAgICAgICAgICA4MDogXCJwXCIsXG4gICAgICAgICAgICAgICAgODE6IFwicVwiLFxuICAgICAgICAgICAgICAgIDgyOiBcInJcIixcbiAgICAgICAgICAgICAgICA4MzogXCJzXCIsXG4gICAgICAgICAgICAgICAgODQ6IFwidFwiLFxuICAgICAgICAgICAgICAgIDg1OiBcInVcIixcbiAgICAgICAgICAgICAgICA4NjogXCJ2XCIsXG4gICAgICAgICAgICAgICAgODc6IFwid1wiLFxuICAgICAgICAgICAgICAgIDg4OiBcInhcIixcbiAgICAgICAgICAgICAgICA4OTogXCJ5XCIsXG4gICAgICAgICAgICAgICAgOTA6IFwielwiLFxuICAgICAgICAgICAgICAgIDk2OiBcIjBcIixcbiAgICAgICAgICAgICAgICA5NzogXCIxXCIsXG4gICAgICAgICAgICAgICAgOTg6IFwiMlwiLFxuICAgICAgICAgICAgICAgIDk5OiBcIjNcIixcbiAgICAgICAgICAgICAgICAxMDA6IFwiNFwiLFxuICAgICAgICAgICAgICAgIDEwMTogXCI1XCIsXG4gICAgICAgICAgICAgICAgMTAyOiBcIjZcIixcbiAgICAgICAgICAgICAgICAxMDM6IFwiN1wiLFxuICAgICAgICAgICAgICAgIDEwNDogXCI4XCIsXG4gICAgICAgICAgICAgICAgMTA1OiBcIjlcIixcbiAgICAgICAgICAgICAgICAxOTA6IFwiLlwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgLyoqXG4gICAgICogQGRlc2MgQ3JlYXRlcyBhIG5ldyBhY2Nlc3NpYmxlIG1lZ2EgbWVudSBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0ge2pxdWVyeX0gZWxlbWVudFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gTWVnYSBNZW51IG9wdGlvbnNcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMudXVpZFByZWZpeD1hY2Nlc3NpYmxlLW1lZ2FtZW51XSAtIFByZWZpeCBmb3IgZ2VuZXJhdGVkIHVuaXF1ZSBpZCBhdHRyaWJ1dGVzLCB3aGljaCBhcmUgcmVxdWlyZWQgdG8gaW5kaWNhdGUgYXJpYS1vd25zLCBhcmlhLWNvbnRyb2xzIGFuZCBhcmlhLWxhYmVsbGVkYnlcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMubWVudUNsYXNzPWFjY2Vzc2libGUtbWVnYW1lbnVdIC0gQ1NTIGNsYXNzIHVzZWQgdG8gZGVmaW5lIHRoZSBtZWdhbWVudSBzdHlsaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnRvcE5hdkl0ZW1DbGFzcz1hY2Nlc3NpYmxlLW1lZ2FtZW51LXRvcC1uYXYtaXRlbV0gLSBDU1MgY2xhc3MgZm9yIGEgdG9wLWxldmVsIG5hdmlnYXRpb24gaXRlbSBpbiB0aGUgbWVnYW1lbnVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMucGFuZWxDbGFzcz1hY2Nlc3NpYmxlLW1lZ2FtZW51LXBhbmVsXSAtIENTUyBjbGFzcyBmb3IgYSBtZWdhbWVudSBwYW5lbFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5wYW5lbEdyb3VwQ2xhc3M9YWNjZXNzaWJsZS1tZWdhbWVudS1wYW5lbC1ncm91cF0gLSBDU1MgY2xhc3MgZm9yIGEgZ3JvdXAgb2YgaXRlbXMgd2l0aGluIGEgbWVnYW1lbnUgcGFuZWxcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuaG92ZXJDbGFzcz1ob3Zlcl0gLSBDU1MgY2xhc3MgZm9yIHRoZSBob3ZlciBzdGF0ZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5mb2N1c0NsYXNzPWZvY3VzXSAtIENTUyBjbGFzcyBmb3IgdGhlIGZvY3VzIHN0YXRlXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLm9wZW5DbGFzcz1vcGVuXSAtIENTUyBjbGFzcyBmb3IgdGhlIG9wZW4gc3RhdGVcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBBY2Nlc3NpYmxlTWVnYU1lbnUoZWxlbWVudCwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuXG4gICAgICAgIC8vIG1lcmdlIG9wdGlvbmFsIHNldHRpbmdzIGFuZCBkZWZhdWx0cyBpbnRvIHNldHRpbmdzXG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuX2RlZmF1bHRzID0gZGVmYXVsdHM7XG4gICAgICAgIHRoaXMuX25hbWUgPSBwbHVnaW5OYW1lO1xuXG4gICAgICAgIHRoaXMubW91c2VUaW1lb3V0SUQgPSBudWxsO1xuICAgICAgICB0aGlzLmZvY3VzVGltZW91dElEID0gbnVsbDtcbiAgICAgICAgdGhpcy5tb3VzZUZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5qdXN0Rm9jdXNlZCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIEFjY2Vzc2libGVNZWdhTWVudS5wcm90b3R5cGUgPSAoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIC8qIHByaXZhdGUgYXR0cmlidXRlcyBhbmQgbWV0aG9kcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbiAgICAgICAgdmFyIHV1aWQgPSAwLFxuICAgICAgICAgICAga2V5ZG93blRpbWVvdXREdXJhdGlvbiA9IDEwMDAsXG4gICAgICAgICAgICBrZXlkb3duU2VhcmNoU3RyaW5nID0gXCJcIixcbiAgICAgICAgICAgIGlzVG91Y2ggPSB0eXBlb2Ygd2luZG93Lmhhc093blByb3BlcnR5ID09PSBcImZ1bmN0aW9uXCIgJiYgISF3aW5kb3cuaGFzT3duUHJvcGVydHkoXCJvbnRvdWNoc3RhcnRcIiksXG4gICAgICAgICAgICBfZ2V0UGx1Z2luLFxuICAgICAgICAgICAgX2FkZFVuaXF1ZUlkLFxuICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLFxuICAgICAgICAgICAgX2NsaWNrSGFuZGxlcixcbiAgICAgICAgICAgIF9jbGlja091dHNpZGVIYW5kbGVyLFxuICAgICAgICAgICAgX0RPTUF0dHJNb2RpZmllZEhhbmRsZXIsXG4gICAgICAgICAgICBfZm9jdXNJbkhhbmRsZXIsXG4gICAgICAgICAgICBfZm9jdXNPdXRIYW5kbGVyLFxuICAgICAgICAgICAgX2tleURvd25IYW5kbGVyLFxuICAgICAgICAgICAgX21vdXNlRG93bkhhbmRsZXIsXG4gICAgICAgICAgICBfbW91c2VPdmVySGFuZGxlcixcbiAgICAgICAgICAgIF9tb3VzZU91dEhhbmRsZXIsXG4gICAgICAgICAgICBfdG9nZ2xlRXhwYW5kZWRFdmVudEhhbmRsZXJzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbmFtZSBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51fl9nZXRQbHVnaW5cbiAgICAgICAgICogQGRlc2MgUmV0dXJucyB0aGUgcGFyZW50IGFjY2Vzc2libGVNZWdhTWVudSBpbnN0YW5jZSBmb3IgYSBnaXZlbiBlbGVtZW50XG4gICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbGVtZW50XG4gICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAqIEBpbm5lclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2dldFBsdWdpbiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gJChlbGVtZW50KS5jbG9zZXN0KCc6ZGF0YShwbHVnaW5fJyArIHBsdWdpbk5hbWUgKyAnKScpLmRhdGEoXCJwbHVnaW5fXCIgKyBwbHVnaW5OYW1lKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQG5hbWUgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudX5fYWRkVW5pcXVlSWRcbiAgICAgICAgICogQGRlc2MgQWRkcyBhIHVuaXF1ZSBpZCBhbmQgZWxlbWVudC5cbiAgICAgICAgICogVGhlIGlkIHN0cmluZyBzdGFydHMgd2l0aCB0aGVcbiAgICAgICAgICogc3RyaW5nIGRlZmluZWQgaW4gc2V0dGluZ3MudXVpZFByZWZpeC5cbiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IGVsZW1lbnRcbiAgICAgICAgICogQG1lbWJlcm9mIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICogQGlubmVyXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfYWRkVW5pcXVlSWQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB0aGlzLnNldHRpbmdzO1xuICAgICAgICAgICAgaWYgKCFlbGVtZW50LmF0dHIoXCJpZFwiKSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcImlkXCIsIHNldHRpbmdzLnV1aWRQcmVmaXggKyBcIi1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgXCItXCIgKyAoKyt1dWlkKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBuYW1lIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnV+X3RvZ2dsZVBhbmVsXG4gICAgICAgICAqIEBkZXNjIFRvZ2dsZSB0aGUgZGlzcGxheSBvZiBtZWdhIG1lbnUgcGFuZWxzIGluIHJlc3BvbnNlIHRvIGFuIGV2ZW50LlxuICAgICAgICAgKiBUaGUgb3B0aW9uYWwgYm9vbGVhbiB2YWx1ZSAnaGlkZScgZm9yY2VzIGFsbCBwYW5lbHMgdG8gaGlkZS5cbiAgICAgICAgICogQHBhcmFtIHtldmVudH0gZXZlbnRcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbaGlkZV0gSGlkZSBhbGwgbWVnYSBtZW51IHBhbmVscyB3aGVuIHRydWVcbiAgICAgICAgICogQG1lbWJlcm9mIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICogQGlubmVyXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfdG9nZ2xlUGFuZWwgPSBmdW5jdGlvbiAoZXZlbnQsIGhpZGUpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCksXG4gICAgICAgICAgICAgICAgdGhhdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSB0aGlzLnNldHRpbmdzLFxuICAgICAgICAgICAgICAgIG1lbnUgPSB0aGlzLm1lbnUsXG4gICAgICAgICAgICAgICAgdG9wbGkgPSB0YXJnZXQuY2xvc2VzdCgnLicgKyBzZXR0aW5ncy50b3BOYXZJdGVtQ2xhc3MpLFxuICAgICAgICAgICAgICAgIHBhbmVsID0gdGFyZ2V0Lmhhc0NsYXNzKHNldHRpbmdzLnBhbmVsQ2xhc3MpID8gdGFyZ2V0IDogdGFyZ2V0LmNsb3Nlc3QoJy4nICsgc2V0dGluZ3MucGFuZWxDbGFzcyksXG4gICAgICAgICAgICAgICAgbmV3Zm9jdXM7XG5cbiAgICAgICAgICAgIF90b2dnbGVFeHBhbmRlZEV2ZW50SGFuZGxlcnMuY2FsbCh0aGlzLCB0cnVlKTtcblxuICAgICAgICAgICAgaWYgKGhpZGUpIHtcbiAgICAgICAgICAgICAgICB0b3BsaSA9IG1lbnUuZmluZCgnLicgKyBzZXR0aW5ncy50b3BOYXZJdGVtQ2xhc3MgKyAnIC4nICsgc2V0dGluZ3Mub3BlbkNsYXNzICsgJzpmaXJzdCcpLmNsb3Nlc3QoJy4nICsgc2V0dGluZ3MudG9wTmF2SXRlbUNsYXNzKTtcbiAgICAgICAgICAgICAgICBpZiAoISh0b3BsaS5pcyhldmVudC5yZWxhdGVkVGFyZ2V0KSB8fCB0b3BsaS5oYXMoZXZlbnQucmVsYXRlZFRhcmdldCkubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKChldmVudC50eXBlID09PSAnbW91c2VvdXQnIHx8IGV2ZW50LnR5cGUgPT09ICdmb2N1c291dCcpICYmIHRvcGxpLmhhcyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdG9wbGkuZmluZCgnW2FyaWEtZXhwYW5kZWRdJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhzZXR0aW5ncy5vcGVuQ2xhc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKCcuJyArIHNldHRpbmdzLnBhbmVsQ2xhc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoKGV2ZW50LnR5cGUgPT09ICdrZXlkb3duJyAmJiBldmVudC5rZXlDb2RlID09PSBLZXlib2FyZC5FU0NBUEUpIHx8IGV2ZW50LnR5cGUgPT09ICdET01BdHRyTW9kaWZpZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdmb2N1cyA9IHRvcGxpLmZpbmQoJzp0YWJiYWJsZTpmaXJzdCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVudS5maW5kKCdbYXJpYS1leHBhbmRlZF0uJyArIHRoYXQuc2V0dGluZ3MucGFuZWxDbGFzcykub2ZmKCdET01BdHRyTW9kaWZpZWQuYWNjZXNzaWJsZS1tZWdhbWVudScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld2ZvY3VzLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5qdXN0Rm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgOTkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0b3BsaS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbWVudS5maW5kKCdbYXJpYS1leHBhbmRlZD10cnVlXScpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsICdmYWxzZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3Moc2V0dGluZ3Mub3BlbkNsYXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcignLicgKyBzZXR0aW5ncy5wYW5lbENsYXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGF0LmZvY3VzVGltZW91dElEKTtcbiAgICAgICAgICAgICAgICB0b3BsaS5zaWJsaW5ncygpXG4gICAgICAgICAgICAgICAgICAgIC5maW5kKCdbYXJpYS1leHBhbmRlZF0nKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsICdmYWxzZScpXG4gICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhzZXR0aW5ncy5vcGVuQ2xhc3MpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoJy4nICsgc2V0dGluZ3MucGFuZWxDbGFzcylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgICAgICAgICAgICAgICB0b3BsaS5maW5kKCdbYXJpYS1leHBhbmRlZF0nKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsICd0cnVlJylcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKHNldHRpbmdzLm9wZW5DbGFzcylcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcignLicgKyBzZXR0aW5ncy5wYW5lbENsYXNzKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ21vdXNlb3ZlcicgJiYgdGFyZ2V0LmlzKCc6dGFiYmFibGUnKSAmJiB0b3BsaS5sZW5ndGggPT09IDEgJiYgcGFuZWwubGVuZ3RoID09PSAwICYmIG1lbnUuaGFzKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuanVzdEZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfdG9nZ2xlRXhwYW5kZWRFdmVudEhhbmRsZXJzLmNhbGwodGhhdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBuYW1lIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnV+X2NsaWNrSGFuZGxlclxuICAgICAgICAgKiBAZGVzYyBIYW5kbGUgY2xpY2sgZXZlbnQgb24gbWVnYSBtZW51IGl0ZW1cbiAgICAgICAgICogQHBhcmFtIHtldmVudH0gRXZlbnQgb2JqZWN0XG4gICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAqIEBpbm5lclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2NsaWNrSGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZXZlbnQuY3VycmVudFRhcmdldCksXG4gICAgICAgICAgICAgICAgdG9wbGkgPSB0YXJnZXQuY2xvc2VzdCgnLicgKyB0aGlzLnNldHRpbmdzLnRvcE5hdkl0ZW1DbGFzcyksXG4gICAgICAgICAgICAgICAgcGFuZWwgPSB0YXJnZXQuY2xvc2VzdCgnLicgKyB0aGlzLnNldHRpbmdzLnBhbmVsQ2xhc3MpO1xuICAgICAgICAgICAgaWYgKHRvcGxpLmxlbmd0aCA9PT0gMVxuICAgICAgICAgICAgICAgICAgICAmJiBwYW5lbC5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICAgICAgICAgJiYgdG9wbGkuZmluZCgnLicgKyB0aGlzLnNldHRpbmdzLnBhbmVsQ2xhc3MpLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGlmICghdGFyZ2V0Lmhhc0NsYXNzKHRoaXMuc2V0dGluZ3Mub3BlbkNsYXNzKSkge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwodGhpcywgZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmp1c3RGb2N1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuanVzdEZvY3VzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuanVzdEZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1RvdWNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdG9nZ2xlUGFuZWwuY2FsbCh0aGlzLCBldmVudCwgdGFyZ2V0Lmhhc0NsYXNzKHRoaXMuc2V0dGluZ3Mub3BlbkNsYXNzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBuYW1lIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnV+X2NsaWNrT3V0c2lkZUhhbmRsZXJcbiAgICAgICAgICogQGRlc2MgSGFuZGxlIGNsaWNrIGV2ZW50IG91dHNpZGUgb2YgYSB0aGUgbWVnYW1lbnVcbiAgICAgICAgICogQHBhcmFtIHtldmVudH0gRXZlbnQgb2JqZWN0XG4gICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAqIEBpbm5lclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2NsaWNrT3V0c2lkZUhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmICgkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCh0aGlzLm1lbnUpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwodGhpcywgZXZlbnQsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbmFtZSBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51fl9ET01BdHRyTW9kaWZpZWRIYW5kbGVyXG4gICAgICAgICAqIEBkZXNjIEhhbmRsZSBET01BdHRyTW9kaWZpZWQgZXZlbnQgb24gcGFuZWwgdG8gcmVzcG9uZCB0byBXaW5kb3dzIDggTmFycmF0b3IgRXhwYW5kQ29sbGFwc2UgcGF0dGVyblxuICAgICAgICAgKiBAcGFyYW0ge2V2ZW50fSBFdmVudCBvYmplY3RcbiAgICAgICAgICogQG1lbWJlcm9mIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICogQGlubmVyXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfRE9NQXR0ck1vZGlmaWVkSGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQuYXR0ck5hbWUgPT09ICdhcmlhLWV4cGFuZGVkJ1xuICAgICAgICAgICAgICAgICAgICAmJiBldmVudC5vcmlnaW5hbEV2ZW50Lm5ld1ZhbHVlID09PSAnZmFsc2UnXG4gICAgICAgICAgICAgICAgICAgICYmICQoZXZlbnQudGFyZ2V0KS5oYXNDbGFzcyh0aGlzLnNldHRpbmdzLm9wZW5DbGFzcykpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIF90b2dnbGVQYW5lbC5jYWxsKHRoaXMsIGV2ZW50LCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQG5hbWUgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudX5fZm9jdXNJbkhhbmRsZXJcbiAgICAgICAgICogQGRlc2MgSGFuZGxlIGZvY3VzaW4gZXZlbnQgb24gbWVnYSBtZW51IGl0ZW0uXG4gICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IEV2ZW50IG9iamVjdFxuICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgKiBAaW5uZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9mb2N1c0luSGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZm9jdXNUaW1lb3V0SUQpO1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZXZlbnQudGFyZ2V0KSxcbiAgICAgICAgICAgICAgICBwYW5lbCA9IHRhcmdldC5jbG9zZXN0KCcuJyArIHRoaXMuc2V0dGluZ3MucGFuZWxDbGFzcyk7XG4gICAgICAgICAgICB0YXJnZXRcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3ModGhpcy5zZXR0aW5ncy5mb2N1c0NsYXNzKVxuICAgICAgICAgICAgICAgIC5vbignY2xpY2suYWNjZXNzaWJsZS1tZWdhbWVudScsICQucHJveHkoX2NsaWNrSGFuZGxlciwgdGhpcykpO1xuICAgICAgICAgICAgdGhpcy5qdXN0Rm9jdXNlZCA9ICF0aGlzLm1vdXNlRm9jdXNlZDtcbiAgICAgICAgICAgIHRoaXMubW91c2VGb2N1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5wYW5lbHMubm90KHBhbmVsKS5maWx0ZXIoJy4nICsgdGhpcy5zZXR0aW5ncy5vcGVuQ2xhc3MpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIF90b2dnbGVQYW5lbC5jYWxsKHRoaXMsIGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQG5hbWUgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudX5fZm9jdXNPdXRIYW5kbGVyXG4gICAgICAgICAqIEBkZXNjIEhhbmRsZSBmb2N1c291dCBldmVudCBvbiBtZWdhIG1lbnUgaXRlbS5cbiAgICAgICAgICogQHBhcmFtIHtldmVudH0gRXZlbnQgb2JqZWN0XG4gICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAqIEBpbm5lclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2ZvY3VzT3V0SGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdGhpcy5qdXN0Rm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHRhcmdldCA9ICQoZXZlbnQudGFyZ2V0KSxcbiAgICAgICAgICAgICAgICB0b3BsaSA9IHRhcmdldC5jbG9zZXN0KCcuJyArIHRoaXMuc2V0dGluZ3MudG9wTmF2SXRlbUNsYXNzKSxcbiAgICAgICAgICAgICAgICBrZWVwT3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgdGFyZ2V0XG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKHRoaXMuc2V0dGluZ3MuZm9jdXNDbGFzcylcbiAgICAgICAgICAgICAgICAub2ZmKCdjbGljay5hY2Nlc3NpYmxlLW1lZ2FtZW51Jyk7XG5cbiAgICAgICAgICAgIGlmICh3aW5kb3cuY3ZveCkge1xuICAgICAgICAgICAgICAgIC8vIElmIENocm9tZVZveCBpcyBydW5uaW5nLi4uXG4gICAgICAgICAgICAgICAgdGhhdC5mb2N1c1RpbWVvdXRJRCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY3ZveC5BcGkuZ2V0Q3VycmVudE5vZGUoZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b3BsaS5oYXMobm9kZSkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRoZSBjdXJyZW50IG5vZGUgYmVpbmcgdm9pY2VkIGlzIGluXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG1lZ2EgbWVudSwgY2xlYXJUaW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHRoZSBwYW5lbCBzdGF5cyBvcGVuLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGF0LmZvY3VzVGltZW91dElEKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5mb2N1c1RpbWVvdXRJRCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKHNjb3BlLCBldmVudCwgaGlkZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdG9nZ2xlUGFuZWwuY2FsbChzY29wZSwgZXZlbnQsIGhpZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDI3NSwgdGhhdCwgZXZlbnQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCAyNSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoYXQuZm9jdXNUaW1lb3V0SUQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwodGhhdCwgZXZlbnQsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0sIDMwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBuYW1lIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnV+X2tleURvd25IYW5kbGVyXG4gICAgICAgICAqIEBkZXNjIEhhbmRsZSBrZXlkb3duIGV2ZW50IG9uIG1lZ2EgbWVudS5cbiAgICAgICAgICogQHBhcmFtIHtldmVudH0gRXZlbnQgb2JqZWN0XG4gICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAqIEBpbm5lclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2tleURvd25IYW5kbGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9ICh0aGlzLmNvbnN0cnVjdG9yID09PSBBY2Nlc3NpYmxlTWVnYU1lbnUpID8gdGhpcyA6IF9nZXRQbHVnaW4odGhpcyksIC8vIGRldGVybWluZSB0aGUgQWNjZXNzaWJsZU1lZ2FNZW51IHBsdWdpbiBpbnN0YW5jZVxuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gdGhhdC5zZXR0aW5ncyxcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSAkKCQodGhpcykuaXMoJy4nICsgc2V0dGluZ3MuaG92ZXJDbGFzcyArICc6dGFiYmFibGUnKSA/IHRoaXMgOiBldmVudC50YXJnZXQpLCAvLyBpZiB0aGUgZWxlbWVudCBpcyBob3ZlcmVkIHRoZSB0YXJnZXQgaXMgdGhpcywgb3RoZXJ3aXNlLCBpdHMgdGhlIGZvY3VzZWQgZWxlbWVudFxuICAgICAgICAgICAgICAgIG1lbnUgPSB0aGF0Lm1lbnUsXG4gICAgICAgICAgICAgICAgdG9wbmF2aXRlbXMgPSB0aGF0LnRvcG5hdml0ZW1zLFxuICAgICAgICAgICAgICAgIHRvcGxpID0gdGFyZ2V0LmNsb3Nlc3QoJy4nICsgc2V0dGluZ3MudG9wTmF2SXRlbUNsYXNzKSxcbiAgICAgICAgICAgICAgICB0YWJiYWJsZXMgPSBtZW51LmZpbmQoJzp0YWJiYWJsZScpLFxuICAgICAgICAgICAgICAgIHBhbmVsID0gdGFyZ2V0Lmhhc0NsYXNzKHNldHRpbmdzLnBhbmVsQ2xhc3MpID8gdGFyZ2V0IDogdGFyZ2V0LmNsb3Nlc3QoJy4nICsgc2V0dGluZ3MucGFuZWxDbGFzcyksXG4gICAgICAgICAgICAgICAgcGFuZWxHcm91cHMgPSBwYW5lbC5maW5kKCcuJyArIHNldHRpbmdzLnBhbmVsR3JvdXBDbGFzcyksXG4gICAgICAgICAgICAgICAgY3VycmVudFBhbmVsR3JvdXAgPSB0YXJnZXQuY2xvc2VzdCgnLicgKyBzZXR0aW5ncy5wYW5lbEdyb3VwQ2xhc3MpLFxuICAgICAgICAgICAgICAgIG5leHQsXG4gICAgICAgICAgICAgICAga2V5Y29kZSA9IGV2ZW50LmtleUNvZGUgfHwgZXZlbnQud2hpY2gsXG4gICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgaSxcbiAgICAgICAgICAgICAgICBvLFxuICAgICAgICAgICAgICAgIGxhYmVsLFxuICAgICAgICAgICAgICAgIGZvdW5kID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgbmV3U3RyaW5nID0gS2V5Ym9hcmQua2V5TWFwW2V2ZW50LmtleUNvZGVdIHx8ICcnLFxuICAgICAgICAgICAgICAgIHJlZ2V4LFxuICAgICAgICAgICAgICAgIGlzVG9wTmF2SXRlbSA9ICh0b3BsaS5sZW5ndGggPT09IDEgJiYgcGFuZWwubGVuZ3RoID09PSAwKTtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5pcyhcImlucHV0OmZvY3VzLCBzZWxlY3Q6Zm9jdXMsIHRleHRhcmVhOmZvY3VzLCBidXR0b246Zm9jdXNcIikpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZXZlbnQgdGFyZ2V0IGlzIGEgZm9ybSBlbGVtZW50IHdlIHNob3VsZCBoYW5kbGUga2V5ZG93biBub3JtYWxseVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRhcmdldC5pcygnLicgKyBzZXR0aW5ncy5ob3ZlckNsYXNzICsgJzp0YWJiYWJsZScpKSB7XG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLm9mZigna2V5ZG93bi5hY2Nlc3NpYmxlLW1lZ2FtZW51Jyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHN3aXRjaCAoa2V5Y29kZSkge1xuICAgICAgICAgICAgY2FzZSBLZXlib2FyZC5FU0NBUEU6XG4gICAgICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwodGhhdCwgZXZlbnQsIHRydWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlib2FyZC5ET1dOOlxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgaWYgKGlzVG9wTmF2SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBfdG9nZ2xlUGFuZWwuY2FsbCh0aGF0LCBldmVudCk7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKHRvcGxpLmZpbmQoJy4nICsgc2V0dGluZ3MucGFuZWxDbGFzcyArICcgOnRhYmJhYmxlOmZpcnN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKHRhYmJhYmxlcy5maWx0ZXIoJzpndCgnICsgdGFiYmFibGVzLmluZGV4KHRhcmdldCkgKyAnKTpmaXJzdCcpLmZvY3VzKCkubGVuZ3RoID09PSAxKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kICYmIHdpbmRvdy5vcGVyYSAmJiBvcGVyYS50b1N0cmluZygpID09PSBcIltvYmplY3QgT3BlcmFdXCIgJiYgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFiYmFibGVzID0gJCgnOnRhYmJhYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgIGkgPSB0YWJiYWJsZXMuaW5kZXgodGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSAoJCgnOnRhYmJhYmxlOmd0KCcgKyAkKCc6dGFiYmFibGUnKS5pbmRleCh0YXJnZXQpICsgJyk6Zmlyc3QnKS5mb2N1cygpLmxlbmd0aCA9PT0gMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlib2FyZC5VUDpcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGlmIChpc1RvcE5hdkl0ZW0gJiYgdGFyZ2V0Lmhhc0NsYXNzKHNldHRpbmdzLm9wZW5DbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwodGhhdCwgZXZlbnQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBuZXh0ID0gdG9wbmF2aXRlbXMuZmlsdGVyKCc6bHQoJyArIHRvcG5hdml0ZW1zLmluZGV4KHRvcGxpKSArICcpOmxhc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHQuY2hpbGRyZW4oJy4nICsgc2V0dGluZ3MucGFuZWxDbGFzcykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IChuZXh0LmNoaWxkcmVuKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsICd0cnVlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moc2V0dGluZ3Mub3BlbkNsYXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoJy4nICsgc2V0dGluZ3MucGFuZWxDbGFzcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCc6dGFiYmFibGU6bGFzdCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZvY3VzKCkgPT09IDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghaXNUb3BOYXZJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKHRhYmJhYmxlcy5maWx0ZXIoJzpsdCgnICsgdGFiYmFibGVzLmluZGV4KHRhcmdldCkgKyAnKTpsYXN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghZm91bmQgJiYgd2luZG93Lm9wZXJhICYmIG9wZXJhLnRvU3RyaW5nKCkgPT09IFwiW29iamVjdCBPcGVyYV1cIiAmJiAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSkge1xuICAgICAgICAgICAgICAgICAgICB0YWJiYWJsZXMgPSAkKCc6dGFiYmFibGUnKTtcbiAgICAgICAgICAgICAgICAgICAgaSA9IHRhYmJhYmxlcy5pbmRleCh0YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9ICgkKCc6dGFiYmFibGU6bHQoJyArICQoJzp0YWJiYWJsZScpLmluZGV4KHRhcmdldCkgKyAnKTpmaXJzdCcpLmZvY3VzKCkubGVuZ3RoID09PSAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtleWJvYXJkLlJJR0hUOlxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgaWYgKGlzVG9wTmF2SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9ICh0b3BuYXZpdGVtcy5maWx0ZXIoJzpndCgnICsgdG9wbmF2aXRlbXMuaW5kZXgodG9wbGkpICsgJyk6Zmlyc3QnKS5maW5kKCc6dGFiYmFibGU6Zmlyc3QnKS5mb2N1cygpLmxlbmd0aCA9PT0gMSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhbmVsR3JvdXBzLmxlbmd0aCAmJiBjdXJyZW50UGFuZWxHcm91cC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBjdXJyZW50IHBhbmVsIGNvbnRhaW5zIHBhbmVsIGdyb3VwcywgYW5kIHdlIGFyZSBhYmxlIHRvIGZvY3VzIHRoZSBmaXJzdCB0YWJiYWJsZSBlbGVtZW50IG9mIHRoZSBuZXh0IHBhbmVsIGdyb3VwXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IChwYW5lbEdyb3Vwcy5maWx0ZXIoJzpndCgnICsgcGFuZWxHcm91cHMuaW5kZXgoY3VycmVudFBhbmVsR3JvdXApICsgJyk6Zmlyc3QnKS5maW5kKCc6dGFiYmFibGU6Zmlyc3QnKS5mb2N1cygpLmxlbmd0aCA9PT0gMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9ICh0b3BsaS5maW5kKCc6dGFiYmFibGU6Zmlyc3QnKS5mb2N1cygpLmxlbmd0aCA9PT0gMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtleWJvYXJkLkxFRlQ6XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNUb3BOYXZJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKHRvcG5hdml0ZW1zLmZpbHRlcignOmx0KCcgKyB0b3BuYXZpdGVtcy5pbmRleCh0b3BsaSkgKyAnKTpsYXN0JykuZmluZCgnOnRhYmJhYmxlOmZpcnN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYW5lbEdyb3Vwcy5sZW5ndGggJiYgY3VycmVudFBhbmVsR3JvdXAubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgY3VycmVudCBwYW5lbCBjb250YWlucyBwYW5lbCBncm91cHMsIGFuZCB3ZSBhcmUgYWJsZSB0byBmb2N1cyB0aGUgZmlyc3QgdGFiYmFibGUgZWxlbWVudCBvZiB0aGUgcHJldmlvdXMgcGFuZWwgZ3JvdXBcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKHBhbmVsR3JvdXBzLmZpbHRlcignOmx0KCcgKyBwYW5lbEdyb3Vwcy5pbmRleChjdXJyZW50UGFuZWxHcm91cCkgKyAnKTpsYXN0JykuZmluZCgnOnRhYmJhYmxlOmZpcnN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSAodG9wbGkuZmluZCgnOnRhYmJhYmxlOmZpcnN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlib2FyZC5UQUI6XG4gICAgICAgICAgICAgICAgaSA9IHRhYmJhYmxlcy5pbmRleCh0YXJnZXQpO1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5zaGlmdEtleSAmJiBpc1RvcE5hdkl0ZW0gJiYgdGFyZ2V0Lmhhc0NsYXNzKHNldHRpbmdzLm9wZW5DbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwodGhhdCwgZXZlbnQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBuZXh0ID0gdG9wbmF2aXRlbXMuZmlsdGVyKCc6bHQoJyArIHRvcG5hdml0ZW1zLmluZGV4KHRvcGxpKSArICcpOmxhc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHQuY2hpbGRyZW4oJy4nICsgc2V0dGluZ3MucGFuZWxDbGFzcykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IG5leHQuY2hpbGRyZW4oKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhzZXR0aW5ncy5vcGVuQ2xhc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcignLicgKyBzZXR0aW5ncy5wYW5lbENsYXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdhcmlhLWhpZGRlbicsICdmYWxzZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmQoJzp0YWJiYWJsZTpsYXN0JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuc2hpZnRLZXkgJiYgaSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSAodGFiYmFibGVzLmZpbHRlcignOmx0KCcgKyBpICsgJyk6bGFzdCcpLmZvY3VzKCkubGVuZ3RoID09PSAxKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFldmVudC5zaGlmdEtleSAmJiBpIDwgdGFiYmFibGVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSAodGFiYmFibGVzLmZpbHRlcignOmd0KCcgKyBpICsgJyk6Zmlyc3QnKS5mb2N1cygpLmxlbmd0aCA9PT0gMSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cub3BlcmEgJiYgb3BlcmEudG9TdHJpbmcoKSA9PT0gXCJbb2JqZWN0IE9wZXJhXVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmJhYmxlcyA9ICQoJzp0YWJiYWJsZScpO1xuICAgICAgICAgICAgICAgICAgICBpID0gdGFiYmFibGVzLmluZGV4KHRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSAoJCgnOnRhYmJhYmxlOmx0KCcgKyAkKCc6dGFiYmFibGUnKS5pbmRleCh0YXJnZXQpICsgJyk6bGFzdCcpLmZvY3VzKCkubGVuZ3RoID09PSAxKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKCQoJzp0YWJiYWJsZTpndCgnICsgJCgnOnRhYmJhYmxlJykuaW5kZXgodGFyZ2V0KSArICcpOmZpcnN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGZvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlib2FyZC5TUEFDRTpcbiAgICAgICAgICAgICAgICBpZiAoaXNUb3BOYXZJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIF9jbGlja0hhbmRsZXIuY2FsbCh0aGF0LCBldmVudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlib2FyZC5FTlRFUjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgLy8gYWxwaGFudW1lcmljIGZpbHRlclxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmtleWRvd25UaW1lb3V0SUQpO1xuXG4gICAgICAgICAgICAgICAga2V5ZG93blNlYXJjaFN0cmluZyArPSBuZXdTdHJpbmcgIT09IGtleWRvd25TZWFyY2hTdHJpbmcgPyBuZXdTdHJpbmcgOiAnJztcblxuICAgICAgICAgICAgICAgIGlmIChrZXlkb3duU2VhcmNoU3RyaW5nLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5rZXlkb3duVGltZW91dElEID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGtleWRvd25TZWFyY2hTdHJpbmcgPSAnJztcbiAgICAgICAgICAgICAgICB9LCBrZXlkb3duVGltZW91dER1cmF0aW9uKTtcblxuICAgICAgICAgICAgICAgIGlmIChpc1RvcE5hdkl0ZW0gJiYgIXRhcmdldC5oYXNDbGFzcyhzZXR0aW5ncy5vcGVuQ2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmJhYmxlcyA9IHRhYmJhYmxlcy5maWx0ZXIoJzpub3QoLicgKyBzZXR0aW5ncy5wYW5lbENsYXNzICsgJyA6dGFiYmFibGUpJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFiYmFibGVzID0gdG9wbGkuZmluZCgnOnRhYmJhYmxlJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmJhYmxlcyA9ICQodGFiYmFibGVzLmdldCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmV2ZXJzZSgpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGFiYmFibGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIG8gPSB0YWJiYWJsZXMuZXEoaSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvLmlzKHRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gKGtleWRvd25TZWFyY2hTdHJpbmcubGVuZ3RoID09PSAxKSA/IGkgKyAxIDogaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIGtleWRvd25TZWFyY2hTdHJpbmcucmVwbGFjZSgvW1xcLVxcW1xcXXt9KCkqKz8uLFxcXFxcXF4kfCNcXHNdL2csICdcXFxcJCYnKSwgJ2knKTtcblxuICAgICAgICAgICAgICAgIGZvciAoaSA9IHN0YXJ0OyBpIDwgdGFiYmFibGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIG8gPSB0YWJiYWJsZXMuZXEoaSk7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsID0gJC50cmltKG8udGV4dCgpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZ2V4LnRlc3QobGFiZWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBvLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzdGFydDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvID0gdGFiYmFibGVzLmVxKGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAkLnRyaW0oby50ZXh0KCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlZ2V4LnRlc3QobGFiZWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgby5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhhdC5qdXN0Rm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbmFtZSBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51fl9tb3VzZURvd25IYW5kbGVyXG4gICAgICAgICAqIEBkZXNjIEhhbmRsZSBtb3VzZWRvd24gZXZlbnQgb24gbWVnYSBtZW51LlxuICAgICAgICAgKiBAcGFyYW0ge2V2ZW50fSBFdmVudCBvYmplY3RcbiAgICAgICAgICogQG1lbWJlcm9mIGFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgKiBAaW5uZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9tb3VzZURvd25IYW5kbGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoJChldmVudC50YXJnZXQpLmlzKHRoaXMuc2V0dGluZ3MucGFuZWxDbGFzcykgfHwgJChldmVudC50YXJnZXQpLmNsb3Nlc3QoXCI6Zm9jdXNhYmxlXCIpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMubW91c2VGb2N1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubW91c2VUaW1lb3V0SUQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5mb2N1c1RpbWVvdXRJRCk7XG4gICAgICAgICAgICB9LCAxKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQG5hbWUgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudX5fbW91c2VPdmVySGFuZGxlclxuICAgICAgICAgKiBAZGVzYyBIYW5kbGUgbW91c2VvdmVyIGV2ZW50IG9uIG1lZ2EgbWVudS5cbiAgICAgICAgICogQHBhcmFtIHtldmVudH0gRXZlbnQgb2JqZWN0XG4gICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAqIEBpbm5lclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX21vdXNlT3ZlckhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLm1vdXNlVGltZW91dElEKTtcbiAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyh0aGlzLnNldHRpbmdzLmhvdmVyQ2xhc3MpO1xuICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwodGhpcywgZXZlbnQpO1xuICAgICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5pcygnOnRhYmJhYmxlJykpIHtcbiAgICAgICAgICAgICAgICAkKCdodG1sJykub24oJ2tleWRvd24uYWNjZXNzaWJsZS1tZWdhbWVudScsICQucHJveHkoX2tleURvd25IYW5kbGVyLCBldmVudC50YXJnZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQG5hbWUgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudX5fbW91c2VPdXRIYW5kbGVyXG4gICAgICAgICAqIEBkZXNjIEhhbmRsZSBtb3VzZW91dCBldmVudCBvbiBtZWdhIG1lbnUuXG4gICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IEV2ZW50IG9iamVjdFxuICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgKiBAaW5uZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9tb3VzZU91dEhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyh0aGF0LnNldHRpbmdzLmhvdmVyQ2xhc3MpO1xuXG4gICAgICAgICAgICB0aGF0Lm1vdXNlVGltZW91dElEID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwodGhhdCwgZXZlbnQsIHRydWUpO1xuICAgICAgICAgICAgfSwgMjUwKTtcbiAgICAgICAgICAgIGlmICgkKGV2ZW50LnRhcmdldCkuaXMoJzp0YWJiYWJsZScpKSB7XG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLm9mZigna2V5ZG93bi5hY2Nlc3NpYmxlLW1lZ2FtZW51Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgX3RvZ2dsZUV4cGFuZGVkRXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uIChoaWRlKSB7XG4gICAgICAgICAgICB2YXIgbWVudSA9IHRoaXMubWVudTtcbiAgICAgICAgICAgIGlmIChoaWRlKSB7XG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLm9mZignbW91c2V1cC5vdXRzaWRlLWFjY2Vzc2libGUtbWVnYW1lbnUsIHRvdWNoZW5kLm91dHNpZGUtYWNjZXNzaWJsZS1tZWdhbWVudSwgbXNwb2ludGVydXAub3V0c2lkZS1hY2Nlc3NpYmxlLW1lZ2FtZW51LCAgcG9pbnRlcnVwLm91dHNpZGUtYWNjZXNzaWJsZS1tZWdhbWVudScpO1xuXG4gICAgICAgICAgICAgICAgbWVudS5maW5kKCdbYXJpYS1leHBhbmRlZF0uJyArIHRoaXMuc2V0dGluZ3MucGFuZWxDbGFzcykub2ZmKCdET01BdHRyTW9kaWZpZWQuYWNjZXNzaWJsZS1tZWdhbWVudScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCdodG1sJykub24oJ21vdXNldXAub3V0c2lkZS1hY2Nlc3NpYmxlLW1lZ2FtZW51LCB0b3VjaGVuZC5vdXRzaWRlLWFjY2Vzc2libGUtbWVnYW1lbnUsIG1zcG9pbnRlcnVwLm91dHNpZGUtYWNjZXNzaWJsZS1tZWdhbWVudSwgIHBvaW50ZXJ1cC5vdXRzaWRlLWFjY2Vzc2libGUtbWVnYW1lbnUnLCAkLnByb3h5KF9jbGlja091dHNpZGVIYW5kbGVyLCB0aGlzKSk7XG5cbiAgICAgICAgICAgICAgICAvKiBOYXJyYXRvciBpbiBXaW5kb3dzIDggYXV0b21hdGljYWxseSB0b2dnbGVzIHRoZSBhcmlhLWV4cGFuZGVkIHByb3BlcnR5IG9uIGRvdWJsZSB0YXAgb3IgY2xpY2suXG4gICAgICAgICAgICAgICAgICAgVG8gcmVzcG9uZCB0byB0aGUgY2hhbmdlIHRvIGNvbGxhcHNlIHRoZSBwYW5lbCwgd2UgbXVzdCBhZGQgYSBsaXN0ZW5lciBmb3IgYSBET01BdHRyTW9kaWZpZWQgZXZlbnQuICovXG4gICAgICAgICAgICAgICAgbWVudS5maW5kKCdbYXJpYS1leHBhbmRlZD10cnVlXS4nICsgdGhpcy5zZXR0aW5ncy5wYW5lbENsYXNzKS5vbignRE9NQXR0ck1vZGlmaWVkLmFjY2Vzc2libGUtbWVnYW1lbnUnLCAkLnByb3h5KF9ET01BdHRyTW9kaWZpZWRIYW5kbGVyLCB0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyogcHVibGljIGF0dHJpYnV0ZXMgYW5kIG1ldGhvZHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29uc3RydWN0b3I6IEFjY2Vzc2libGVNZWdhTWVudSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbGVuZHMgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgICAgICogQGRlc2MgSW5pdGlhbGl6ZXMgYW4gaW5zdGFuY2Ugb2YgdGhlIGFjY2Vzc2libGVNZWdhTWVudSBwbHVnaW5zXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB0aGlzLnNldHRpbmdzLFxuICAgICAgICAgICAgICAgICAgICBuYXYgPSAkKHRoaXMuZWxlbWVudCksXG4gICAgICAgICAgICAgICAgICAgIG1lbnUgPSBuYXYuY2hpbGRyZW4oKS5maXJzdCgpLFxuICAgICAgICAgICAgICAgICAgICB0b3BuYXZpdGVtcyA9IG1lbnUuY2hpbGRyZW4oKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0KHNldHRpbmdzLCBuYXYsIG1lbnUsIHRvcG5hdml0ZW1zKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbihzZXR0aW5ncywgbmF2LCBtZW51LCB0b3BuYXZpdGVtcykge1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICAgICAgICAgICAgdGhpcy5tZW51ID0gbWVudTtcbiAgICAgICAgICAgICAgICB0aGlzLnRvcG5hdml0ZW1zID0gdG9wbmF2aXRlbXM7XG5cbiAgICAgICAgICAgICAgICBuYXYuYXR0cihcInJvbGVcIiwgXCJuYXZpZ2F0aW9uXCIpO1xuICAgICAgICAgICAgICAgIG1lbnUuYWRkQ2xhc3Moc2V0dGluZ3MubWVudUNsYXNzKTtcbiAgICAgICAgICAgICAgICB0b3BuYXZpdGVtcy5lYWNoKGZ1bmN0aW9uIChpLCB0b3BuYXZpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3BuYXZpdGVtbGluaywgdG9wbmF2aXRlbXBhbmVsO1xuICAgICAgICAgICAgICAgICAgICB0b3BuYXZpdGVtID0gJCh0b3BuYXZpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgdG9wbmF2aXRlbS5hZGRDbGFzcyhzZXR0aW5ncy50b3BOYXZJdGVtQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICB0b3BuYXZpdGVtbGluayA9IHRvcG5hdml0ZW0uZmluZChcIjp0YWJiYWJsZTpmaXJzdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdG9wbmF2aXRlbXBhbmVsID0gdG9wbmF2aXRlbS5jaGlsZHJlbihcIjpub3QoOnRhYmJhYmxlKTpsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICBfYWRkVW5pcXVlSWQuY2FsbCh0aGF0LCB0b3BuYXZpdGVtbGluayk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0b3BuYXZpdGVtcGFuZWwubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYWRkVW5pcXVlSWQuY2FsbCh0aGF0LCB0b3BuYXZpdGVtcGFuZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wbmF2aXRlbWxpbmsuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcmlhLWhhc3BvcHVwXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcmlhLWNvbnRyb2xzXCI6IHRvcG5hdml0ZW1wYW5lbC5hdHRyKFwiaWRcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcmlhLWV4cGFuZGVkXCI6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wbmF2aXRlbXBhbmVsLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicm9sZVwiOiBcImdyb3VwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcmlhLWV4cGFuZGVkXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXJpYS1oaWRkZW5cIjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moc2V0dGluZ3MucGFuZWxDbGFzcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubm90KFwiW2FyaWEtbGFiZWxsZWRieV1cIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImFyaWEtbGFiZWxsZWRieVwiLCB0b3BuYXZpdGVtbGluay5hdHRyKFwiaWRcIikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnBhbmVscyA9IG1lbnUuZmluZChcIi5cIiArIHNldHRpbmdzLnBhbmVsQ2xhc3MpO1xuXG4gICAgICAgICAgICAgICAgbWVudS5vbihcImZvY3VzaW4uYWNjZXNzaWJsZS1tZWdhbWVudVwiLCBcIjpmb2N1c2FibGUsIC5cIiArIHNldHRpbmdzLnBhbmVsQ2xhc3MsICQucHJveHkoX2ZvY3VzSW5IYW5kbGVyLCB0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwiZm9jdXNvdXQuYWNjZXNzaWJsZS1tZWdhbWVudVwiLCBcIjpmb2N1c2FibGUsIC5cIiArIHNldHRpbmdzLnBhbmVsQ2xhc3MsICQucHJveHkoX2ZvY3VzT3V0SGFuZGxlciwgdGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcImtleWRvd24uYWNjZXNzaWJsZS1tZWdhbWVudVwiLCAkLnByb3h5KF9rZXlEb3duSGFuZGxlciwgdGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3Zlci5hY2Nlc3NpYmxlLW1lZ2FtZW51XCIsICQucHJveHkoX21vdXNlT3ZlckhhbmRsZXIsIHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAub24oXCJtb3VzZW91dC5hY2Nlc3NpYmxlLW1lZ2FtZW51XCIsICQucHJveHkoX21vdXNlT3V0SGFuZGxlciwgdGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlZG93bi5hY2Nlc3NpYmxlLW1lZ2FtZW51XCIsICQucHJveHkoX21vdXNlRG93bkhhbmRsZXIsIHRoaXMpKTtcblxuICAgICAgICAgICAgICAgIGlmIChpc1RvdWNoKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbnUub24oXCJ0b3VjaHN0YXJ0LmFjY2Vzc2libGUtbWVnYW1lbnVcIiwgICQucHJveHkoX2NsaWNrSGFuZGxlciwgdGhpcykpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG1lbnUuZmluZChcImhyXCIpLmF0dHIoXCJyb2xlXCIsIFwic2VwYXJhdG9yXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkuY2xvc2VzdChtZW51KS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkudHJpZ2dlcihcImZvY3VzaW4uYWNjZXNzaWJsZS1tZWdhbWVudVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBkZXNjIEdldCBkZWZhdWx0IHZhbHVlc1xuICAgICAgICAgICAgICogQGV4YW1wbGUgJChzZWxlY3RvcikuYWNjZXNzaWJsZU1lZ2FNZW51KFwiZ2V0RGVmYXVsdHNcIik7XG4gICAgICAgICAgICAgKiBAcmV0dXJuIHtvYmplY3R9XG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGdldERlZmF1bHRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHRzO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAZGVzYyBHZXQgYW55IG9wdGlvbiBzZXQgdG8gcGx1Z2luIHVzaW5nIGl0cyBuYW1lIChhcyBzdHJpbmcpXG4gICAgICAgICAgICAgKiBAZXhhbXBsZSAkKHNlbGVjdG9yKS5hY2Nlc3NpYmxlTWVnYU1lbnUoXCJnZXRPcHRpb25cIiwgc29tZV9vcHRpb24pO1xuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG9wdFxuICAgICAgICAgICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAgICAgICAgICogQG1lbWJlcm9mIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBnZXRPcHRpb246IGZ1bmN0aW9uIChvcHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5nc1tvcHRdO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAZGVzYyBHZXQgYWxsIG9wdGlvbnNcbiAgICAgICAgICAgICAqIEBleGFtcGxlICQoc2VsZWN0b3IpLmFjY2Vzc2libGVNZWdhTWVudShcImdldEFsbE9wdGlvbnNcIik7XG4gICAgICAgICAgICAgKiBAcmV0dXJuIHtvYmplY3R9XG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGdldEFsbE9wdGlvbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncztcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQGRlc2MgU2V0IG9wdGlvblxuICAgICAgICAgICAgICogQGV4YW1wbGUgJChzZWxlY3RvcikuYWNjZXNzaWJsZU1lZ2FNZW51KFwic2V0T3B0aW9uXCIsIFwib3B0aW9uX25hbWVcIiwgIFwib3B0aW9uX3ZhbHVlXCIsICByZWluaXRpYWxpemUpO1xuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG9wdCAtIE9wdGlvbiBuYW1lXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsIC0gT3B0aW9uIHZhbHVlXG4gICAgICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtyZWluaXRpYWxpemVdIC0gYm9vbGVhbiB0byByZS1pbml0aWFsaXplIHRoZSBtZW51LlxuICAgICAgICAgICAgICogQG1lbWJlcm9mIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBzZXRPcHRpb246IGZ1bmN0aW9uIChvcHQsIHZhbHVlLCByZWluaXRpYWxpemUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzW29wdF0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBpZiAocmVpbml0aWFsaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KCkpO1xuXG4gICAgLyogbGlnaHR3ZWlnaHQgcGx1Z2luIHdyYXBwZXIgYXJvdW5kIHRoZSBjb25zdHJ1Y3RvcixcbiAgICAgICB0byBwcmV2ZW50IGFnYWluc3QgbXVsdGlwbGUgaW5zdGFudGlhdGlvbnMgKi9cblxuICAgIC8qKlxuICAgICAqIEBjbGFzcyBhY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgKiBAbWVtYmVyT2YgalF1ZXJ5LmZuXG4gICAgICogQGNsYXNzZGVzYyBJbXBsZW1lbnRzIGFuIGFjY2Vzc2libGUgbWVnYSBtZW51IGFzIGEgalF1ZXJ5IHBsdWdpbi5cbiAgICAgKiA8cD5UaGUgbWVnYS1tZW51IEl0IGlzIG1vZGVsZWQgYWZ0ZXIgdGhlIG1lZ2EgbWVudSBvbiB7QGxpbmsgaHR0cDovL2Fkb2JlLmNvbXxhZG9iZS5jb219IGJ1dCBoYXMgYmVlbiBzaW1wbGlmaWVkIGZvciB1c2UgYnkgb3RoZXJzLiBBIGJyaWVmIGRlc2NyaXB0aW9uIG9mIHRoZSBpbnRlcmFjdGlvbiBkZXNpZ24gY2hvaWNlcyBjYW4gYmUgZm91bmQgaW4gYSBibG9nIHBvc3QgYXQge0BsaW5rIGh0dHA6Ly9ibG9ncy5hZG9iZS5jb20vYWNjZXNzaWJpbGl0eS8yMDEzLzA1L2Fkb2JlLWNvbS5odG1sfE1lZ2EgbWVudSBhY2Nlc3NpYmlsaXR5IG9uIGFkb2JlLmNvbX0uPC9wPlxuICAgICAqIDxoMz5LZXlib2FyZCBBY2Nlc3NpYmlsaXR5PC9oMz5cbiAgICAgKiA8cD5UaGUgYWNjZXNzaWJsZSBtZWdhIG1lbnUgc3VwcG9ydHMga2V5Ym9hcmQgaW50ZXJhY3Rpb24gbW9kZWxlZCBhZnRlciB0aGUgYmVoYXZpb3IgZGVzY3JpYmVkIGluIHRoZSB7QGxpbmsgaHR0cDovL3d3dy53My5vcmcvVFIvd2FpLWFyaWEtcHJhY3RpY2VzLyNtZW51fFdBSS1BUklBIE1lbnUgb3IgTWVudSBiYXIgKHdpZGdldCkgZGVzaWduIHBhdHRlcm59LCBob3dldmVyIHdlIGFsc28gdHJ5IHRvIHJlc3BlY3QgdXNlcnMnIGdlbmVyYWwgZXhwZWN0YXRpb25zIGZvciB0aGUgYmVoYXZpb3Igb2YgbGlua3MgaW4gYSBnbG9iYWwgbmF2aWdhdGlvbi4gVG8gdGhpcyBlbmQsIHRoZSBhY2Nlc3NpYmxlIG1lZ2EgbWVudSBpbXBsZW1lbnRhdGlvbiBwZXJtaXRzIHRhYiBmb2N1cyBvbiBlYWNoIG9mIHRoZSBzaXggdG9wLWxldmVsIG1lbnUgaXRlbXMuIFdoZW4gb25lIG9mIHRoZSBtZW51IGl0ZW1zIGhhcyBmb2N1cywgcHJlc3NpbmcgdGhlIEVudGVyIGtleSwgU3BhY2ViYXIgb3IgRG93biBhcnJvdyB3aWxsIG9wZW4gdGhlIHN1Ym1lbnUgcGFuZWwsIGFuZCBwcmVzc2luZyB0aGUgTGVmdCBvciBSaWdodCBhcnJvdyBrZXkgd2lsbCBzaGlmdCBmb2N1cyB0byB0aGUgYWRqYWNlbnQgbWVudSBpdGVtLiBMaW5rcyB3aXRoaW4gdGhlIHN1Ym1lbnUgcGFuZWxzIGFyZSBpbmNsdWRlZCBpbiB0aGUgdGFiIG9yZGVyIHdoZW4gdGhlIHBhbmVsIGlzIG9wZW4uIFRoZXkgY2FuIGFsc28gYmUgbmF2aWdhdGVkIHdpdGggdGhlIGFycm93IGtleXMgb3IgYnkgdHlwaW5nIHRoZSBmaXJzdCBjaGFyYWN0ZXIgaW4gdGhlIGxpbmsgbmFtZSwgd2hpY2ggc3BlZWRzIHVwIGtleWJvYXJkIG5hdmlnYXRpb24gY29uc2lkZXJhYmx5LiBQcmVzc2luZyB0aGUgRXNjYXBlIGtleSBjbG9zZXMgdGhlIHN1Ym1lbnUgYW5kIHJlc3RvcmVzIGZvY3VzIHRvIHRoZSBwYXJlbnQgbWVudSBpdGVtLjwvcD5cbiAgICAgKiA8aDM+U2NyZWVuIFJlYWRlciBBY2Nlc3NpYmlsaXR5PC9oMz5cbiAgICAgKiA8cD5UaGUgYWNjZXNzaWJsZSBtZWdhIG1lbnUgbW9kZWxzIGl0cyB1c2Ugb2YgV0FJLUFSSUEgUm9sZXMsIFN0YXRlcywgYW5kIFByb3BlcnRpZXMgYWZ0ZXIgdGhvc2UgZGVzY3JpYmVkIGluIHRoZSB7QGxpbmsgaHR0cDovL3d3dy53My5vcmcvVFIvd2FpLWFyaWEtcHJhY3RpY2VzLyNtZW51fFdBSS1BUklBIE1lbnUgb3IgTWVudSBiYXIgKHdpZGdldCkgZGVzaWduIHBhdHRlcm59IHdpdGggc29tZSBub3RhYmxlIGV4Y2VwdGlvbnMsIHNvIHRoYXQgaXQgYmVoYXZlcyBiZXR0ZXIgd2l0aCBzY3JlZW4gcmVhZGVyIHVzZXIgZXhwZWN0YXRpb25zIGZvciBnbG9iYWwgbmF2aWdhdGlvbi4gV2UgZG9uJ3QgdXNlIDxjb2RlIGNsYXNzPVwicHJldHR5cHJpbnQgcHJldHR5cHJpbnRlZFwiIHN0eWxlPVwiXCI+PHNwYW4gY2xhc3M9XCJwbG5cIj5yb2xlPC9zcGFuPjxzcGFuIGNsYXNzPVwicHVuXCI+PTwvc3Bhbj48c3BhbiBjbGFzcz1cInN0clwiPlwibWVudVwiPC9zcGFuPjwvY29kZT4gZm9yIHRoZSBtZW51IGNvbnRhaW5lciBhbmQgPGNvZGUgY2xhc3M9XCJwcmV0dHlwcmludCBwcmV0dHlwcmludGVkXCIgc3R5bGU9XCJcIj48c3BhbiBjbGFzcz1cInBsblwiPnJvbGU8L3NwYW4+PHNwYW4gY2xhc3M9XCJwdW5cIj49PC9zcGFuPjxzcGFuIGNsYXNzPVwic3RyXCI+XCJtZW51aXRlbVwiPC9zcGFuPjwvY29kZT4gZm9yIGVhY2ggb2YgdGhlIGxpbmtzIHRoZXJlaW4sIGJlY2F1c2UgaWYgd2UgZG8sIGFzc2lzdGl2ZSB0ZWNobm9sb2d5IHdpbGwgbm8gbG9uZ2VyIGludGVycHJldCB0aGUgbGlua3MgYXMgbGlua3MsIGJ1dCBpbnN0ZWFkLCBhcyBtZW51IGl0ZW1zLCBhbmQgdGhlIGxpbmtzIGluIG91ciBnbG9iYWwgbmF2aWdhdGlvbiB3aWxsIG5vIGxvbmdlciBzaG93IHVwIHdoZW4gYSBzY3JlZW4gcmVhZGVyIHVzZXIgZXhlY3V0ZXMgYSBzaG9ydGN1dCBjb21tYW5kIHRvIGJyaW5nIHVwIGEgbGlzdCBvZiBsaW5rcyBpbiB0aGUgcGFnZS48L3A+XG4gICAgICogQGV4YW1wbGUgPGg0PkhUTUw8L2g0Pjxoci8+XG4mbHQ7bmF2Jmd0O1xuICAgICZsdDt1bCBjbGFzcz0mcXVvdDtuYXYtbWVudSZxdW90OyZndDtcbiAgICAgICAgJmx0O2xpIGNsYXNzPSZxdW90O25hdi1pdGVtJnF1b3Q7Jmd0O1xuICAgICAgICAgICAgJmx0O2EgaHJlZj0mcXVvdDs/bW92aWUmcXVvdDsmZ3Q7TW92aWVzJmx0Oy9hJmd0O1xuICAgICAgICAgICAgJmx0O2RpdiBjbGFzcz0mcXVvdDtzdWItbmF2JnF1b3Q7Jmd0O1xuICAgICAgICAgICAgICAgICZsdDt1bCBjbGFzcz0mcXVvdDtzdWItbmF2LWdyb3VwJnF1b3Q7Jmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7Jmx0O2EgaHJlZj0mcXVvdDs/bW92aWUmYW1wO2dlbnJlPTAmcXVvdDsmZ3Q7QWN0aW9uICZhbXA7YW1wOyBBZHZlbnR1cmUmbHQ7L2EmZ3Q7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZsdDthIGhyZWY9JnF1b3Q7P21vdmllJmFtcDtnZW5yZT0yJnF1b3Q7Jmd0O0NoaWxkcmVuICZhbXA7YW1wOyBGYW1pbHkmbHQ7L2EmZ3Q7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZhbXA7IzgyMzA7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAmbHQ7L3VsJmd0O1xuICAgICAgICAgICAgICAgICZsdDt1bCBjbGFzcz0mcXVvdDtzdWItbmF2LWdyb3VwJnF1b3Q7Jmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7Jmx0O2EgaHJlZj0mcXVvdDs/bW92aWUmYW1wO2dlbnJlPTcmcXVvdDsmZ3Q7RHJhbWFzJmx0Oy9hJmd0OyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmbHQ7YSBocmVmPSZxdW90Oz9tb3ZpZSZhbXA7Z2VucmU9OSZxdW90OyZndDtGb3JlaWduJmx0Oy9hJmd0OyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmYW1wOyM4MjMwOyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgJmx0Oy91bCZndDtcbiAgICAgICAgICAgICAgICAmbHQ7dWwgY2xhc3M9JnF1b3Q7c3ViLW5hdi1ncm91cCZxdW90OyZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZsdDthIGhyZWY9JnF1b3Q7P21vdmllJmFtcDtnZW5yZT0xNCZxdW90OyZndDtNdXNpY2FscyZsdDsvYSZndDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7Jmx0O2EgaHJlZj0mcXVvdDs/bW92aWUmYW1wO2dlbnJlPTE1JnF1b3Q7Jmd0O1JvbWFuY2UmbHQ7L2EmZ3Q7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZhbXA7IzgyMzA7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAmbHQ7L3VsJmd0O1xuICAgICAgICAgICAgJmx0Oy9kaXYmZ3Q7XG4gICAgICAgICZsdDsvbGkmZ3Q7XG4gICAgICAgICZsdDtsaSBjbGFzcz0mcXVvdDtuYXYtaXRlbSZxdW90OyZndDtcbiAgICAgICAgICAgICZsdDthIGhyZWY9JnF1b3Q7P3R2JnF1b3Q7Jmd0O1RWIFNob3dzJmx0Oy9hJmd0O1xuICAgICAgICAgICAgJmx0O2RpdiBjbGFzcz0mcXVvdDtzdWItbmF2JnF1b3Q7Jmd0O1xuICAgICAgICAgICAgICAgICZsdDt1bCBjbGFzcz0mcXVvdDtzdWItbmF2LWdyb3VwJnF1b3Q7Jmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7Jmx0O2EgaHJlZj0mcXVvdDs/dHYmYW1wO2dlbnJlPTIwJnF1b3Q7Jmd0O0NsYXNzaWMgVFYmbHQ7L2EmZ3Q7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZsdDthIGhyZWY9JnF1b3Q7P3R2JmFtcDtnZW5yZT0yMSZxdW90OyZndDtDcmltZSBUViZsdDsvYSZndDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7JmFtcDsjODIzMDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICZsdDsvdWwmZ3Q7XG4gICAgICAgICAgICAgICAgJmx0O3VsIGNsYXNzPSZxdW90O3N1Yi1uYXYtZ3JvdXAmcXVvdDsmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmbHQ7YSBocmVmPSZxdW90Oz90diZhbXA7Z2VucmU9MjcmcXVvdDsmZ3Q7UmVhbGl0eSBUViZsdDsvYSZndDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7Jmx0O2EgaHJlZj0mcXVvdDs/dHYmYW1wO2dlbnJlPTMwJnF1b3Q7Jmd0O1RWIEFjdGlvbiZsdDsvYSZndDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7JmFtcDsjODIzMDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICZsdDsvdWwmZ3Q7XG4gICAgICAgICAgICAgICAgJmx0O3VsIGNsYXNzPSZxdW90O3N1Yi1uYXYtZ3JvdXAmcXVvdDsmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmbHQ7YSBocmVmPSZxdW90Oz90diZhbXA7Z2VucmU9MzMmcXVvdDsmZ3Q7VFYgRHJhbWFzJmx0Oy9hJmd0OyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmbHQ7YSBocmVmPSZxdW90Oz90diZhbXA7Z2VucmU9MzQmcXVvdDsmZ3Q7VFYgSG9ycm9yJmx0Oy9hJmd0OyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmYW1wOyM4MjMwOyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgJmx0Oy91bCZndDtcbiAgICAgICAgICAgICZsdDsvZGl2Jmd0O1xuICAgICAgICAmbHQ7L2xpJmd0O1xuICAgICZsdDsvdWwmZ3Q7XG4mbHQ7L25hdiZndDtcbiAgICAgKiBAZXhhbXBsZSA8aDQ+Q1NTPC9oND48aHIvPlxuJiM0NzsqIFJ1ZGltZW50YXJ5IG1lZ2EgbWVudSBDU1MgZm9yIGRlbW9uc3RyYXRpb24gKiYjNDc7XG5cbiYjNDc7KiBtZWdhIG1lbnUgbGlzdCAqJiM0Nztcbi5uYXYtbWVudSB7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIGxpc3Qtc3R5bGU6IG5vbmU7XG4gICAgbWFyZ2luOiAwO1xuICAgIHBhZGRpbmc6IDA7XG4gICAgei1pbmRleDogMTU7XG59XG5cbiYjNDc7KiBhIHRvcCBsZXZlbCBuYXZpZ2F0aW9uIGl0ZW0gaW4gdGhlIG1lZ2EgbWVudSAqJiM0Nztcbi5uYXYtaXRlbSB7XG4gICAgbGlzdC1zdHlsZTogbm9uZTtcbiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgcGFkZGluZzogMDtcbiAgICBtYXJnaW46IDA7XG59XG5cbiYjNDc7KiBmaXJzdCBkZXNjZW5kYW50IGxpbmsgd2l0aGluIGEgdG9wIGxldmVsIG5hdmlnYXRpb24gaXRlbSAqJiM0Nztcbi5uYXYtaXRlbSAmZ3Q7IGEge1xuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgcGFkZGluZzogMC41ZW0gMWVtO1xuICAgIG1hcmdpbjogMCAwIC0xcHggMDtcbiAgICBib3JkZXI6IDFweCBzb2xpZCB0cmFuc3BhcmVudDtcbn1cblxuJiM0NzsqIGZvY3VzL29wZW4gc3RhdGVzIG9mIGZpcnN0IGRlc2NlbmRhbnQgbGluayB3aXRoaW4gYSB0b3AgbGV2ZWxcbiAgIG5hdmlnYXRpb24gaXRlbSAqJiM0Nztcbi5uYXYtaXRlbSAmZ3Q7IGE6Zm9jdXMsXG4ubmF2LWl0ZW0gJmd0OyBhLm9wZW4ge1xuICAgIGJvcmRlcjogMXB4IHNvbGlkICNkZWRlZGU7XG59XG5cbiYjNDc7KiBvcGVuIHN0YXRlIG9mIGZpcnN0IGRlc2NlbmRhbnQgbGluayB3aXRoaW4gYSB0b3AgbGV2ZWxcbiAgIG5hdmlnYXRpb24gaXRlbSAqJiM0Nztcbi5uYXYtaXRlbSAmZ3Q7IGEub3BlbiB7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcbiAgICBib3JkZXItYm90dG9tOiBub25lO1xuICAgIHotaW5kZXg6IDE7XG59XG5cbiYjNDc7KiBzdWItbmF2aWdhdGlvbiBwYW5lbCAqJiM0Nztcbi5zdWItbmF2IHtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgZGlzcGxheTogbm9uZTtcbiAgICB0b3A6IDIuMmVtO1xuICAgIG1hcmdpbi10b3A6IC0xcHg7XG4gICAgcGFkZGluZzogMC41ZW0gMWVtO1xuICAgIGJvcmRlcjogMXB4IHNvbGlkICNkZWRlZGU7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcbn1cblxuJiM0NzsqIHN1Yi1uYXZpZ2F0aW9uIHBhbmVsIG9wZW4gc3RhdGUgKiYjNDc7XG4uc3ViLW5hdi5vcGVuIHtcbiAgICBkaXNwbGF5OiBibG9jaztcbn1cblxuJiM0NzsqIGxpc3Qgb2YgaXRlbXMgd2l0aGluIHN1Yi1uYXZpZ2F0aW9uIHBhbmVsIComIzQ3O1xuLnN1Yi1uYXYgdWwge1xuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wO1xuICAgIG1hcmdpbjogMCAxZW0gMCAwO1xuICAgIHBhZGRpbmc6IDA7XG59XG5cbiYjNDc7KiBsaXN0IGl0ZW0gd2l0aGluIHN1Yi1uYXZpZ2F0aW9uIHBhbmVsIComIzQ3O1xuLnN1Yi1uYXYgbGkge1xuICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTtcbiAgICBtYXJnaW46IDA7XG4gICAgcGFkZGluZzogMDtcbn1cbiAgICAgKiBAZXhhbXBsZSA8aDQ+SmF2YVNjcmlwdDwvaDQ+PGhyLz5cbiZsdDshLS0gaW5jbHVkZSBqcXVlcnkgLS0mZ3Q7XG4mbHQ7c2NyaXB0IHNyYz0mcXVvdDtodHRwOi8vY29kZS5qcXVlcnkuY29tL2pxdWVyeS0xLjEwLjEubWluLmpzJnF1b3Q7Jmd0OyZsdDsvc2NyaXB0Jmd0O1xuXG4mbHQ7IS0tIGluY2x1ZGUgdGhlIGpxdWVyeS1hY2Nlc3NpYmxlTWVnYU1lbnUgcGx1Z2luIHNjcmlwdCAtLSZndDtcbiZsdDtzY3JpcHQgc3JjPSZxdW90O2pzL2pxdWVyeS1hY2Nlc3NpYmxlTWVnYU1lbnUuanMmcXVvdDsmZ3Q7Jmx0Oy9zY3JpcHQmZ3Q7XG5cbiZsdDshLS0gaW5pdGlhbGl6ZSBhIHNlbGVjdG9yIGFzIGFuIGFjY2Vzc2libGVNZWdhTWVudSAtLSZndDtcbiZsdDtzY3JpcHQmZ3Q7XG4gICAgJCgmcXVvdDtuYXY6Zmlyc3QmcXVvdDspLmFjY2Vzc2libGVNZWdhTWVudSh7XG4gICAgICAgICYjNDc7KiBwcmVmaXggZm9yIGdlbmVyYXRlZCB1bmlxdWUgaWQgYXR0cmlidXRlcywgd2hpY2ggYXJlIHJlcXVpcmVkIHRvIGluZGljYXRlIGFyaWEtb3ducywgYXJpYS1jb250cm9scyBhbmQgYXJpYS1sYWJlbGxlZGJ5IComIzQ3O1xuICAgICAgICB1dWlkUHJlZml4OiAmcXVvdDthY2Nlc3NpYmxlLW1lZ2FtZW51JnF1b3Q7LFxuXG4gICAgICAgICYjNDc7KiBjc3MgY2xhc3MgdXNlZCB0byBkZWZpbmUgdGhlIG1lZ2FtZW51IHN0eWxpbmcgKiYjNDc7XG4gICAgICAgIG1lbnVDbGFzczogJnF1b3Q7bmF2LW1lbnUmcXVvdDssXG5cbiAgICAgICAgJiM0NzsqIGNzcyBjbGFzcyBmb3IgYSB0b3AtbGV2ZWwgbmF2aWdhdGlvbiBpdGVtIGluIHRoZSBtZWdhbWVudSAqJiM0NztcbiAgICAgICAgdG9wTmF2SXRlbUNsYXNzOiAmcXVvdDtuYXYtaXRlbSZxdW90OyxcblxuICAgICAgICAmIzQ3OyogY3NzIGNsYXNzIGZvciBhIG1lZ2FtZW51IHBhbmVsIComIzQ3O1xuICAgICAgICBwYW5lbENsYXNzOiAmcXVvdDtzdWItbmF2JnF1b3Q7LFxuXG4gICAgICAgICYjNDc7KiBjc3MgY2xhc3MgZm9yIGEgZ3JvdXAgb2YgaXRlbXMgd2l0aGluIGEgbWVnYW1lbnUgcGFuZWwgKiYjNDc7XG4gICAgICAgIHBhbmVsR3JvdXBDbGFzczogJnF1b3Q7c3ViLW5hdi1ncm91cCZxdW90OyxcblxuICAgICAgICAmIzQ3OyogY3NzIGNsYXNzIGZvciB0aGUgaG92ZXIgc3RhdGUgKiYjNDc7XG4gICAgICAgIGhvdmVyQ2xhc3M6ICZxdW90O2hvdmVyJnF1b3Q7LFxuXG4gICAgICAgICYjNDc7KiBjc3MgY2xhc3MgZm9yIHRoZSBmb2N1cyBzdGF0ZSAqJiM0NztcbiAgICAgICAgZm9jdXNDbGFzczogJnF1b3Q7Zm9jdXMmcXVvdDssXG5cbiAgICAgICAgJiM0NzsqIGNzcyBjbGFzcyBmb3IgdGhlIG9wZW4gc3RhdGUgKiYjNDc7XG4gICAgICAgIG9wZW5DbGFzczogJnF1b3Q7b3BlbiZxdW90O1xuICAgIH0pO1xuJmx0Oy9zY3JpcHQmZ3Q7XG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSBNZWdhIE1lbnUgb3B0aW9uc1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy51dWlkUHJlZml4PWFjY2Vzc2libGUtbWVnYW1lbnVdIC0gUHJlZml4IGZvciBnZW5lcmF0ZWQgdW5pcXVlIGlkIGF0dHJpYnV0ZXMsIHdoaWNoIGFyZSByZXF1aXJlZCB0byBpbmRpY2F0ZSBhcmlhLW93bnMsIGFyaWEtY29udHJvbHMgYW5kIGFyaWEtbGFiZWxsZWRieVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5tZW51Q2xhc3M9YWNjZXNzaWJsZS1tZWdhbWVudV0gLSBDU1MgY2xhc3MgdXNlZCB0byBkZWZpbmUgdGhlIG1lZ2FtZW51IHN0eWxpbmdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMudG9wTmF2SXRlbUNsYXNzPWFjY2Vzc2libGUtbWVnYW1lbnUtdG9wLW5hdi1pdGVtXSAtIENTUyBjbGFzcyBmb3IgYSB0b3AtbGV2ZWwgbmF2aWdhdGlvbiBpdGVtIGluIHRoZSBtZWdhbWVudVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5wYW5lbENsYXNzPWFjY2Vzc2libGUtbWVnYW1lbnUtcGFuZWxdIC0gQ1NTIGNsYXNzIGZvciBhIG1lZ2FtZW51IHBhbmVsXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnBhbmVsR3JvdXBDbGFzcz1hY2Nlc3NpYmxlLW1lZ2FtZW51LXBhbmVsLWdyb3VwXSAtIENTUyBjbGFzcyBmb3IgYSBncm91cCBvZiBpdGVtcyB3aXRoaW4gYSBtZWdhbWVudSBwYW5lbFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5ob3ZlckNsYXNzPWhvdmVyXSAtIENTUyBjbGFzcyBmb3IgdGhlIGhvdmVyIHN0YXRlXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLmZvY3VzQ2xhc3M9Zm9jdXNdIC0gQ1NTIGNsYXNzIGZvciB0aGUgZm9jdXMgc3RhdGVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMub3BlbkNsYXNzPW9wZW5dIC0gQ1NTIGNsYXNzIGZvciB0aGUgb3BlbiBzdGF0ZVxuICAgICAqL1xuICAgICQuZm5bcGx1Z2luTmFtZV0gPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghJC5kYXRhKHRoaXMsIFwicGx1Z2luX1wiICsgcGx1Z2luTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAkLmRhdGEodGhpcywgXCJwbHVnaW5fXCIgKyBwbHVnaW5OYW1lLCBuZXcgJC5mbltwbHVnaW5OYW1lXS5BY2Nlc3NpYmxlTWVnYU1lbnUodGhpcywgb3B0aW9ucykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJC5mbltwbHVnaW5OYW1lXS5BY2Nlc3NpYmxlTWVnYU1lbnUgPSBBY2Nlc3NpYmxlTWVnYU1lbnU7XG5cbiAgICAvKiA6Zm9jdXNhYmxlIGFuZCA6dGFiYmFibGUgc2VsZWN0b3JzIGZyb21cbiAgICAgICBodHRwczovL3Jhdy5naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkvbWFzdGVyL3VpL2pxdWVyeS51aS5jb3JlLmpzICovXG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHZpc2libGUoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gJC5leHByLmZpbHRlcnMudmlzaWJsZShlbGVtZW50KSAmJiAhJChlbGVtZW50KS5wYXJlbnRzKCkuYWRkQmFjaygpLmZpbHRlcihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5jc3ModGhpcywgXCJ2aXNpYmlsaXR5XCIpID09PSBcImhpZGRlblwiO1xuICAgICAgICB9KS5sZW5ndGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmb2N1c2FibGUoZWxlbWVudCwgaXNUYWJJbmRleE5vdE5hTikge1xuICAgICAgICB2YXIgbWFwLCBtYXBOYW1lLCBpbWcsXG4gICAgICAgICAgICBub2RlTmFtZSA9IGVsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKFwiYXJlYVwiID09PSBub2RlTmFtZSkge1xuICAgICAgICAgICAgbWFwID0gZWxlbWVudC5wYXJlbnROb2RlO1xuICAgICAgICAgICAgbWFwTmFtZSA9IG1hcC5uYW1lO1xuICAgICAgICAgICAgaWYgKCFlbGVtZW50LmhyZWYgfHwgIW1hcE5hbWUgfHwgbWFwLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09IFwibWFwXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbWcgPSAkKFwiaW1nW3VzZW1hcD0jXCIgKyBtYXBOYW1lICsgXCJdXCIpWzBdO1xuICAgICAgICAgICAgcmV0dXJuICEhaW1nICYmIHZpc2libGUoaW1nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKC9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdC8udGVzdChub2RlTmFtZSkgPyAhZWxlbWVudC5kaXNhYmxlZCA6XG4gICAgICAgICAgICAgICAgXCJhXCIgPT09IG5vZGVOYW1lID9cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuaHJlZiB8fCBpc1RhYkluZGV4Tm90TmFOIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzVGFiSW5kZXhOb3ROYU4pICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgYW5kIGFsbCBvZiBpdHMgYW5jZXN0b3JzIG11c3QgYmUgdmlzaWJsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGUoZWxlbWVudCk7XG4gICAgfVxuXG4gICAgJC5leHRlbmQoJC5leHByW1wiOlwiXSwge1xuICAgICAgICBkYXRhOiAkLmV4cHIuY3JlYXRlUHNldWRvID8gJC5leHByLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbiAoZGF0YU5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhISQuZGF0YShlbGVtLCBkYXRhTmFtZSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSA6IC8vIHN1cHBvcnQ6IGpRdWVyeSA8MS44XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVsZW0sIGksIG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhISQuZGF0YShlbGVtLCBtYXRjaFszXSk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICBmb2N1c2FibGU6IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZm9jdXNhYmxlKGVsZW1lbnQsICFpc05hTigkLmF0dHIoZWxlbWVudCwgXCJ0YWJpbmRleFwiKSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRhYmJhYmxlOiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIHRhYkluZGV4ID0gJC5hdHRyKGVsZW1lbnQsIFwidGFiaW5kZXhcIiksXG4gICAgICAgICAgICAgICAgaXNUYWJJbmRleE5hTiA9IGlzTmFOKHRhYkluZGV4KTtcbiAgICAgICAgICAgIHJldHVybiAoaXNUYWJJbmRleE5hTiB8fCB0YWJJbmRleCA+PSAwKSAmJiBmb2N1c2FibGUoZWxlbWVudCwgIWlzVGFiSW5kZXhOYU4pO1xuICAgICAgICB9XG4gICAgfSk7XG59KGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCkpO1xuIl19
