(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/* globals jQuery */

var enquire = require('../../bower_components/enquire/dist/enquire.js')
require('../../bower_components/jquery-accessibleMegaMenu/js/jquery-accessibleMegaMenu.js')

'use strict'

jQuery(function ($) {
  $('.email_button').click(function (e) {
    var confirm
    if (!confirm('Are you sure?')) {
      return
    }
    var data = {
      action: 'send_email',
      target: $(e.target).attr('id'),
      subject: $(e.target).data('subject'),
      body: $($(e.target).data('body')).val()
    }
    console.log(data)
    $('.email_results').removeClass('alert-danger')
    $.post('/wp-admin/admin-ajax.php', data, function (data, status, xhr) {
      $('.email_results').html(data)
      if (status !== 'success') {
        $('.email_results').addClass('alert-danger')
      }
      $('.email_results').removeClass('hidden')
    })
  })
})

jQuery(function ($) {
  $(window).scroll(function () {
    $('.header').addClass('scrolled')
  }).removeClass('scrolled')
})

jQuery(function ($) {
  enquire.register('screen and (min-width:779px)', {
    match: function () {
      // Main Nav
      $('.menu-header-menu-container').accessibleMegaMenu({
        uuidPrefix: 'accessible-nav',
        menuClass: 'nav-menu',
        topNavItemClass: 'nav-item',
        panelClass: 'sub-nav',
        panelGroupClass: 'sub-nav-group',
        hoverClass: 'hover',
        focusClass: 'focus',
        openClass: 'open'
      })
      // hack so that the megamenu doesn't show flash of css animation after the page loads.
      setTimeout(function () {
        $('body').removeClass('init')
      }, 500)
      // Change aria-hidden state
      $('#js-navigation-toggle').attr('aria-hidden', 'true')
    },
    unmatch: function () {
    }
  })
})

},{"../../bower_components/enquire/dist/enquire.js":2,"../../bower_components/jquery-accessibleMegaMenu/js/jquery-accessibleMegaMenu.js":3}],2:[function(require,module,exports){
/*!
 * enquire.js v2.1.2 - Awesome Media Queries in JavaScript
 * Copyright (c) 2014 Nick Williams - http://wicky.nillia.ms/enquire.js
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */

;(function (name, context, factory) {
	var matchMedia = window.matchMedia;

	if (typeof module !== 'undefined' && module.exports) {
		module.exports = factory(matchMedia);
	}
	else if (typeof define === 'function' && define.amd) {
		define(function() {
			return (context[name] = factory(matchMedia));
		});
	}
	else {
		context[name] = factory(matchMedia);
	}
}('enquire', this, function (matchMedia) {

	'use strict';

    /*jshint unused:false */
    /**
     * Helper function for iterating over a collection
     *
     * @param collection
     * @param fn
     */
    function each(collection, fn) {
        var i      = 0,
            length = collection.length,
            cont;

        for(i; i < length; i++) {
            cont = fn(collection[i], i);
            if(cont === false) {
                break; //allow early exit
            }
        }
    }

    /**
     * Helper function for determining whether target object is an array
     *
     * @param target the object under test
     * @return {Boolean} true if array, false otherwise
     */
    function isArray(target) {
        return Object.prototype.toString.apply(target) === '[object Array]';
    }

    /**
     * Helper function for determining whether target object is a function
     *
     * @param target the object under test
     * @return {Boolean} true if function, false otherwise
     */
    function isFunction(target) {
        return typeof target === 'function';
    }

    /**
     * Delegate to handle a media query being matched and unmatched.
     *
     * @param {object} options
     * @param {function} options.match callback for when the media query is matched
     * @param {function} [options.unmatch] callback for when the media query is unmatched
     * @param {function} [options.setup] one-time callback triggered the first time a query is matched
     * @param {boolean} [options.deferSetup=false] should the setup callback be run immediately, rather than first time query is matched?
     * @constructor
     */
    function QueryHandler(options) {
        this.options = options;
        !options.deferSetup && this.setup();
    }
    QueryHandler.prototype = {

        /**
         * coordinates setup of the handler
         *
         * @function
         */
        setup : function() {
            if(this.options.setup) {
                this.options.setup();
            }
            this.initialised = true;
        },

        /**
         * coordinates setup and triggering of the handler
         *
         * @function
         */
        on : function() {
            !this.initialised && this.setup();
            this.options.match && this.options.match();
        },

        /**
         * coordinates the unmatch event for the handler
         *
         * @function
         */
        off : function() {
            this.options.unmatch && this.options.unmatch();
        },

        /**
         * called when a handler is to be destroyed.
         * delegates to the destroy or unmatch callbacks, depending on availability.
         *
         * @function
         */
        destroy : function() {
            this.options.destroy ? this.options.destroy() : this.off();
        },

        /**
         * determines equality by reference.
         * if object is supplied compare options, if function, compare match callback
         *
         * @function
         * @param {object || function} [target] the target for comparison
         */
        equals : function(target) {
            return this.options === target || this.options.match === target;
        }

    };
    /**
     * Represents a single media query, manages it's state and registered handlers for this query
     *
     * @constructor
     * @param {string} query the media query string
     * @param {boolean} [isUnconditional=false] whether the media query should run regardless of whether the conditions are met. Primarily for helping older browsers deal with mobile-first design
     */
    function MediaQuery(query, isUnconditional) {
        this.query = query;
        this.isUnconditional = isUnconditional;
        this.handlers = [];
        this.mql = matchMedia(query);

        var self = this;
        this.listener = function(mql) {
            self.mql = mql;
            self.assess();
        };
        this.mql.addListener(this.listener);
    }
    MediaQuery.prototype = {

        /**
         * add a handler for this query, triggering if already active
         *
         * @param {object} handler
         * @param {function} handler.match callback for when query is activated
         * @param {function} [handler.unmatch] callback for when query is deactivated
         * @param {function} [handler.setup] callback for immediate execution when a query handler is registered
         * @param {boolean} [handler.deferSetup=false] should the setup callback be deferred until the first time the handler is matched?
         */
        addHandler : function(handler) {
            var qh = new QueryHandler(handler);
            this.handlers.push(qh);

            this.matches() && qh.on();
        },

        /**
         * removes the given handler from the collection, and calls it's destroy methods
         * 
         * @param {object || function} handler the handler to remove
         */
        removeHandler : function(handler) {
            var handlers = this.handlers;
            each(handlers, function(h, i) {
                if(h.equals(handler)) {
                    h.destroy();
                    return !handlers.splice(i,1); //remove from array and exit each early
                }
            });
        },

        /**
         * Determine whether the media query should be considered a match
         * 
         * @return {Boolean} true if media query can be considered a match, false otherwise
         */
        matches : function() {
            return this.mql.matches || this.isUnconditional;
        },

        /**
         * Clears all handlers and unbinds events
         */
        clear : function() {
            each(this.handlers, function(handler) {
                handler.destroy();
            });
            this.mql.removeListener(this.listener);
            this.handlers.length = 0; //clear array
        },

        /*
         * Assesses the query, turning on all handlers if it matches, turning them off if it doesn't match
         */
        assess : function() {
            var action = this.matches() ? 'on' : 'off';

            each(this.handlers, function(handler) {
                handler[action]();
            });
        }
    };
    /**
     * Allows for registration of query handlers.
     * Manages the query handler's state and is responsible for wiring up browser events
     *
     * @constructor
     */
    function MediaQueryDispatch () {
        if(!matchMedia) {
            throw new Error('matchMedia not present, legacy browsers require a polyfill');
        }

        this.queries = {};
        this.browserIsIncapable = !matchMedia('only all').matches;
    }

    MediaQueryDispatch.prototype = {

        /**
         * Registers a handler for the given media query
         *
         * @param {string} q the media query
         * @param {object || Array || Function} options either a single query handler object, a function, or an array of query handlers
         * @param {function} options.match fired when query matched
         * @param {function} [options.unmatch] fired when a query is no longer matched
         * @param {function} [options.setup] fired when handler first triggered
         * @param {boolean} [options.deferSetup=false] whether setup should be run immediately or deferred until query is first matched
         * @param {boolean} [shouldDegrade=false] whether this particular media query should always run on incapable browsers
         */
        register : function(q, options, shouldDegrade) {
            var queries         = this.queries,
                isUnconditional = shouldDegrade && this.browserIsIncapable;

            if(!queries[q]) {
                queries[q] = new MediaQuery(q, isUnconditional);
            }

            //normalise to object in an array
            if(isFunction(options)) {
                options = { match : options };
            }
            if(!isArray(options)) {
                options = [options];
            }
            each(options, function(handler) {
                if (isFunction(handler)) {
                    handler = { match : handler };
                }
                queries[q].addHandler(handler);
            });

            return this;
        },

        /**
         * unregisters a query and all it's handlers, or a specific handler for a query
         *
         * @param {string} q the media query to target
         * @param {object || function} [handler] specific handler to unregister
         */
        unregister : function(q, handler) {
            var query = this.queries[q];

            if(query) {
                if(handler) {
                    query.removeHandler(handler);
                }
                else {
                    query.clear();
                    delete this.queries[q];
                }
            }

            return this;
        }
    };

	return new MediaQueryDispatch();

}));
},{}],3:[function(require,module,exports){
/*
Copyright © 2013 Adobe Systems Incorporated.

Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

/**
 * See <a href="http://jquery.com">http://jquery.com</a>.
 * @name jquery
 * @class
 * See the jQuery Library  (<a href="http://jquery.com">http://jquery.com</a>) for full details.  This just
 * documents the function and classes that are added to jQuery by this plug-in.
 */

/**
 * See <a href="http://jquery.com">http://jquery.com</a>
 * @name fn
 * @class
 * See the jQuery Library  (<a href="http://jquery.com">http://jquery.com</a>) for full details.  This just
 * documents the function and classes that are added to jQuery by this plug-in.
 * @memberOf jquery
 */

/**
 * @fileOverview accessibleMegaMenu plugin
 *
 *<p>Licensed under the Apache License, Version 2.0 (the “License”)
 *<br />Copyright © 2013 Adobe Systems Incorporated.
 *<br />Project page <a href="https://github.com/adobe-accessibility/Accessible-Mega-Menu">https://github.com/adobe-accessibility/Accessible-Mega-Menu</a>
 * @version 0.1
 * @author Michael Jordan
 * @requires jquery
 */

/*jslint browser: true, devel: true, plusplus: true, nomen: true */
/*global jQuery */
(function ($, window, document) {
    "use strict";
    var pluginName = "accessibleMegaMenu",
        defaults = {
            uuidPrefix: "accessible-megamenu", // unique ID's are required to indicate aria-owns, aria-controls and aria-labelledby
            menuClass: "accessible-megamenu", // default css class used to define the megamenu styling
            topNavItemClass: "accessible-megamenu-top-nav-item", // default css class for a top-level navigation item in the megamenu
            panelClass: "accessible-megamenu-panel", // default css class for a megamenu panel
            panelGroupClass: "accessible-megamenu-panel-group", // default css class for a group of items within a megamenu panel
            hoverClass: "hover", // default css class for the hover state
            focusClass: "focus", // default css class for the focus state
            openClass: "open" // default css class for the open state
        },
        Keyboard = {
            BACKSPACE: 8,
            COMMA: 188,
            DELETE: 46,
            DOWN: 40,
            END: 35,
            ENTER: 13,
            ESCAPE: 27,
            HOME: 36,
            LEFT: 37,
            PAGE_DOWN: 34,
            PAGE_UP: 33,
            PERIOD: 190,
            RIGHT: 39,
            SPACE: 32,
            TAB: 9,
            UP: 38,
            keyMap: {
                48: "0",
                49: "1",
                50: "2",
                51: "3",
                52: "4",
                53: "5",
                54: "6",
                55: "7",
                56: "8",
                57: "9",
                59: ";",
                65: "a",
                66: "b",
                67: "c",
                68: "d",
                69: "e",
                70: "f",
                71: "g",
                72: "h",
                73: "i",
                74: "j",
                75: "k",
                76: "l",
                77: "m",
                78: "n",
                79: "o",
                80: "p",
                81: "q",
                82: "r",
                83: "s",
                84: "t",
                85: "u",
                86: "v",
                87: "w",
                88: "x",
                89: "y",
                90: "z",
                96: "0",
                97: "1",
                98: "2",
                99: "3",
                100: "4",
                101: "5",
                102: "6",
                103: "7",
                104: "8",
                105: "9",
                190: "."
            }
        };
    /**
     * @desc Creates a new accessible mega menu instance.
     * @param {jquery} element
     * @param {object} [options] Mega Menu options
     * @param {string} [options.uuidPrefix=accessible-megamenu] - Prefix for generated unique id attributes, which are required to indicate aria-owns, aria-controls and aria-labelledby
     * @param {string} [options.menuClass=accessible-megamenu] - CSS class used to define the megamenu styling
     * @param {string} [options.topNavItemClass=accessible-megamenu-top-nav-item] - CSS class for a top-level navigation item in the megamenu
     * @param {string} [options.panelClass=accessible-megamenu-panel] - CSS class for a megamenu panel
     * @param {string} [options.panelGroupClass=accessible-megamenu-panel-group] - CSS class for a group of items within a megamenu panel
     * @param {string} [options.hoverClass=hover] - CSS class for the hover state
     * @param {string} [options.focusClass=focus] - CSS class for the focus state
     * @param {string} [options.openClass=open] - CSS class for the open state
     * @constructor
     */
    function AccessibleMegaMenu(element, options) {
        this.element = element;

        // merge optional settings and defaults into settings
        this.settings = $.extend({}, defaults, options);

        this._defaults = defaults;
        this._name = pluginName;

        this.mouseTimeoutID = null;
        this.focusTimeoutID = null;
        this.mouseFocused = false;
        this.justFocused = false;

        this.init();
    }

    AccessibleMegaMenu.prototype = (function () {

        /* private attributes and methods ------------------------ */
        var uuid = 0,
            keydownTimeoutDuration = 1000,
            keydownSearchString = "",
            isTouch = typeof window.hasOwnProperty === "function" && !!window.hasOwnProperty("ontouchstart"),
            _getPlugin,
            _addUniqueId,
            _togglePanel,
            _clickHandler,
            _clickOutsideHandler,
            _DOMAttrModifiedHandler,
            _focusInHandler,
            _focusOutHandler,
            _keyDownHandler,
            _mouseDownHandler,
            _mouseOverHandler,
            _mouseOutHandler,
            _toggleExpandedEventHandlers;

        /**
         * @name jQuery.fn.accessibleMegaMenu~_getPlugin
         * @desc Returns the parent accessibleMegaMenu instance for a given element
         * @param {jQuery} element
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _getPlugin = function (element) {
            return $(element).closest(':data(plugin_' + pluginName + ')').data("plugin_" + pluginName);
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_addUniqueId
         * @desc Adds a unique id and element.
         * The id string starts with the
         * string defined in settings.uuidPrefix.
         * @param {jQuery} element
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _addUniqueId = function (element) {
            element = $(element);
            var settings = this.settings;
            if (!element.attr("id")) {
                element.attr("id", settings.uuidPrefix + "-" + new Date().getTime() + "-" + (++uuid));
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_togglePanel
         * @desc Toggle the display of mega menu panels in response to an event.
         * The optional boolean value 'hide' forces all panels to hide.
         * @param {event} event
         * @param {Boolean} [hide] Hide all mega menu panels when true
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _togglePanel = function (event, hide) {
            var target = $(event.target),
                that = this,
                settings = this.settings,
                menu = this.menu,
                topli = target.closest('.' + settings.topNavItemClass),
                panel = target.hasClass(settings.panelClass) ? target : target.closest('.' + settings.panelClass),
                newfocus;

            _toggleExpandedEventHandlers.call(this, true);

            if (hide) {
                topli = menu.find('.' + settings.topNavItemClass + ' .' + settings.openClass + ':first').closest('.' + settings.topNavItemClass);
                if (!(topli.is(event.relatedTarget) || topli.has(event.relatedTarget).length > 0)) {
                    if ((event.type === 'mouseout' || event.type === 'focusout') && topli.has(document.activeElement).length > 0) {
                        return;
                    }
                    topli.find('[aria-expanded]')
                        .attr('aria-expanded', 'false')
                        .removeClass(settings.openClass)
                        .filter('.' + settings.panelClass)
                        .attr('aria-hidden', 'true');
                    if ((event.type === 'keydown' && event.keyCode === Keyboard.ESCAPE) || event.type === 'DOMAttrModified') {
                        newfocus = topli.find(':tabbable:first');
                        setTimeout(function () {
                            menu.find('[aria-expanded].' + that.settings.panelClass).off('DOMAttrModified.accessible-megamenu');
                            newfocus.focus();
                            that.justFocused = false;
                        }, 99);
                    }
                } else if (topli.length === 0) {
                    menu.find('[aria-expanded=true]')
                        .attr('aria-expanded', 'false')
                        .removeClass(settings.openClass)
                        .filter('.' + settings.panelClass)
                        .attr('aria-hidden', 'true');
                }
            } else {
                clearTimeout(that.focusTimeoutID);
                topli.siblings()
                    .find('[aria-expanded]')
                    .attr('aria-expanded', 'false')
                    .removeClass(settings.openClass)
                    .filter('.' + settings.panelClass)
                    .attr('aria-hidden', 'true');
                topli.find('[aria-expanded]')
                    .attr('aria-expanded', 'true')
                    .addClass(settings.openClass)
                    .filter('.' + settings.panelClass)
                    .attr('aria-hidden', 'false');
                if (event.type === 'mouseover' && target.is(':tabbable') && topli.length === 1 && panel.length === 0 && menu.has(document.activeElement).length > 0) {
                    target.focus();
                    that.justFocused = false;
                }

                _toggleExpandedEventHandlers.call(that);
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_clickHandler
         * @desc Handle click event on mega menu item
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _clickHandler = function (event) {
            var target = $(event.currentTarget),
                topli = target.closest('.' + this.settings.topNavItemClass),
                panel = target.closest('.' + this.settings.panelClass);
            if (topli.length === 1
                    && panel.length === 0
                    && topli.find('.' + this.settings.panelClass).length === 1) {
                if (!target.hasClass(this.settings.openClass)) {
                    event.preventDefault();
                    event.stopPropagation();
                    _togglePanel.call(this, event);
                    this.justFocused = false;
                } else {
                    if (this.justFocused) {
                        event.preventDefault();
                        event.stopPropagation();
                        this.justFocused = false;
                    } else if (isTouch) {
                        event.preventDefault();
                        event.stopPropagation();
                        _togglePanel.call(this, event, target.hasClass(this.settings.openClass));
                    }
                }
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_clickOutsideHandler
         * @desc Handle click event outside of a the megamenu
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _clickOutsideHandler = function (event) {
            if ($(event.target).closest(this.menu).length === 0) {
                event.preventDefault();
                event.stopPropagation();
                _togglePanel.call(this, event, true);
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_DOMAttrModifiedHandler
         * @desc Handle DOMAttrModified event on panel to respond to Windows 8 Narrator ExpandCollapse pattern
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _DOMAttrModifiedHandler = function (event) {
            if (event.originalEvent.attrName === 'aria-expanded'
                    && event.originalEvent.newValue === 'false'
                    && $(event.target).hasClass(this.settings.openClass)) {
                event.preventDefault();
                event.stopPropagation();
                _togglePanel.call(this, event, true);
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_focusInHandler
         * @desc Handle focusin event on mega menu item.
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _focusInHandler = function (event) {
            clearTimeout(this.focusTimeoutID);
            var target = $(event.target),
                panel = target.closest('.' + this.settings.panelClass);
            target
                .addClass(this.settings.focusClass)
                .on('click.accessible-megamenu', $.proxy(_clickHandler, this));
            this.justFocused = !this.mouseFocused;
            this.mouseFocused = false;
            if (this.panels.not(panel).filter('.' + this.settings.openClass).length) {
                _togglePanel.call(this, event);
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_focusOutHandler
         * @desc Handle focusout event on mega menu item.
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _focusOutHandler = function (event) {
            this.justFocused = false;
            var that = this,
                target = $(event.target),
                topli = target.closest('.' + this.settings.topNavItemClass),
                keepOpen = false;
            target
                .removeClass(this.settings.focusClass)
                .off('click.accessible-megamenu');

            if (window.cvox) {
                // If ChromeVox is running...
                that.focusTimeoutID = setTimeout(function () {
                    window.cvox.Api.getCurrentNode(function (node) {
                        if (topli.has(node).length) {
                            // and the current node being voiced is in
                            // the mega menu, clearTimeout,
                            // so the panel stays open.
                            clearTimeout(that.focusTimeoutID);
                        } else {
                            that.focusTimeoutID = setTimeout(function (scope, event, hide) {
                                _togglePanel.call(scope, event, hide);
                            }, 275, that, event, true);
                        }
                    });
                }, 25);
            } else {
                that.focusTimeoutID = setTimeout(function () {
                    _togglePanel.call(that, event, true);
                }, 300);
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_keyDownHandler
         * @desc Handle keydown event on mega menu.
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _keyDownHandler = function (event) {
            var that = (this.constructor === AccessibleMegaMenu) ? this : _getPlugin(this), // determine the AccessibleMegaMenu plugin instance
                settings = that.settings,
                target = $($(this).is('.' + settings.hoverClass + ':tabbable') ? this : event.target), // if the element is hovered the target is this, otherwise, its the focused element
                menu = that.menu,
                topnavitems = that.topnavitems,
                topli = target.closest('.' + settings.topNavItemClass),
                tabbables = menu.find(':tabbable'),
                panel = target.hasClass(settings.panelClass) ? target : target.closest('.' + settings.panelClass),
                panelGroups = panel.find('.' + settings.panelGroupClass),
                currentPanelGroup = target.closest('.' + settings.panelGroupClass),
                next,
                keycode = event.keyCode || event.which,
                start,
                i,
                o,
                label,
                found = false,
                newString = Keyboard.keyMap[event.keyCode] || '',
                regex,
                isTopNavItem = (topli.length === 1 && panel.length === 0);

            if (target.is("input:focus, select:focus, textarea:focus, button:focus")) {
                // if the event target is a form element we should handle keydown normally
                return;
            }

            if (target.is('.' + settings.hoverClass + ':tabbable')) {
                $('html').off('keydown.accessible-megamenu');
            }

            switch (keycode) {
            case Keyboard.ESCAPE:
                _togglePanel.call(that, event, true);
                break;
            case Keyboard.DOWN:
                event.preventDefault();
                if (isTopNavItem) {
                    _togglePanel.call(that, event);
                    found = (topli.find('.' + settings.panelClass + ' :tabbable:first').focus().length === 1);
                } else {
                    found = (tabbables.filter(':gt(' + tabbables.index(target) + '):first').focus().length === 1);
                }

                if (!found && window.opera && opera.toString() === "[object Opera]" && (event.ctrlKey || event.metaKey)) {
                    tabbables = $(':tabbable');
                    i = tabbables.index(target);
                    found = ($(':tabbable:gt(' + $(':tabbable').index(target) + '):first').focus().length === 1);
                }
                break;
            case Keyboard.UP:
                event.preventDefault();
                if (isTopNavItem && target.hasClass(settings.openClass)) {
                    _togglePanel.call(that, event, true);
                    next = topnavitems.filter(':lt(' + topnavitems.index(topli) + '):last');
                    if (next.children('.' + settings.panelClass).length) {
                        found = (next.children()
                            .attr('aria-expanded', 'true')
                            .addClass(settings.openClass)
                            .filter('.' + settings.panelClass)
                            .attr('aria-hidden', 'false')
                            .find(':tabbable:last')
                            .focus() === 1);
                    }
                } else if (!isTopNavItem) {
                    found = (tabbables.filter(':lt(' + tabbables.index(target) + '):last').focus().length === 1);
                }

                if (!found && window.opera && opera.toString() === "[object Opera]" && (event.ctrlKey || event.metaKey)) {
                    tabbables = $(':tabbable');
                    i = tabbables.index(target);
                    found = ($(':tabbable:lt(' + $(':tabbable').index(target) + '):first').focus().length === 1);
                }
                break;
            case Keyboard.RIGHT:
                event.preventDefault();
                if (isTopNavItem) {
                    found = (topnavitems.filter(':gt(' + topnavitems.index(topli) + '):first').find(':tabbable:first').focus().length === 1);
                } else {
                    if (panelGroups.length && currentPanelGroup.length) {
                        // if the current panel contains panel groups, and we are able to focus the first tabbable element of the next panel group
                        found = (panelGroups.filter(':gt(' + panelGroups.index(currentPanelGroup) + '):first').find(':tabbable:first').focus().length === 1);
                    }

                    if (!found) {
                        found = (topli.find(':tabbable:first').focus().length === 1);
                    }
                }
                break;
            case Keyboard.LEFT:
                event.preventDefault();
                if (isTopNavItem) {
                    found = (topnavitems.filter(':lt(' + topnavitems.index(topli) + '):last').find(':tabbable:first').focus().length === 1);
                } else {
                    if (panelGroups.length && currentPanelGroup.length) {
                        // if the current panel contains panel groups, and we are able to focus the first tabbable element of the previous panel group
                        found = (panelGroups.filter(':lt(' + panelGroups.index(currentPanelGroup) + '):last').find(':tabbable:first').focus().length === 1);
                    }

                    if (!found) {
                        found = (topli.find(':tabbable:first').focus().length === 1);
                    }
                }
                break;
            case Keyboard.TAB:
                i = tabbables.index(target);
                if (event.shiftKey && isTopNavItem && target.hasClass(settings.openClass)) {
                    _togglePanel.call(that, event, true);
                    next = topnavitems.filter(':lt(' + topnavitems.index(topli) + '):last');
                    if (next.children('.' + settings.panelClass).length) {
                        found = next.children()
                            .attr('aria-expanded', 'true')
                            .addClass(settings.openClass)
                            .filter('.' + settings.panelClass)
                            .attr('aria-hidden', 'false')
                            .find(':tabbable:last')
                            .focus();
                    }
                } else if (event.shiftKey && i > 0) {
                    found = (tabbables.filter(':lt(' + i + '):last').focus().length === 1);
                } else if (!event.shiftKey && i < tabbables.length - 1) {
                    found = (tabbables.filter(':gt(' + i + '):first').focus().length === 1);
                } else if (window.opera && opera.toString() === "[object Opera]") {
                    tabbables = $(':tabbable');
                    i = tabbables.index(target);
                    if (event.shiftKey) {
                        found = ($(':tabbable:lt(' + $(':tabbable').index(target) + '):last').focus().length === 1);
                    } else {
                        found = ($(':tabbable:gt(' + $(':tabbable').index(target) + '):first').focus().length === 1);
                    }
                }

                if (found) {
                    event.preventDefault();
                }
                break;
            case Keyboard.SPACE:
                if (isTopNavItem) {
                    event.preventDefault();
                    _clickHandler.call(that, event);
                } else {
                    return true;
                }
                break;
            case Keyboard.ENTER:
                return true;
                break;
            default:
                // alphanumeric filter
                clearTimeout(this.keydownTimeoutID);

                keydownSearchString += newString !== keydownSearchString ? newString : '';

                if (keydownSearchString.length === 0) {
                    return;
                }

                this.keydownTimeoutID = setTimeout(function () {
                    keydownSearchString = '';
                }, keydownTimeoutDuration);

                if (isTopNavItem && !target.hasClass(settings.openClass)) {
                    tabbables = tabbables.filter(':not(.' + settings.panelClass + ' :tabbable)');
                } else {
                    tabbables = topli.find(':tabbable');
                }

                if (event.shiftKey) {
                    tabbables = $(tabbables.get()
                        .reverse());
                }

                for (i = 0; i < tabbables.length; i++) {
                    o = tabbables.eq(i);
                    if (o.is(target)) {
                        start = (keydownSearchString.length === 1) ? i + 1 : i;
                        break;
                    }
                }

                regex = new RegExp('^' + keydownSearchString.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&'), 'i');

                for (i = start; i < tabbables.length; i++) {
                    o = tabbables.eq(i);
                    label = $.trim(o.text());
                    if (regex.test(label)) {
                        found = true;
                        o.focus();
                        break;
                    }
                }
                if (!found) {
                    for (i = 0; i < start; i++) {
                        o = tabbables.eq(i);
                        label = $.trim(o.text());
                        if (regex.test(label)) {
                            o.focus();
                            break;
                        }
                    }
                }
                break;
            }
            that.justFocused = false;
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_mouseDownHandler
         * @desc Handle mousedown event on mega menu.
         * @param {event} Event object
         * @memberof accessibleMegaMenu
         * @inner
         * @private
         */
        _mouseDownHandler = function (event) {
            if ($(event.target).is(this.settings.panelClass) || $(event.target).closest(":focusable").length) {
                this.mouseFocused = true;
            }
            this.mouseTimeoutID = setTimeout(function () {
                clearTimeout(this.focusTimeoutID);
            }, 1);
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_mouseOverHandler
         * @desc Handle mouseover event on mega menu.
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _mouseOverHandler = function (event) {
            clearTimeout(this.mouseTimeoutID);
            $(event.target)
                .addClass(this.settings.hoverClass);
            _togglePanel.call(this, event);
            if ($(event.target).is(':tabbable')) {
                $('html').on('keydown.accessible-megamenu', $.proxy(_keyDownHandler, event.target));
            }
        };

        /**
         * @name jQuery.fn.accessibleMegaMenu~_mouseOutHandler
         * @desc Handle mouseout event on mega menu.
         * @param {event} Event object
         * @memberof jQuery.fn.accessibleMegaMenu
         * @inner
         * @private
         */
        _mouseOutHandler = function (event) {
            var that = this;
            $(event.target)
                .removeClass(that.settings.hoverClass);

            that.mouseTimeoutID = setTimeout(function () {
                _togglePanel.call(that, event, true);
            }, 250);
            if ($(event.target).is(':tabbable')) {
                $('html').off('keydown.accessible-megamenu');
            }
        };

        _toggleExpandedEventHandlers = function (hide) {
            var menu = this.menu;
            if (hide) {
                $('html').off('mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu');

                menu.find('[aria-expanded].' + this.settings.panelClass).off('DOMAttrModified.accessible-megamenu');
            } else {
                $('html').on('mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu', $.proxy(_clickOutsideHandler, this));

                /* Narrator in Windows 8 automatically toggles the aria-expanded property on double tap or click.
                   To respond to the change to collapse the panel, we must add a listener for a DOMAttrModified event. */
                menu.find('[aria-expanded=true].' + this.settings.panelClass).on('DOMAttrModified.accessible-megamenu', $.proxy(_DOMAttrModifiedHandler, this));
            }
        };

        /* public attributes and methods ------------------------- */
        return {
            constructor: AccessibleMegaMenu,

            /**
             * @lends jQuery.fn.accessibleMegaMenu
             * @desc Initializes an instance of the accessibleMegaMenu plugins
             * @memberof jQuery.fn.accessibleMegaMenu
             * @instance
             */
            init: function () {
                var settings = this.settings,
                    nav = $(this.element),
                    menu = nav.children().first(),
                    topnavitems = menu.children();
                this.start(settings, nav, menu, topnavitems);
            },

            start: function(settings, nav, menu, topnavitems) {
                var that = this;
                this.settings = settings;
                this.menu = menu;
                this.topnavitems = topnavitems;

                nav.attr("role", "navigation");
                menu.addClass(settings.menuClass);
                topnavitems.each(function (i, topnavitem) {
                    var topnavitemlink, topnavitempanel;
                    topnavitem = $(topnavitem);
                    topnavitem.addClass(settings.topNavItemClass);
                    topnavitemlink = topnavitem.find(":tabbable:first");
                    topnavitempanel = topnavitem.children(":not(:tabbable):last");
                    _addUniqueId.call(that, topnavitemlink);
                    if (topnavitempanel.length) {
                        _addUniqueId.call(that, topnavitempanel);
                        topnavitemlink.attr({
                            "aria-haspopup": true,
                            "aria-controls": topnavitempanel.attr("id"),
                            "aria-expanded": false
                        });

                        topnavitempanel.attr({
                            "role": "group",
                            "aria-expanded": false,
                            "aria-hidden": true
                        })
                            .addClass(settings.panelClass)
                            .not("[aria-labelledby]")
                            .attr("aria-labelledby", topnavitemlink.attr("id"));
                    }
                });

                this.panels = menu.find("." + settings.panelClass);

                menu.on("focusin.accessible-megamenu", ":focusable, ." + settings.panelClass, $.proxy(_focusInHandler, this))
                    .on("focusout.accessible-megamenu", ":focusable, ." + settings.panelClass, $.proxy(_focusOutHandler, this))
                    .on("keydown.accessible-megamenu", $.proxy(_keyDownHandler, this))
                    .on("mouseover.accessible-megamenu", $.proxy(_mouseOverHandler, this))
                    .on("mouseout.accessible-megamenu", $.proxy(_mouseOutHandler, this))
                    .on("mousedown.accessible-megamenu", $.proxy(_mouseDownHandler, this));

                if (isTouch) {
                    menu.on("touchstart.accessible-megamenu",  $.proxy(_clickHandler, this));
                }

                menu.find("hr").attr("role", "separator");

                if ($(document.activeElement).closest(menu).length) {
                  $(document.activeElement).trigger("focusin.accessible-megamenu");
                }
            },

            /**
             * @desc Get default values
             * @example $(selector).accessibleMegaMenu("getDefaults");
             * @return {object}
             * @memberof jQuery.fn.accessibleMegaMenu
             * @instance
             */
            getDefaults: function () {
                return this._defaults;
            },

            /**
             * @desc Get any option set to plugin using its name (as string)
             * @example $(selector).accessibleMegaMenu("getOption", some_option);
             * @param {string} opt
             * @return {string}
             * @memberof jQuery.fn.accessibleMegaMenu
             * @instance
             */
            getOption: function (opt) {
                return this.settings[opt];
            },

            /**
             * @desc Get all options
             * @example $(selector).accessibleMegaMenu("getAllOptions");
             * @return {object}
             * @memberof jQuery.fn.accessibleMegaMenu
             * @instance
             */
            getAllOptions: function () {
                return this.settings;
            },

            /**
             * @desc Set option
             * @example $(selector).accessibleMegaMenu("setOption", "option_name",  "option_value",  reinitialize);
             * @param {string} opt - Option name
             * @param {string} val - Option value
             * @param {boolean} [reinitialize] - boolean to re-initialize the menu.
             * @memberof jQuery.fn.accessibleMegaMenu
             * @instance
             */
            setOption: function (opt, value, reinitialize) {
                this.settings[opt] = value;
                if (reinitialize) {
                    this.init();
                }
            }
        };
    }());

    /* lightweight plugin wrapper around the constructor,
       to prevent against multiple instantiations */

    /**
     * @class accessibleMegaMenu
     * @memberOf jQuery.fn
     * @classdesc Implements an accessible mega menu as a jQuery plugin.
     * <p>The mega-menu It is modeled after the mega menu on {@link http://adobe.com|adobe.com} but has been simplified for use by others. A brief description of the interaction design choices can be found in a blog post at {@link http://blogs.adobe.com/accessibility/2013/05/adobe-com.html|Mega menu accessibility on adobe.com}.</p>
     * <h3>Keyboard Accessibility</h3>
     * <p>The accessible mega menu supports keyboard interaction modeled after the behavior described in the {@link http://www.w3.org/TR/wai-aria-practices/#menu|WAI-ARIA Menu or Menu bar (widget) design pattern}, however we also try to respect users' general expectations for the behavior of links in a global navigation. To this end, the accessible mega menu implementation permits tab focus on each of the six top-level menu items. When one of the menu items has focus, pressing the Enter key, Spacebar or Down arrow will open the submenu panel, and pressing the Left or Right arrow key will shift focus to the adjacent menu item. Links within the submenu panels are included in the tab order when the panel is open. They can also be navigated with the arrow keys or by typing the first character in the link name, which speeds up keyboard navigation considerably. Pressing the Escape key closes the submenu and restores focus to the parent menu item.</p>
     * <h3>Screen Reader Accessibility</h3>
     * <p>The accessible mega menu models its use of WAI-ARIA Roles, States, and Properties after those described in the {@link http://www.w3.org/TR/wai-aria-practices/#menu|WAI-ARIA Menu or Menu bar (widget) design pattern} with some notable exceptions, so that it behaves better with screen reader user expectations for global navigation. We don't use <code class="prettyprint prettyprinted" style=""><span class="pln">role</span><span class="pun">=</span><span class="str">"menu"</span></code> for the menu container and <code class="prettyprint prettyprinted" style=""><span class="pln">role</span><span class="pun">=</span><span class="str">"menuitem"</span></code> for each of the links therein, because if we do, assistive technology will no longer interpret the links as links, but instead, as menu items, and the links in our global navigation will no longer show up when a screen reader user executes a shortcut command to bring up a list of links in the page.</p>
     * @example <h4>HTML</h4><hr/>
&lt;nav&gt;
    &lt;ul class=&quot;nav-menu&quot;&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
            &lt;a href=&quot;?movie&quot;&gt;Movies&lt;/a&gt;
            &lt;div class=&quot;sub-nav&quot;&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=0&quot;&gt;Action &amp;amp; Adventure&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=2&quot;&gt;Children &amp;amp; Family&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=7&quot;&gt;Dramas&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=9&quot;&gt;Foreign&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=14&quot;&gt;Musicals&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?movie&amp;genre=15&quot;&gt;Romance&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
            &lt;a href=&quot;?tv&quot;&gt;TV Shows&lt;/a&gt;
            &lt;div class=&quot;sub-nav&quot;&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=20&quot;&gt;Classic TV&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=21&quot;&gt;Crime TV&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=27&quot;&gt;Reality TV&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=30&quot;&gt;TV Action&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
                &lt;ul class=&quot;sub-nav-group&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=33&quot;&gt;TV Dramas&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href=&quot;?tv&amp;genre=34&quot;&gt;TV Horror&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&amp;#8230;&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;/nav&gt;
     * @example <h4>CSS</h4><hr/>
&#47;* Rudimentary mega menu CSS for demonstration *&#47;

&#47;* mega menu list *&#47;
.nav-menu {
    display: block;
    position: relative;
    list-style: none;
    margin: 0;
    padding: 0;
    z-index: 15;
}

&#47;* a top level navigation item in the mega menu *&#47;
.nav-item {
    list-style: none;
    display: inline-block;
    padding: 0;
    margin: 0;
}

&#47;* first descendant link within a top level navigation item *&#47;
.nav-item &gt; a {
    position: relative;
    display: inline-block;
    padding: 0.5em 1em;
    margin: 0 0 -1px 0;
    border: 1px solid transparent;
}

&#47;* focus/open states of first descendant link within a top level
   navigation item *&#47;
.nav-item &gt; a:focus,
.nav-item &gt; a.open {
    border: 1px solid #dedede;
}

&#47;* open state of first descendant link within a top level
   navigation item *&#47;
.nav-item &gt; a.open {
    background-color: #fff;
    border-bottom: none;
    z-index: 1;
}

&#47;* sub-navigation panel *&#47;
.sub-nav {
    position: absolute;
    display: none;
    top: 2.2em;
    margin-top: -1px;
    padding: 0.5em 1em;
    border: 1px solid #dedede;
    background-color: #fff;
}

&#47;* sub-navigation panel open state *&#47;
.sub-nav.open {
    display: block;
}

&#47;* list of items within sub-navigation panel *&#47;
.sub-nav ul {
    display: inline-block;
    vertical-align: top;
    margin: 0 1em 0 0;
    padding: 0;
}

&#47;* list item within sub-navigation panel *&#47;
.sub-nav li {
    display: block;
    list-style-type: none;
    margin: 0;
    padding: 0;
}
     * @example <h4>JavaScript</h4><hr/>
&lt;!-- include jquery --&gt;
&lt;script src=&quot;http://code.jquery.com/jquery-1.10.1.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- include the jquery-accessibleMegaMenu plugin script --&gt;
&lt;script src=&quot;js/jquery-accessibleMegaMenu.js&quot;&gt;&lt;/script&gt;

&lt;!-- initialize a selector as an accessibleMegaMenu --&gt;
&lt;script&gt;
    $(&quot;nav:first&quot;).accessibleMegaMenu({
        &#47;* prefix for generated unique id attributes, which are required to indicate aria-owns, aria-controls and aria-labelledby *&#47;
        uuidPrefix: &quot;accessible-megamenu&quot;,

        &#47;* css class used to define the megamenu styling *&#47;
        menuClass: &quot;nav-menu&quot;,

        &#47;* css class for a top-level navigation item in the megamenu *&#47;
        topNavItemClass: &quot;nav-item&quot;,

        &#47;* css class for a megamenu panel *&#47;
        panelClass: &quot;sub-nav&quot;,

        &#47;* css class for a group of items within a megamenu panel *&#47;
        panelGroupClass: &quot;sub-nav-group&quot;,

        &#47;* css class for the hover state *&#47;
        hoverClass: &quot;hover&quot;,

        &#47;* css class for the focus state *&#47;
        focusClass: &quot;focus&quot;,

        &#47;* css class for the open state *&#47;
        openClass: &quot;open&quot;
    });
&lt;/script&gt;
     * @param {object} [options] Mega Menu options
     * @param {string} [options.uuidPrefix=accessible-megamenu] - Prefix for generated unique id attributes, which are required to indicate aria-owns, aria-controls and aria-labelledby
     * @param {string} [options.menuClass=accessible-megamenu] - CSS class used to define the megamenu styling
     * @param {string} [options.topNavItemClass=accessible-megamenu-top-nav-item] - CSS class for a top-level navigation item in the megamenu
     * @param {string} [options.panelClass=accessible-megamenu-panel] - CSS class for a megamenu panel
     * @param {string} [options.panelGroupClass=accessible-megamenu-panel-group] - CSS class for a group of items within a megamenu panel
     * @param {string} [options.hoverClass=hover] - CSS class for the hover state
     * @param {string} [options.focusClass=focus] - CSS class for the focus state
     * @param {string} [options.openClass=open] - CSS class for the open state
     */
    $.fn[pluginName] = function (options) {
        return this.each(function () {
            if (!$.data(this, "plugin_" + pluginName)) {
                $.data(this, "plugin_" + pluginName, new $.fn[pluginName].AccessibleMegaMenu(this, options));
            }
        });
    };

    $.fn[pluginName].AccessibleMegaMenu = AccessibleMegaMenu;

    /* :focusable and :tabbable selectors from
       https://raw.github.com/jquery/jquery-ui/master/ui/jquery.ui.core.js */

    /**
     * @private
     */
    function visible(element) {
        return $.expr.filters.visible(element) && !$(element).parents().addBack().filter(function () {
            return $.css(this, "visibility") === "hidden";
        }).length;
    }

    /**
     * @private
     */
    function focusable(element, isTabIndexNotNaN) {
        var map, mapName, img,
            nodeName = element.nodeName.toLowerCase();
        if ("area" === nodeName) {
            map = element.parentNode;
            mapName = map.name;
            if (!element.href || !mapName || map.nodeName.toLowerCase() !== "map") {
                return false;
            }
            img = $("img[usemap=#" + mapName + "]")[0];
            return !!img && visible(img);
        }
        return (/input|select|textarea|button|object/.test(nodeName) ? !element.disabled :
                "a" === nodeName ?
                        element.href || isTabIndexNotNaN :
                        isTabIndexNotNaN) &&
                            // the element and all of its ancestors must be visible
                            visible(element);
    }

    $.extend($.expr[":"], {
        data: $.expr.createPseudo ? $.expr.createPseudo(function (dataName) {
            return function (elem) {
                return !!$.data(elem, dataName);
            };
        }) : // support: jQuery <1.8
                function (elem, i, match) {
                    return !!$.data(elem, match[3]);
                },

        focusable: function (element) {
            return focusable(element, !isNaN($.attr(element, "tabindex")));
        },

        tabbable: function (element) {
            var tabIndex = $.attr(element, "tabindex"),
                isTabIndexNaN = isNaN(tabIndex);
            return (isTabIndexNaN || tabIndex >= 0) && focusable(element, !isTabIndexNaN);
        }
    });
}(jQuery, window, document));

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhc3NldHMvanMvbWFpbi5qcyIsImJvd2VyX2NvbXBvbmVudHMvZW5xdWlyZS9kaXN0L2VucXVpcmUuanMiLCJib3dlcl9jb21wb25lbnRzL2pxdWVyeS1hY2Nlc3NpYmxlTWVnYU1lbnUvanMvanF1ZXJ5LWFjY2Vzc2libGVNZWdhTWVudS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyogZ2xvYmFscyBqUXVlcnkgKi9cblxudmFyIGVucXVpcmUgPSByZXF1aXJlKCcuLi8uLi9ib3dlcl9jb21wb25lbnRzL2VucXVpcmUvZGlzdC9lbnF1aXJlLmpzJylcbnJlcXVpcmUoJy4uLy4uL2Jvd2VyX2NvbXBvbmVudHMvanF1ZXJ5LWFjY2Vzc2libGVNZWdhTWVudS9qcy9qcXVlcnktYWNjZXNzaWJsZU1lZ2FNZW51LmpzJylcblxuJ3VzZSBzdHJpY3QnXG5cbmpRdWVyeShmdW5jdGlvbiAoJCkge1xuICAkKCcuZW1haWxfYnV0dG9uJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgY29uZmlybVxuICAgIGlmICghY29uZmlybSgnQXJlIHlvdSBzdXJlPycpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgdmFyIGRhdGEgPSB7XG4gICAgICBhY3Rpb246ICdzZW5kX2VtYWlsJyxcbiAgICAgIHRhcmdldDogJChlLnRhcmdldCkuYXR0cignaWQnKSxcbiAgICAgIHN1YmplY3Q6ICQoZS50YXJnZXQpLmRhdGEoJ3N1YmplY3QnKSxcbiAgICAgIGJvZHk6ICQoJChlLnRhcmdldCkuZGF0YSgnYm9keScpKS52YWwoKVxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhkYXRhKVxuICAgICQoJy5lbWFpbF9yZXN1bHRzJykucmVtb3ZlQ2xhc3MoJ2FsZXJ0LWRhbmdlcicpXG4gICAgJC5wb3N0KCcvd3AtYWRtaW4vYWRtaW4tYWpheC5waHAnLCBkYXRhLCBmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCB4aHIpIHtcbiAgICAgICQoJy5lbWFpbF9yZXN1bHRzJykuaHRtbChkYXRhKVxuICAgICAgaWYgKHN0YXR1cyAhPT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICQoJy5lbWFpbF9yZXN1bHRzJykuYWRkQ2xhc3MoJ2FsZXJ0LWRhbmdlcicpXG4gICAgICB9XG4gICAgICAkKCcuZW1haWxfcmVzdWx0cycpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKVxuICAgIH0pXG4gIH0pXG59KVxuXG5qUXVlcnkoZnVuY3Rpb24gKCQpIHtcbiAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbiAoKSB7XG4gICAgJCgnLmhlYWRlcicpLmFkZENsYXNzKCdzY3JvbGxlZCcpXG4gIH0pLnJlbW92ZUNsYXNzKCdzY3JvbGxlZCcpXG59KVxuXG5qUXVlcnkoZnVuY3Rpb24gKCQpIHtcbiAgZW5xdWlyZS5yZWdpc3Rlcignc2NyZWVuIGFuZCAobWluLXdpZHRoOjc3OXB4KScsIHtcbiAgICBtYXRjaDogZnVuY3Rpb24gKCkge1xuICAgICAgLy8gTWFpbiBOYXZcbiAgICAgICQoJy5tZW51LWhlYWRlci1tZW51LWNvbnRhaW5lcicpLmFjY2Vzc2libGVNZWdhTWVudSh7XG4gICAgICAgIHV1aWRQcmVmaXg6ICdhY2Nlc3NpYmxlLW5hdicsXG4gICAgICAgIG1lbnVDbGFzczogJ25hdi1tZW51JyxcbiAgICAgICAgdG9wTmF2SXRlbUNsYXNzOiAnbmF2LWl0ZW0nLFxuICAgICAgICBwYW5lbENsYXNzOiAnc3ViLW5hdicsXG4gICAgICAgIHBhbmVsR3JvdXBDbGFzczogJ3N1Yi1uYXYtZ3JvdXAnLFxuICAgICAgICBob3ZlckNsYXNzOiAnaG92ZXInLFxuICAgICAgICBmb2N1c0NsYXNzOiAnZm9jdXMnLFxuICAgICAgICBvcGVuQ2xhc3M6ICdvcGVuJ1xuICAgICAgfSlcbiAgICAgIC8vIGhhY2sgc28gdGhhdCB0aGUgbWVnYW1lbnUgZG9lc24ndCBzaG93IGZsYXNoIG9mIGNzcyBhbmltYXRpb24gYWZ0ZXIgdGhlIHBhZ2UgbG9hZHMuXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdpbml0JylcbiAgICAgIH0sIDUwMClcbiAgICAgIC8vIENoYW5nZSBhcmlhLWhpZGRlbiBzdGF0ZVxuICAgICAgJCgnI2pzLW5hdmlnYXRpb24tdG9nZ2xlJykuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpXG4gICAgfSxcbiAgICB1bm1hdGNoOiBmdW5jdGlvbiAoKSB7XG4gICAgfVxuICB9KVxufSlcbiIsIi8qIVxuICogZW5xdWlyZS5qcyB2Mi4xLjIgLSBBd2Vzb21lIE1lZGlhIFF1ZXJpZXMgaW4gSmF2YVNjcmlwdFxuICogQ29weXJpZ2h0IChjKSAyMDE0IE5pY2sgV2lsbGlhbXMgLSBodHRwOi8vd2lja3kubmlsbGlhLm1zL2VucXVpcmUuanNcbiAqIExpY2Vuc2U6IE1JVCAoaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHApXG4gKi9cblxuOyhmdW5jdGlvbiAobmFtZSwgY29udGV4dCwgZmFjdG9yeSkge1xuXHR2YXIgbWF0Y2hNZWRpYSA9IHdpbmRvdy5tYXRjaE1lZGlhO1xuXG5cdGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShtYXRjaE1lZGlhKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcblx0XHRkZWZpbmUoZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gKGNvbnRleHRbbmFtZV0gPSBmYWN0b3J5KG1hdGNoTWVkaWEpKTtcblx0XHR9KTtcblx0fVxuXHRlbHNlIHtcblx0XHRjb250ZXh0W25hbWVdID0gZmFjdG9yeShtYXRjaE1lZGlhKTtcblx0fVxufSgnZW5xdWlyZScsIHRoaXMsIGZ1bmN0aW9uIChtYXRjaE1lZGlhKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXG4gICAgLypqc2hpbnQgdW51c2VkOmZhbHNlICovXG4gICAgLyoqXG4gICAgICogSGVscGVyIGZ1bmN0aW9uIGZvciBpdGVyYXRpbmcgb3ZlciBhIGNvbGxlY3Rpb25cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIGZuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZWFjaChjb2xsZWN0aW9uLCBmbikge1xuICAgICAgICB2YXIgaSAgICAgID0gMCxcbiAgICAgICAgICAgIGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoLFxuICAgICAgICAgICAgY29udDtcblxuICAgICAgICBmb3IoaTsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb250ID0gZm4oY29sbGVjdGlvbltpXSwgaSk7XG4gICAgICAgICAgICBpZihjb250ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIGJyZWFrOyAvL2FsbG93IGVhcmx5IGV4aXRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhlbHBlciBmdW5jdGlvbiBmb3IgZGV0ZXJtaW5pbmcgd2hldGhlciB0YXJnZXQgb2JqZWN0IGlzIGFuIGFycmF5XG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGFyZ2V0IHRoZSBvYmplY3QgdW5kZXIgdGVzdFxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgYXJyYXksIGZhbHNlIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzQXJyYXkodGFyZ2V0KSB7XG4gICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KHRhcmdldCkgPT09ICdbb2JqZWN0IEFycmF5XSc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGVscGVyIGZ1bmN0aW9uIGZvciBkZXRlcm1pbmluZyB3aGV0aGVyIHRhcmdldCBvYmplY3QgaXMgYSBmdW5jdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIHRhcmdldCB0aGUgb2JqZWN0IHVuZGVyIHRlc3RcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlIGlmIGZ1bmN0aW9uLCBmYWxzZSBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0Z1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHRhcmdldCA9PT0gJ2Z1bmN0aW9uJztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxlZ2F0ZSB0byBoYW5kbGUgYSBtZWRpYSBxdWVyeSBiZWluZyBtYXRjaGVkIGFuZCB1bm1hdGNoZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gb3B0aW9uc1xuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IG9wdGlvbnMubWF0Y2ggY2FsbGJhY2sgZm9yIHdoZW4gdGhlIG1lZGlhIHF1ZXJ5IGlzIG1hdGNoZWRcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbb3B0aW9ucy51bm1hdGNoXSBjYWxsYmFjayBmb3Igd2hlbiB0aGUgbWVkaWEgcXVlcnkgaXMgdW5tYXRjaGVkXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gW29wdGlvbnMuc2V0dXBdIG9uZS10aW1lIGNhbGxiYWNrIHRyaWdnZXJlZCB0aGUgZmlyc3QgdGltZSBhIHF1ZXJ5IGlzIG1hdGNoZWRcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmRlZmVyU2V0dXA9ZmFsc2VdIHNob3VsZCB0aGUgc2V0dXAgY2FsbGJhY2sgYmUgcnVuIGltbWVkaWF0ZWx5LCByYXRoZXIgdGhhbiBmaXJzdCB0aW1lIHF1ZXJ5IGlzIG1hdGNoZWQ/XG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgZnVuY3Rpb24gUXVlcnlIYW5kbGVyKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgIW9wdGlvbnMuZGVmZXJTZXR1cCAmJiB0aGlzLnNldHVwKCk7XG4gICAgfVxuICAgIFF1ZXJ5SGFuZGxlci5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGNvb3JkaW5hdGVzIHNldHVwIG9mIHRoZSBoYW5kbGVyXG4gICAgICAgICAqXG4gICAgICAgICAqIEBmdW5jdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgc2V0dXAgOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKHRoaXMub3B0aW9ucy5zZXR1cCkge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zZXR1cCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXNlZCA9IHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGNvb3JkaW5hdGVzIHNldHVwIGFuZCB0cmlnZ2VyaW5nIG9mIHRoZSBoYW5kbGVyXG4gICAgICAgICAqXG4gICAgICAgICAqIEBmdW5jdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgb24gOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICF0aGlzLmluaXRpYWxpc2VkICYmIHRoaXMuc2V0dXAoKTtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tYXRjaCAmJiB0aGlzLm9wdGlvbnMubWF0Y2goKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogY29vcmRpbmF0ZXMgdGhlIHVubWF0Y2ggZXZlbnQgZm9yIHRoZSBoYW5kbGVyXG4gICAgICAgICAqXG4gICAgICAgICAqIEBmdW5jdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgb2ZmIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMudW5tYXRjaCAmJiB0aGlzLm9wdGlvbnMudW5tYXRjaCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBjYWxsZWQgd2hlbiBhIGhhbmRsZXIgaXMgdG8gYmUgZGVzdHJveWVkLlxuICAgICAgICAgKiBkZWxlZ2F0ZXMgdG8gdGhlIGRlc3Ryb3kgb3IgdW5tYXRjaCBjYWxsYmFja3MsIGRlcGVuZGluZyBvbiBhdmFpbGFiaWxpdHkuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBmdW5jdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgZGVzdHJveSA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRlc3Ryb3kgPyB0aGlzLm9wdGlvbnMuZGVzdHJveSgpIDogdGhpcy5vZmYoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogZGV0ZXJtaW5lcyBlcXVhbGl0eSBieSByZWZlcmVuY2UuXG4gICAgICAgICAqIGlmIG9iamVjdCBpcyBzdXBwbGllZCBjb21wYXJlIG9wdGlvbnMsIGlmIGZ1bmN0aW9uLCBjb21wYXJlIG1hdGNoIGNhbGxiYWNrXG4gICAgICAgICAqXG4gICAgICAgICAqIEBmdW5jdGlvblxuICAgICAgICAgKiBAcGFyYW0ge29iamVjdCB8fCBmdW5jdGlvbn0gW3RhcmdldF0gdGhlIHRhcmdldCBmb3IgY29tcGFyaXNvblxuICAgICAgICAgKi9cbiAgICAgICAgZXF1YWxzIDogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zID09PSB0YXJnZXQgfHwgdGhpcy5vcHRpb25zLm1hdGNoID09PSB0YXJnZXQ7XG4gICAgICAgIH1cblxuICAgIH07XG4gICAgLyoqXG4gICAgICogUmVwcmVzZW50cyBhIHNpbmdsZSBtZWRpYSBxdWVyeSwgbWFuYWdlcyBpdCdzIHN0YXRlIGFuZCByZWdpc3RlcmVkIGhhbmRsZXJzIGZvciB0aGlzIHF1ZXJ5XG4gICAgICpcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcXVlcnkgdGhlIG1lZGlhIHF1ZXJ5IHN0cmluZ1xuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzVW5jb25kaXRpb25hbD1mYWxzZV0gd2hldGhlciB0aGUgbWVkaWEgcXVlcnkgc2hvdWxkIHJ1biByZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhlIGNvbmRpdGlvbnMgYXJlIG1ldC4gUHJpbWFyaWx5IGZvciBoZWxwaW5nIG9sZGVyIGJyb3dzZXJzIGRlYWwgd2l0aCBtb2JpbGUtZmlyc3QgZGVzaWduXG4gICAgICovXG4gICAgZnVuY3Rpb24gTWVkaWFRdWVyeShxdWVyeSwgaXNVbmNvbmRpdGlvbmFsKSB7XG4gICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeTtcbiAgICAgICAgdGhpcy5pc1VuY29uZGl0aW9uYWwgPSBpc1VuY29uZGl0aW9uYWw7XG4gICAgICAgIHRoaXMuaGFuZGxlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5tcWwgPSBtYXRjaE1lZGlhKHF1ZXJ5KTtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMubGlzdGVuZXIgPSBmdW5jdGlvbihtcWwpIHtcbiAgICAgICAgICAgIHNlbGYubXFsID0gbXFsO1xuICAgICAgICAgICAgc2VsZi5hc3Nlc3MoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tcWwuYWRkTGlzdGVuZXIodGhpcy5saXN0ZW5lcik7XG4gICAgfVxuICAgIE1lZGlhUXVlcnkucHJvdG90eXBlID0ge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBhZGQgYSBoYW5kbGVyIGZvciB0aGlzIHF1ZXJ5LCB0cmlnZ2VyaW5nIGlmIGFscmVhZHkgYWN0aXZlXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBoYW5kbGVyXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGhhbmRsZXIubWF0Y2ggY2FsbGJhY2sgZm9yIHdoZW4gcXVlcnkgaXMgYWN0aXZhdGVkXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtoYW5kbGVyLnVubWF0Y2hdIGNhbGxiYWNrIGZvciB3aGVuIHF1ZXJ5IGlzIGRlYWN0aXZhdGVkXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtoYW5kbGVyLnNldHVwXSBjYWxsYmFjayBmb3IgaW1tZWRpYXRlIGV4ZWN1dGlvbiB3aGVuIGEgcXVlcnkgaGFuZGxlciBpcyByZWdpc3RlcmVkXG4gICAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2hhbmRsZXIuZGVmZXJTZXR1cD1mYWxzZV0gc2hvdWxkIHRoZSBzZXR1cCBjYWxsYmFjayBiZSBkZWZlcnJlZCB1bnRpbCB0aGUgZmlyc3QgdGltZSB0aGUgaGFuZGxlciBpcyBtYXRjaGVkP1xuICAgICAgICAgKi9cbiAgICAgICAgYWRkSGFuZGxlciA6IGZ1bmN0aW9uKGhhbmRsZXIpIHtcbiAgICAgICAgICAgIHZhciBxaCA9IG5ldyBRdWVyeUhhbmRsZXIoaGFuZGxlcik7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZXJzLnB1c2gocWgpO1xuXG4gICAgICAgICAgICB0aGlzLm1hdGNoZXMoKSAmJiBxaC5vbigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiByZW1vdmVzIHRoZSBnaXZlbiBoYW5kbGVyIGZyb20gdGhlIGNvbGxlY3Rpb24sIGFuZCBjYWxscyBpdCdzIGRlc3Ryb3kgbWV0aG9kc1xuICAgICAgICAgKiBcbiAgICAgICAgICogQHBhcmFtIHtvYmplY3QgfHwgZnVuY3Rpb259IGhhbmRsZXIgdGhlIGhhbmRsZXIgdG8gcmVtb3ZlXG4gICAgICAgICAqL1xuICAgICAgICByZW1vdmVIYW5kbGVyIDogZnVuY3Rpb24oaGFuZGxlcikge1xuICAgICAgICAgICAgdmFyIGhhbmRsZXJzID0gdGhpcy5oYW5kbGVycztcbiAgICAgICAgICAgIGVhY2goaGFuZGxlcnMsIGZ1bmN0aW9uKGgsIGkpIHtcbiAgICAgICAgICAgICAgICBpZihoLmVxdWFscyhoYW5kbGVyKSkge1xuICAgICAgICAgICAgICAgICAgICBoLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFoYW5kbGVycy5zcGxpY2UoaSwxKTsgLy9yZW1vdmUgZnJvbSBhcnJheSBhbmQgZXhpdCBlYWNoIGVhcmx5XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERldGVybWluZSB3aGV0aGVyIHRoZSBtZWRpYSBxdWVyeSBzaG91bGQgYmUgY29uc2lkZXJlZCBhIG1hdGNoXG4gICAgICAgICAqIFxuICAgICAgICAgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlIGlmIG1lZGlhIHF1ZXJ5IGNhbiBiZSBjb25zaWRlcmVkIGEgbWF0Y2gsIGZhbHNlIG90aGVyd2lzZVxuICAgICAgICAgKi9cbiAgICAgICAgbWF0Y2hlcyA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubXFsLm1hdGNoZXMgfHwgdGhpcy5pc1VuY29uZGl0aW9uYWw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENsZWFycyBhbGwgaGFuZGxlcnMgYW5kIHVuYmluZHMgZXZlbnRzXG4gICAgICAgICAqL1xuICAgICAgICBjbGVhciA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZWFjaCh0aGlzLmhhbmRsZXJzLCBmdW5jdGlvbihoYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5kZXN0cm95KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMubXFsLnJlbW92ZUxpc3RlbmVyKHRoaXMubGlzdGVuZXIpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVycy5sZW5ndGggPSAwOyAvL2NsZWFyIGFycmF5XG4gICAgICAgIH0sXG5cbiAgICAgICAgLypcbiAgICAgICAgICogQXNzZXNzZXMgdGhlIHF1ZXJ5LCB0dXJuaW5nIG9uIGFsbCBoYW5kbGVycyBpZiBpdCBtYXRjaGVzLCB0dXJuaW5nIHRoZW0gb2ZmIGlmIGl0IGRvZXNuJ3QgbWF0Y2hcbiAgICAgICAgICovXG4gICAgICAgIGFzc2VzcyA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHRoaXMubWF0Y2hlcygpID8gJ29uJyA6ICdvZmYnO1xuXG4gICAgICAgICAgICBlYWNoKHRoaXMuaGFuZGxlcnMsIGZ1bmN0aW9uKGhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVyW2FjdGlvbl0oKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBBbGxvd3MgZm9yIHJlZ2lzdHJhdGlvbiBvZiBxdWVyeSBoYW5kbGVycy5cbiAgICAgKiBNYW5hZ2VzIHRoZSBxdWVyeSBoYW5kbGVyJ3Mgc3RhdGUgYW5kIGlzIHJlc3BvbnNpYmxlIGZvciB3aXJpbmcgdXAgYnJvd3NlciBldmVudHNcbiAgICAgKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGZ1bmN0aW9uIE1lZGlhUXVlcnlEaXNwYXRjaCAoKSB7XG4gICAgICAgIGlmKCFtYXRjaE1lZGlhKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hdGNoTWVkaWEgbm90IHByZXNlbnQsIGxlZ2FjeSBicm93c2VycyByZXF1aXJlIGEgcG9seWZpbGwnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucXVlcmllcyA9IHt9O1xuICAgICAgICB0aGlzLmJyb3dzZXJJc0luY2FwYWJsZSA9ICFtYXRjaE1lZGlhKCdvbmx5IGFsbCcpLm1hdGNoZXM7XG4gICAgfVxuXG4gICAgTWVkaWFRdWVyeURpc3BhdGNoLnByb3RvdHlwZSA9IHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVnaXN0ZXJzIGEgaGFuZGxlciBmb3IgdGhlIGdpdmVuIG1lZGlhIHF1ZXJ5XG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBxIHRoZSBtZWRpYSBxdWVyeVxuICAgICAgICAgKiBAcGFyYW0ge29iamVjdCB8fCBBcnJheSB8fCBGdW5jdGlvbn0gb3B0aW9ucyBlaXRoZXIgYSBzaW5nbGUgcXVlcnkgaGFuZGxlciBvYmplY3QsIGEgZnVuY3Rpb24sIG9yIGFuIGFycmF5IG9mIHF1ZXJ5IGhhbmRsZXJzXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IG9wdGlvbnMubWF0Y2ggZmlyZWQgd2hlbiBxdWVyeSBtYXRjaGVkXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtvcHRpb25zLnVubWF0Y2hdIGZpcmVkIHdoZW4gYSBxdWVyeSBpcyBubyBsb25nZXIgbWF0Y2hlZFxuICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbb3B0aW9ucy5zZXR1cF0gZmlyZWQgd2hlbiBoYW5kbGVyIGZpcnN0IHRyaWdnZXJlZFxuICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmRlZmVyU2V0dXA9ZmFsc2VdIHdoZXRoZXIgc2V0dXAgc2hvdWxkIGJlIHJ1biBpbW1lZGlhdGVseSBvciBkZWZlcnJlZCB1bnRpbCBxdWVyeSBpcyBmaXJzdCBtYXRjaGVkXG4gICAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3Nob3VsZERlZ3JhZGU9ZmFsc2VdIHdoZXRoZXIgdGhpcyBwYXJ0aWN1bGFyIG1lZGlhIHF1ZXJ5IHNob3VsZCBhbHdheXMgcnVuIG9uIGluY2FwYWJsZSBicm93c2Vyc1xuICAgICAgICAgKi9cbiAgICAgICAgcmVnaXN0ZXIgOiBmdW5jdGlvbihxLCBvcHRpb25zLCBzaG91bGREZWdyYWRlKSB7XG4gICAgICAgICAgICB2YXIgcXVlcmllcyAgICAgICAgID0gdGhpcy5xdWVyaWVzLFxuICAgICAgICAgICAgICAgIGlzVW5jb25kaXRpb25hbCA9IHNob3VsZERlZ3JhZGUgJiYgdGhpcy5icm93c2VySXNJbmNhcGFibGU7XG5cbiAgICAgICAgICAgIGlmKCFxdWVyaWVzW3FdKSB7XG4gICAgICAgICAgICAgICAgcXVlcmllc1txXSA9IG5ldyBNZWRpYVF1ZXJ5KHEsIGlzVW5jb25kaXRpb25hbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vbm9ybWFsaXNlIHRvIG9iamVjdCBpbiBhbiBhcnJheVxuICAgICAgICAgICAgaWYoaXNGdW5jdGlvbihvcHRpb25zKSkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7IG1hdGNoIDogb3B0aW9ucyB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIWlzQXJyYXkob3B0aW9ucykpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gW29wdGlvbnNdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWFjaChvcHRpb25zLCBmdW5jdGlvbihoYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzRnVuY3Rpb24oaGFuZGxlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlciA9IHsgbWF0Y2ggOiBoYW5kbGVyIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHF1ZXJpZXNbcV0uYWRkSGFuZGxlcihoYW5kbGVyKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogdW5yZWdpc3RlcnMgYSBxdWVyeSBhbmQgYWxsIGl0J3MgaGFuZGxlcnMsIG9yIGEgc3BlY2lmaWMgaGFuZGxlciBmb3IgYSBxdWVyeVxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gcSB0aGUgbWVkaWEgcXVlcnkgdG8gdGFyZ2V0XG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0IHx8IGZ1bmN0aW9ufSBbaGFuZGxlcl0gc3BlY2lmaWMgaGFuZGxlciB0byB1bnJlZ2lzdGVyXG4gICAgICAgICAqL1xuICAgICAgICB1bnJlZ2lzdGVyIDogZnVuY3Rpb24ocSwgaGFuZGxlcikge1xuICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy5xdWVyaWVzW3FdO1xuXG4gICAgICAgICAgICBpZihxdWVyeSkge1xuICAgICAgICAgICAgICAgIGlmKGhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnkucmVtb3ZlSGFuZGxlcihoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5LmNsZWFyKCk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnF1ZXJpZXNbcV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgIH07XG5cblx0cmV0dXJuIG5ldyBNZWRpYVF1ZXJ5RGlzcGF0Y2goKTtcblxufSkpOyIsIi8qXG5Db3B5cmlnaHQgwqkgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIOKAnExpY2Vuc2XigJ0pO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbmh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiDigJxBUyBJU+KAnSBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG4vKipcbiAqIFNlZSA8YSBocmVmPVwiaHR0cDovL2pxdWVyeS5jb21cIj5odHRwOi8vanF1ZXJ5LmNvbTwvYT4uXG4gKiBAbmFtZSBqcXVlcnlcbiAqIEBjbGFzc1xuICogU2VlIHRoZSBqUXVlcnkgTGlicmFyeSAgKDxhIGhyZWY9XCJodHRwOi8vanF1ZXJ5LmNvbVwiPmh0dHA6Ly9qcXVlcnkuY29tPC9hPikgZm9yIGZ1bGwgZGV0YWlscy4gIFRoaXMganVzdFxuICogZG9jdW1lbnRzIHRoZSBmdW5jdGlvbiBhbmQgY2xhc3NlcyB0aGF0IGFyZSBhZGRlZCB0byBqUXVlcnkgYnkgdGhpcyBwbHVnLWluLlxuICovXG5cbi8qKlxuICogU2VlIDxhIGhyZWY9XCJodHRwOi8vanF1ZXJ5LmNvbVwiPmh0dHA6Ly9qcXVlcnkuY29tPC9hPlxuICogQG5hbWUgZm5cbiAqIEBjbGFzc1xuICogU2VlIHRoZSBqUXVlcnkgTGlicmFyeSAgKDxhIGhyZWY9XCJodHRwOi8vanF1ZXJ5LmNvbVwiPmh0dHA6Ly9qcXVlcnkuY29tPC9hPikgZm9yIGZ1bGwgZGV0YWlscy4gIFRoaXMganVzdFxuICogZG9jdW1lbnRzIHRoZSBmdW5jdGlvbiBhbmQgY2xhc3NlcyB0aGF0IGFyZSBhZGRlZCB0byBqUXVlcnkgYnkgdGhpcyBwbHVnLWluLlxuICogQG1lbWJlck9mIGpxdWVyeVxuICovXG5cbi8qKlxuICogQGZpbGVPdmVydmlldyBhY2Nlc3NpYmxlTWVnYU1lbnUgcGx1Z2luXG4gKlxuICo8cD5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUg4oCcTGljZW5zZeKAnSlcbiAqPGJyIC8+Q29weXJpZ2h0IMKpIDIwMTMgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQuXG4gKjxiciAvPlByb2plY3QgcGFnZSA8YSBocmVmPVwiaHR0cHM6Ly9naXRodWIuY29tL2Fkb2JlLWFjY2Vzc2liaWxpdHkvQWNjZXNzaWJsZS1NZWdhLU1lbnVcIj5odHRwczovL2dpdGh1Yi5jb20vYWRvYmUtYWNjZXNzaWJpbGl0eS9BY2Nlc3NpYmxlLU1lZ2EtTWVudTwvYT5cbiAqIEB2ZXJzaW9uIDAuMVxuICogQGF1dGhvciBNaWNoYWVsIEpvcmRhblxuICogQHJlcXVpcmVzIGpxdWVyeVxuICovXG5cbi8qanNsaW50IGJyb3dzZXI6IHRydWUsIGRldmVsOiB0cnVlLCBwbHVzcGx1czogdHJ1ZSwgbm9tZW46IHRydWUgKi9cbi8qZ2xvYmFsIGpRdWVyeSAqL1xuKGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50KSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgdmFyIHBsdWdpbk5hbWUgPSBcImFjY2Vzc2libGVNZWdhTWVudVwiLFxuICAgICAgICBkZWZhdWx0cyA9IHtcbiAgICAgICAgICAgIHV1aWRQcmVmaXg6IFwiYWNjZXNzaWJsZS1tZWdhbWVudVwiLCAvLyB1bmlxdWUgSUQncyBhcmUgcmVxdWlyZWQgdG8gaW5kaWNhdGUgYXJpYS1vd25zLCBhcmlhLWNvbnRyb2xzIGFuZCBhcmlhLWxhYmVsbGVkYnlcbiAgICAgICAgICAgIG1lbnVDbGFzczogXCJhY2Nlc3NpYmxlLW1lZ2FtZW51XCIsIC8vIGRlZmF1bHQgY3NzIGNsYXNzIHVzZWQgdG8gZGVmaW5lIHRoZSBtZWdhbWVudSBzdHlsaW5nXG4gICAgICAgICAgICB0b3BOYXZJdGVtQ2xhc3M6IFwiYWNjZXNzaWJsZS1tZWdhbWVudS10b3AtbmF2LWl0ZW1cIiwgLy8gZGVmYXVsdCBjc3MgY2xhc3MgZm9yIGEgdG9wLWxldmVsIG5hdmlnYXRpb24gaXRlbSBpbiB0aGUgbWVnYW1lbnVcbiAgICAgICAgICAgIHBhbmVsQ2xhc3M6IFwiYWNjZXNzaWJsZS1tZWdhbWVudS1wYW5lbFwiLCAvLyBkZWZhdWx0IGNzcyBjbGFzcyBmb3IgYSBtZWdhbWVudSBwYW5lbFxuICAgICAgICAgICAgcGFuZWxHcm91cENsYXNzOiBcImFjY2Vzc2libGUtbWVnYW1lbnUtcGFuZWwtZ3JvdXBcIiwgLy8gZGVmYXVsdCBjc3MgY2xhc3MgZm9yIGEgZ3JvdXAgb2YgaXRlbXMgd2l0aGluIGEgbWVnYW1lbnUgcGFuZWxcbiAgICAgICAgICAgIGhvdmVyQ2xhc3M6IFwiaG92ZXJcIiwgLy8gZGVmYXVsdCBjc3MgY2xhc3MgZm9yIHRoZSBob3ZlciBzdGF0ZVxuICAgICAgICAgICAgZm9jdXNDbGFzczogXCJmb2N1c1wiLCAvLyBkZWZhdWx0IGNzcyBjbGFzcyBmb3IgdGhlIGZvY3VzIHN0YXRlXG4gICAgICAgICAgICBvcGVuQ2xhc3M6IFwib3BlblwiIC8vIGRlZmF1bHQgY3NzIGNsYXNzIGZvciB0aGUgb3BlbiBzdGF0ZVxuICAgICAgICB9LFxuICAgICAgICBLZXlib2FyZCA9IHtcbiAgICAgICAgICAgIEJBQ0tTUEFDRTogOCxcbiAgICAgICAgICAgIENPTU1BOiAxODgsXG4gICAgICAgICAgICBERUxFVEU6IDQ2LFxuICAgICAgICAgICAgRE9XTjogNDAsXG4gICAgICAgICAgICBFTkQ6IDM1LFxuICAgICAgICAgICAgRU5URVI6IDEzLFxuICAgICAgICAgICAgRVNDQVBFOiAyNyxcbiAgICAgICAgICAgIEhPTUU6IDM2LFxuICAgICAgICAgICAgTEVGVDogMzcsXG4gICAgICAgICAgICBQQUdFX0RPV046IDM0LFxuICAgICAgICAgICAgUEFHRV9VUDogMzMsXG4gICAgICAgICAgICBQRVJJT0Q6IDE5MCxcbiAgICAgICAgICAgIFJJR0hUOiAzOSxcbiAgICAgICAgICAgIFNQQUNFOiAzMixcbiAgICAgICAgICAgIFRBQjogOSxcbiAgICAgICAgICAgIFVQOiAzOCxcbiAgICAgICAgICAgIGtleU1hcDoge1xuICAgICAgICAgICAgICAgIDQ4OiBcIjBcIixcbiAgICAgICAgICAgICAgICA0OTogXCIxXCIsXG4gICAgICAgICAgICAgICAgNTA6IFwiMlwiLFxuICAgICAgICAgICAgICAgIDUxOiBcIjNcIixcbiAgICAgICAgICAgICAgICA1MjogXCI0XCIsXG4gICAgICAgICAgICAgICAgNTM6IFwiNVwiLFxuICAgICAgICAgICAgICAgIDU0OiBcIjZcIixcbiAgICAgICAgICAgICAgICA1NTogXCI3XCIsXG4gICAgICAgICAgICAgICAgNTY6IFwiOFwiLFxuICAgICAgICAgICAgICAgIDU3OiBcIjlcIixcbiAgICAgICAgICAgICAgICA1OTogXCI7XCIsXG4gICAgICAgICAgICAgICAgNjU6IFwiYVwiLFxuICAgICAgICAgICAgICAgIDY2OiBcImJcIixcbiAgICAgICAgICAgICAgICA2NzogXCJjXCIsXG4gICAgICAgICAgICAgICAgNjg6IFwiZFwiLFxuICAgICAgICAgICAgICAgIDY5OiBcImVcIixcbiAgICAgICAgICAgICAgICA3MDogXCJmXCIsXG4gICAgICAgICAgICAgICAgNzE6IFwiZ1wiLFxuICAgICAgICAgICAgICAgIDcyOiBcImhcIixcbiAgICAgICAgICAgICAgICA3MzogXCJpXCIsXG4gICAgICAgICAgICAgICAgNzQ6IFwialwiLFxuICAgICAgICAgICAgICAgIDc1OiBcImtcIixcbiAgICAgICAgICAgICAgICA3NjogXCJsXCIsXG4gICAgICAgICAgICAgICAgNzc6IFwibVwiLFxuICAgICAgICAgICAgICAgIDc4OiBcIm5cIixcbiAgICAgICAgICAgICAgICA3OTogXCJvXCIsXG4gICAgICAgICAgICAgICAgODA6IFwicFwiLFxuICAgICAgICAgICAgICAgIDgxOiBcInFcIixcbiAgICAgICAgICAgICAgICA4MjogXCJyXCIsXG4gICAgICAgICAgICAgICAgODM6IFwic1wiLFxuICAgICAgICAgICAgICAgIDg0OiBcInRcIixcbiAgICAgICAgICAgICAgICA4NTogXCJ1XCIsXG4gICAgICAgICAgICAgICAgODY6IFwidlwiLFxuICAgICAgICAgICAgICAgIDg3OiBcIndcIixcbiAgICAgICAgICAgICAgICA4ODogXCJ4XCIsXG4gICAgICAgICAgICAgICAgODk6IFwieVwiLFxuICAgICAgICAgICAgICAgIDkwOiBcInpcIixcbiAgICAgICAgICAgICAgICA5NjogXCIwXCIsXG4gICAgICAgICAgICAgICAgOTc6IFwiMVwiLFxuICAgICAgICAgICAgICAgIDk4OiBcIjJcIixcbiAgICAgICAgICAgICAgICA5OTogXCIzXCIsXG4gICAgICAgICAgICAgICAgMTAwOiBcIjRcIixcbiAgICAgICAgICAgICAgICAxMDE6IFwiNVwiLFxuICAgICAgICAgICAgICAgIDEwMjogXCI2XCIsXG4gICAgICAgICAgICAgICAgMTAzOiBcIjdcIixcbiAgICAgICAgICAgICAgICAxMDQ6IFwiOFwiLFxuICAgICAgICAgICAgICAgIDEwNTogXCI5XCIsXG4gICAgICAgICAgICAgICAgMTkwOiBcIi5cIlxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIC8qKlxuICAgICAqIEBkZXNjIENyZWF0ZXMgYSBuZXcgYWNjZXNzaWJsZSBtZWdhIG1lbnUgaW5zdGFuY2UuXG4gICAgICogQHBhcmFtIHtqcXVlcnl9IGVsZW1lbnRcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW29wdGlvbnNdIE1lZ2EgTWVudSBvcHRpb25zXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnV1aWRQcmVmaXg9YWNjZXNzaWJsZS1tZWdhbWVudV0gLSBQcmVmaXggZm9yIGdlbmVyYXRlZCB1bmlxdWUgaWQgYXR0cmlidXRlcywgd2hpY2ggYXJlIHJlcXVpcmVkIHRvIGluZGljYXRlIGFyaWEtb3ducywgYXJpYS1jb250cm9scyBhbmQgYXJpYS1sYWJlbGxlZGJ5XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLm1lbnVDbGFzcz1hY2Nlc3NpYmxlLW1lZ2FtZW51XSAtIENTUyBjbGFzcyB1c2VkIHRvIGRlZmluZSB0aGUgbWVnYW1lbnUgc3R5bGluZ1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy50b3BOYXZJdGVtQ2xhc3M9YWNjZXNzaWJsZS1tZWdhbWVudS10b3AtbmF2LWl0ZW1dIC0gQ1NTIGNsYXNzIGZvciBhIHRvcC1sZXZlbCBuYXZpZ2F0aW9uIGl0ZW0gaW4gdGhlIG1lZ2FtZW51XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnBhbmVsQ2xhc3M9YWNjZXNzaWJsZS1tZWdhbWVudS1wYW5lbF0gLSBDU1MgY2xhc3MgZm9yIGEgbWVnYW1lbnUgcGFuZWxcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMucGFuZWxHcm91cENsYXNzPWFjY2Vzc2libGUtbWVnYW1lbnUtcGFuZWwtZ3JvdXBdIC0gQ1NTIGNsYXNzIGZvciBhIGdyb3VwIG9mIGl0ZW1zIHdpdGhpbiBhIG1lZ2FtZW51IHBhbmVsXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLmhvdmVyQ2xhc3M9aG92ZXJdIC0gQ1NTIGNsYXNzIGZvciB0aGUgaG92ZXIgc3RhdGVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuZm9jdXNDbGFzcz1mb2N1c10gLSBDU1MgY2xhc3MgZm9yIHRoZSBmb2N1cyBzdGF0ZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5vcGVuQ2xhc3M9b3Blbl0gLSBDU1MgY2xhc3MgZm9yIHRoZSBvcGVuIHN0YXRlXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgZnVuY3Rpb24gQWNjZXNzaWJsZU1lZ2FNZW51KGVsZW1lbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcblxuICAgICAgICAvLyBtZXJnZSBvcHRpb25hbCBzZXR0aW5ncyBhbmQgZGVmYXVsdHMgaW50byBzZXR0aW5nc1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gJC5leHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLl9kZWZhdWx0cyA9IGRlZmF1bHRzO1xuICAgICAgICB0aGlzLl9uYW1lID0gcGx1Z2luTmFtZTtcblxuICAgICAgICB0aGlzLm1vdXNlVGltZW91dElEID0gbnVsbDtcbiAgICAgICAgdGhpcy5mb2N1c1RpbWVvdXRJRCA9IG51bGw7XG4gICAgICAgIHRoaXMubW91c2VGb2N1c2VkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuanVzdEZvY3VzZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG5cbiAgICBBY2Nlc3NpYmxlTWVnYU1lbnUucHJvdG90eXBlID0gKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAvKiBwcml2YXRlIGF0dHJpYnV0ZXMgYW5kIG1ldGhvZHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG4gICAgICAgIHZhciB1dWlkID0gMCxcbiAgICAgICAgICAgIGtleWRvd25UaW1lb3V0RHVyYXRpb24gPSAxMDAwLFxuICAgICAgICAgICAga2V5ZG93blNlYXJjaFN0cmluZyA9IFwiXCIsXG4gICAgICAgICAgICBpc1RvdWNoID0gdHlwZW9mIHdpbmRvdy5oYXNPd25Qcm9wZXJ0eSA9PT0gXCJmdW5jdGlvblwiICYmICEhd2luZG93Lmhhc093blByb3BlcnR5KFwib250b3VjaHN0YXJ0XCIpLFxuICAgICAgICAgICAgX2dldFBsdWdpbixcbiAgICAgICAgICAgIF9hZGRVbmlxdWVJZCxcbiAgICAgICAgICAgIF90b2dnbGVQYW5lbCxcbiAgICAgICAgICAgIF9jbGlja0hhbmRsZXIsXG4gICAgICAgICAgICBfY2xpY2tPdXRzaWRlSGFuZGxlcixcbiAgICAgICAgICAgIF9ET01BdHRyTW9kaWZpZWRIYW5kbGVyLFxuICAgICAgICAgICAgX2ZvY3VzSW5IYW5kbGVyLFxuICAgICAgICAgICAgX2ZvY3VzT3V0SGFuZGxlcixcbiAgICAgICAgICAgIF9rZXlEb3duSGFuZGxlcixcbiAgICAgICAgICAgIF9tb3VzZURvd25IYW5kbGVyLFxuICAgICAgICAgICAgX21vdXNlT3ZlckhhbmRsZXIsXG4gICAgICAgICAgICBfbW91c2VPdXRIYW5kbGVyLFxuICAgICAgICAgICAgX3RvZ2dsZUV4cGFuZGVkRXZlbnRIYW5kbGVycztcblxuICAgICAgICAvKipcbiAgICAgICAgICogQG5hbWUgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudX5fZ2V0UGx1Z2luXG4gICAgICAgICAqIEBkZXNjIFJldHVybnMgdGhlIHBhcmVudCBhY2Nlc3NpYmxlTWVnYU1lbnUgaW5zdGFuY2UgZm9yIGEgZ2l2ZW4gZWxlbWVudFxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZWxlbWVudFxuICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgKiBAaW5uZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9nZXRQbHVnaW4gPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuICQoZWxlbWVudCkuY2xvc2VzdCgnOmRhdGEocGx1Z2luXycgKyBwbHVnaW5OYW1lICsgJyknKS5kYXRhKFwicGx1Z2luX1wiICsgcGx1Z2luTmFtZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBuYW1lIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnV+X2FkZFVuaXF1ZUlkXG4gICAgICAgICAqIEBkZXNjIEFkZHMgYSB1bmlxdWUgaWQgYW5kIGVsZW1lbnQuXG4gICAgICAgICAqIFRoZSBpZCBzdHJpbmcgc3RhcnRzIHdpdGggdGhlXG4gICAgICAgICAqIHN0cmluZyBkZWZpbmVkIGluIHNldHRpbmdzLnV1aWRQcmVmaXguXG4gICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbGVtZW50XG4gICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAqIEBpbm5lclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2FkZFVuaXF1ZUlkID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gdGhpcy5zZXR0aW5ncztcbiAgICAgICAgICAgIGlmICghZWxlbWVudC5hdHRyKFwiaWRcIikpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJpZFwiLCBzZXR0aW5ncy51dWlkUHJlZml4ICsgXCItXCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIFwiLVwiICsgKCsrdXVpZCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbmFtZSBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51fl90b2dnbGVQYW5lbFxuICAgICAgICAgKiBAZGVzYyBUb2dnbGUgdGhlIGRpc3BsYXkgb2YgbWVnYSBtZW51IHBhbmVscyBpbiByZXNwb25zZSB0byBhbiBldmVudC5cbiAgICAgICAgICogVGhlIG9wdGlvbmFsIGJvb2xlYW4gdmFsdWUgJ2hpZGUnIGZvcmNlcyBhbGwgcGFuZWxzIHRvIGhpZGUuXG4gICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2hpZGVdIEhpZGUgYWxsIG1lZ2EgbWVudSBwYW5lbHMgd2hlbiB0cnVlXG4gICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAqIEBpbm5lclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3RvZ2dsZVBhbmVsID0gZnVuY3Rpb24gKGV2ZW50LCBoaWRlKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJChldmVudC50YXJnZXQpLFxuICAgICAgICAgICAgICAgIHRoYXQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICAgICAgICBtZW51ID0gdGhpcy5tZW51LFxuICAgICAgICAgICAgICAgIHRvcGxpID0gdGFyZ2V0LmNsb3Nlc3QoJy4nICsgc2V0dGluZ3MudG9wTmF2SXRlbUNsYXNzKSxcbiAgICAgICAgICAgICAgICBwYW5lbCA9IHRhcmdldC5oYXNDbGFzcyhzZXR0aW5ncy5wYW5lbENsYXNzKSA/IHRhcmdldCA6IHRhcmdldC5jbG9zZXN0KCcuJyArIHNldHRpbmdzLnBhbmVsQ2xhc3MpLFxuICAgICAgICAgICAgICAgIG5ld2ZvY3VzO1xuXG4gICAgICAgICAgICBfdG9nZ2xlRXhwYW5kZWRFdmVudEhhbmRsZXJzLmNhbGwodGhpcywgdHJ1ZSk7XG5cbiAgICAgICAgICAgIGlmIChoaWRlKSB7XG4gICAgICAgICAgICAgICAgdG9wbGkgPSBtZW51LmZpbmQoJy4nICsgc2V0dGluZ3MudG9wTmF2SXRlbUNsYXNzICsgJyAuJyArIHNldHRpbmdzLm9wZW5DbGFzcyArICc6Zmlyc3QnKS5jbG9zZXN0KCcuJyArIHNldHRpbmdzLnRvcE5hdkl0ZW1DbGFzcyk7XG4gICAgICAgICAgICAgICAgaWYgKCEodG9wbGkuaXMoZXZlbnQucmVsYXRlZFRhcmdldCkgfHwgdG9wbGkuaGFzKGV2ZW50LnJlbGF0ZWRUYXJnZXQpLmxlbmd0aCA+IDApKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgoZXZlbnQudHlwZSA9PT0gJ21vdXNlb3V0JyB8fCBldmVudC50eXBlID09PSAnZm9jdXNvdXQnKSAmJiB0b3BsaS5oYXMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRvcGxpLmZpbmQoJ1thcmlhLWV4cGFuZGVkXScpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsICdmYWxzZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3Moc2V0dGluZ3Mub3BlbkNsYXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcignLicgKyBzZXR0aW5ncy5wYW5lbENsYXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKChldmVudC50eXBlID09PSAna2V5ZG93bicgJiYgZXZlbnQua2V5Q29kZSA9PT0gS2V5Ym9hcmQuRVNDQVBFKSB8fCBldmVudC50eXBlID09PSAnRE9NQXR0ck1vZGlmaWVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3Zm9jdXMgPSB0b3BsaS5maW5kKCc6dGFiYmFibGU6Zmlyc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnUuZmluZCgnW2FyaWEtZXhwYW5kZWRdLicgKyB0aGF0LnNldHRpbmdzLnBhbmVsQ2xhc3MpLm9mZignRE9NQXR0ck1vZGlmaWVkLmFjY2Vzc2libGUtbWVnYW1lbnUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdmb2N1cy5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuanVzdEZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDk5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodG9wbGkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbnUuZmluZCgnW2FyaWEtZXhwYW5kZWQ9dHJ1ZV0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKHNldHRpbmdzLm9wZW5DbGFzcylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoJy4nICsgc2V0dGluZ3MucGFuZWxDbGFzcylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhhdC5mb2N1c1RpbWVvdXRJRCk7XG4gICAgICAgICAgICAgICAgdG9wbGkuc2libGluZ3MoKVxuICAgICAgICAgICAgICAgICAgICAuZmluZCgnW2FyaWEtZXhwYW5kZWRdJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKVxuICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3Moc2V0dGluZ3Mub3BlbkNsYXNzKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKCcuJyArIHNldHRpbmdzLnBhbmVsQ2xhc3MpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgICAgICAgICAgICAgdG9wbGkuZmluZCgnW2FyaWEtZXhwYW5kZWRdJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhzZXR0aW5ncy5vcGVuQ2xhc3MpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoJy4nICsgc2V0dGluZ3MucGFuZWxDbGFzcylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICdtb3VzZW92ZXInICYmIHRhcmdldC5pcygnOnRhYmJhYmxlJykgJiYgdG9wbGkubGVuZ3RoID09PSAxICYmIHBhbmVsLmxlbmd0aCA9PT0gMCAmJiBtZW51Lmhhcyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lmp1c3RGb2N1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX3RvZ2dsZUV4cGFuZGVkRXZlbnRIYW5kbGVycy5jYWxsKHRoYXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbmFtZSBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51fl9jbGlja0hhbmRsZXJcbiAgICAgICAgICogQGRlc2MgSGFuZGxlIGNsaWNrIGV2ZW50IG9uIG1lZ2EgbWVudSBpdGVtXG4gICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IEV2ZW50IG9iamVjdFxuICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgKiBAaW5uZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9jbGlja0hhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLFxuICAgICAgICAgICAgICAgIHRvcGxpID0gdGFyZ2V0LmNsb3Nlc3QoJy4nICsgdGhpcy5zZXR0aW5ncy50b3BOYXZJdGVtQ2xhc3MpLFxuICAgICAgICAgICAgICAgIHBhbmVsID0gdGFyZ2V0LmNsb3Nlc3QoJy4nICsgdGhpcy5zZXR0aW5ncy5wYW5lbENsYXNzKTtcbiAgICAgICAgICAgIGlmICh0b3BsaS5sZW5ndGggPT09IDFcbiAgICAgICAgICAgICAgICAgICAgJiYgcGFuZWwubGVuZ3RoID09PSAwXG4gICAgICAgICAgICAgICAgICAgICYmIHRvcGxpLmZpbmQoJy4nICsgdGhpcy5zZXR0aW5ncy5wYW5lbENsYXNzKS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRhcmdldC5oYXNDbGFzcyh0aGlzLnNldHRpbmdzLm9wZW5DbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIF90b2dnbGVQYW5lbC5jYWxsKHRoaXMsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5qdXN0Rm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmp1c3RGb2N1c2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmp1c3RGb2N1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNUb3VjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwodGhpcywgZXZlbnQsIHRhcmdldC5oYXNDbGFzcyh0aGlzLnNldHRpbmdzLm9wZW5DbGFzcykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbmFtZSBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51fl9jbGlja091dHNpZGVIYW5kbGVyXG4gICAgICAgICAqIEBkZXNjIEhhbmRsZSBjbGljayBldmVudCBvdXRzaWRlIG9mIGEgdGhlIG1lZ2FtZW51XG4gICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IEV2ZW50IG9iamVjdFxuICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgKiBAaW5uZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9jbGlja091dHNpZGVIYW5kbGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoJChldmVudC50YXJnZXQpLmNsb3Nlc3QodGhpcy5tZW51KS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIF90b2dnbGVQYW5lbC5jYWxsKHRoaXMsIGV2ZW50LCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQG5hbWUgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudX5fRE9NQXR0ck1vZGlmaWVkSGFuZGxlclxuICAgICAgICAgKiBAZGVzYyBIYW5kbGUgRE9NQXR0ck1vZGlmaWVkIGV2ZW50IG9uIHBhbmVsIHRvIHJlc3BvbmQgdG8gV2luZG93cyA4IE5hcnJhdG9yIEV4cGFuZENvbGxhcHNlIHBhdHRlcm5cbiAgICAgICAgICogQHBhcmFtIHtldmVudH0gRXZlbnQgb2JqZWN0XG4gICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAqIEBpbm5lclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX0RPTUF0dHJNb2RpZmllZEhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5vcmlnaW5hbEV2ZW50LmF0dHJOYW1lID09PSAnYXJpYS1leHBhbmRlZCdcbiAgICAgICAgICAgICAgICAgICAgJiYgZXZlbnQub3JpZ2luYWxFdmVudC5uZXdWYWx1ZSA9PT0gJ2ZhbHNlJ1xuICAgICAgICAgICAgICAgICAgICAmJiAkKGV2ZW50LnRhcmdldCkuaGFzQ2xhc3ModGhpcy5zZXR0aW5ncy5vcGVuQ2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBfdG9nZ2xlUGFuZWwuY2FsbCh0aGlzLCBldmVudCwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBuYW1lIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnV+X2ZvY3VzSW5IYW5kbGVyXG4gICAgICAgICAqIEBkZXNjIEhhbmRsZSBmb2N1c2luIGV2ZW50IG9uIG1lZ2EgbWVudSBpdGVtLlxuICAgICAgICAgKiBAcGFyYW0ge2V2ZW50fSBFdmVudCBvYmplY3RcbiAgICAgICAgICogQG1lbWJlcm9mIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICogQGlubmVyXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfZm9jdXNJbkhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmZvY3VzVGltZW91dElEKTtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCksXG4gICAgICAgICAgICAgICAgcGFuZWwgPSB0YXJnZXQuY2xvc2VzdCgnLicgKyB0aGlzLnNldHRpbmdzLnBhbmVsQ2xhc3MpO1xuICAgICAgICAgICAgdGFyZ2V0XG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKHRoaXMuc2V0dGluZ3MuZm9jdXNDbGFzcylcbiAgICAgICAgICAgICAgICAub24oJ2NsaWNrLmFjY2Vzc2libGUtbWVnYW1lbnUnLCAkLnByb3h5KF9jbGlja0hhbmRsZXIsIHRoaXMpKTtcbiAgICAgICAgICAgIHRoaXMuanVzdEZvY3VzZWQgPSAhdGhpcy5tb3VzZUZvY3VzZWQ7XG4gICAgICAgICAgICB0aGlzLm1vdXNlRm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMucGFuZWxzLm5vdChwYW5lbCkuZmlsdGVyKCcuJyArIHRoaXMuc2V0dGluZ3Mub3BlbkNsYXNzKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBfdG9nZ2xlUGFuZWwuY2FsbCh0aGlzLCBldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBuYW1lIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnV+X2ZvY3VzT3V0SGFuZGxlclxuICAgICAgICAgKiBAZGVzYyBIYW5kbGUgZm9jdXNvdXQgZXZlbnQgb24gbWVnYSBtZW51IGl0ZW0uXG4gICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IEV2ZW50IG9iamVjdFxuICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgKiBAaW5uZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9mb2N1c091dEhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuanVzdEZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCksXG4gICAgICAgICAgICAgICAgdG9wbGkgPSB0YXJnZXQuY2xvc2VzdCgnLicgKyB0aGlzLnNldHRpbmdzLnRvcE5hdkl0ZW1DbGFzcyksXG4gICAgICAgICAgICAgICAga2VlcE9wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgIHRhcmdldFxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyh0aGlzLnNldHRpbmdzLmZvY3VzQ2xhc3MpXG4gICAgICAgICAgICAgICAgLm9mZignY2xpY2suYWNjZXNzaWJsZS1tZWdhbWVudScpO1xuXG4gICAgICAgICAgICBpZiAod2luZG93LmN2b3gpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBDaHJvbWVWb3ggaXMgcnVubmluZy4uLlxuICAgICAgICAgICAgICAgIHRoYXQuZm9jdXNUaW1lb3V0SUQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmN2b3guQXBpLmdldEN1cnJlbnROb2RlKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9wbGkuaGFzKG5vZGUpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCB0aGUgY3VycmVudCBub2RlIGJlaW5nIHZvaWNlZCBpcyBpblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBtZWdhIG1lbnUsIGNsZWFyVGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzbyB0aGUgcGFuZWwgc3RheXMgb3Blbi5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhhdC5mb2N1c1RpbWVvdXRJRCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZm9jdXNUaW1lb3V0SUQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uIChzY29wZSwgZXZlbnQsIGhpZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwoc2NvcGUsIGV2ZW50LCBoaWRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAyNzUsIHRoYXQsIGV2ZW50LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgMjUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGF0LmZvY3VzVGltZW91dElEID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90b2dnbGVQYW5lbC5jYWxsKHRoYXQsIGV2ZW50LCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbmFtZSBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51fl9rZXlEb3duSGFuZGxlclxuICAgICAgICAgKiBAZGVzYyBIYW5kbGUga2V5ZG93biBldmVudCBvbiBtZWdhIG1lbnUuXG4gICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IEV2ZW50IG9iamVjdFxuICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgKiBAaW5uZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9rZXlEb3duSGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSAodGhpcy5jb25zdHJ1Y3RvciA9PT0gQWNjZXNzaWJsZU1lZ2FNZW51KSA/IHRoaXMgOiBfZ2V0UGx1Z2luKHRoaXMpLCAvLyBkZXRlcm1pbmUgdGhlIEFjY2Vzc2libGVNZWdhTWVudSBwbHVnaW4gaW5zdGFuY2VcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHRoYXQuc2V0dGluZ3MsXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gJCgkKHRoaXMpLmlzKCcuJyArIHNldHRpbmdzLmhvdmVyQ2xhc3MgKyAnOnRhYmJhYmxlJykgPyB0aGlzIDogZXZlbnQudGFyZ2V0KSwgLy8gaWYgdGhlIGVsZW1lbnQgaXMgaG92ZXJlZCB0aGUgdGFyZ2V0IGlzIHRoaXMsIG90aGVyd2lzZSwgaXRzIHRoZSBmb2N1c2VkIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBtZW51ID0gdGhhdC5tZW51LFxuICAgICAgICAgICAgICAgIHRvcG5hdml0ZW1zID0gdGhhdC50b3BuYXZpdGVtcyxcbiAgICAgICAgICAgICAgICB0b3BsaSA9IHRhcmdldC5jbG9zZXN0KCcuJyArIHNldHRpbmdzLnRvcE5hdkl0ZW1DbGFzcyksXG4gICAgICAgICAgICAgICAgdGFiYmFibGVzID0gbWVudS5maW5kKCc6dGFiYmFibGUnKSxcbiAgICAgICAgICAgICAgICBwYW5lbCA9IHRhcmdldC5oYXNDbGFzcyhzZXR0aW5ncy5wYW5lbENsYXNzKSA/IHRhcmdldCA6IHRhcmdldC5jbG9zZXN0KCcuJyArIHNldHRpbmdzLnBhbmVsQ2xhc3MpLFxuICAgICAgICAgICAgICAgIHBhbmVsR3JvdXBzID0gcGFuZWwuZmluZCgnLicgKyBzZXR0aW5ncy5wYW5lbEdyb3VwQ2xhc3MpLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRQYW5lbEdyb3VwID0gdGFyZ2V0LmNsb3Nlc3QoJy4nICsgc2V0dGluZ3MucGFuZWxHcm91cENsYXNzKSxcbiAgICAgICAgICAgICAgICBuZXh0LFxuICAgICAgICAgICAgICAgIGtleWNvZGUgPSBldmVudC5rZXlDb2RlIHx8IGV2ZW50LndoaWNoLFxuICAgICAgICAgICAgICAgIHN0YXJ0LFxuICAgICAgICAgICAgICAgIGksXG4gICAgICAgICAgICAgICAgbyxcbiAgICAgICAgICAgICAgICBsYWJlbCxcbiAgICAgICAgICAgICAgICBmb3VuZCA9IGZhbHNlLFxuICAgICAgICAgICAgICAgIG5ld1N0cmluZyA9IEtleWJvYXJkLmtleU1hcFtldmVudC5rZXlDb2RlXSB8fCAnJyxcbiAgICAgICAgICAgICAgICByZWdleCxcbiAgICAgICAgICAgICAgICBpc1RvcE5hdkl0ZW0gPSAodG9wbGkubGVuZ3RoID09PSAxICYmIHBhbmVsLmxlbmd0aCA9PT0gMCk7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuaXMoXCJpbnB1dDpmb2N1cywgc2VsZWN0OmZvY3VzLCB0ZXh0YXJlYTpmb2N1cywgYnV0dG9uOmZvY3VzXCIpKSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlIGV2ZW50IHRhcmdldCBpcyBhIGZvcm0gZWxlbWVudCB3ZSBzaG91bGQgaGFuZGxlIGtleWRvd24gbm9ybWFsbHlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuaXMoJy4nICsgc2V0dGluZ3MuaG92ZXJDbGFzcyArICc6dGFiYmFibGUnKSkge1xuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5vZmYoJ2tleWRvd24uYWNjZXNzaWJsZS1tZWdhbWVudScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzd2l0Y2ggKGtleWNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgS2V5Ym9hcmQuRVNDQVBFOlxuICAgICAgICAgICAgICAgIF90b2dnbGVQYW5lbC5jYWxsKHRoYXQsIGV2ZW50LCB0cnVlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS2V5Ym9hcmQuRE9XTjpcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGlmIChpc1RvcE5hdkl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgX3RvZ2dsZVBhbmVsLmNhbGwodGhhdCwgZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9ICh0b3BsaS5maW5kKCcuJyArIHNldHRpbmdzLnBhbmVsQ2xhc3MgKyAnIDp0YWJiYWJsZTpmaXJzdCcpLmZvY3VzKCkubGVuZ3RoID09PSAxKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9ICh0YWJiYWJsZXMuZmlsdGVyKCc6Z3QoJyArIHRhYmJhYmxlcy5pbmRleCh0YXJnZXQpICsgJyk6Zmlyc3QnKS5mb2N1cygpLmxlbmd0aCA9PT0gMSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCFmb3VuZCAmJiB3aW5kb3cub3BlcmEgJiYgb3BlcmEudG9TdHJpbmcoKSA9PT0gXCJbb2JqZWN0IE9wZXJhXVwiICYmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmJhYmxlcyA9ICQoJzp0YWJiYWJsZScpO1xuICAgICAgICAgICAgICAgICAgICBpID0gdGFiYmFibGVzLmluZGV4KHRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKCQoJzp0YWJiYWJsZTpndCgnICsgJCgnOnRhYmJhYmxlJykuaW5kZXgodGFyZ2V0KSArICcpOmZpcnN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS2V5Ym9hcmQuVVA6XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNUb3BOYXZJdGVtICYmIHRhcmdldC5oYXNDbGFzcyhzZXR0aW5ncy5vcGVuQ2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIF90b2dnbGVQYW5lbC5jYWxsKHRoYXQsIGV2ZW50LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgbmV4dCA9IHRvcG5hdml0ZW1zLmZpbHRlcignOmx0KCcgKyB0b3BuYXZpdGVtcy5pbmRleCh0b3BsaSkgKyAnKTpsYXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXh0LmNoaWxkcmVuKCcuJyArIHNldHRpbmdzLnBhbmVsQ2xhc3MpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSAobmV4dC5jaGlsZHJlbigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKHNldHRpbmdzLm9wZW5DbGFzcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKCcuJyArIHNldHRpbmdzLnBhbmVsQ2xhc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgnOnRhYmJhYmxlOmxhc3QnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5mb2N1cygpID09PSAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzVG9wTmF2SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9ICh0YWJiYWJsZXMuZmlsdGVyKCc6bHQoJyArIHRhYmJhYmxlcy5pbmRleCh0YXJnZXQpICsgJyk6bGFzdCcpLmZvY3VzKCkubGVuZ3RoID09PSAxKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kICYmIHdpbmRvdy5vcGVyYSAmJiBvcGVyYS50b1N0cmluZygpID09PSBcIltvYmplY3QgT3BlcmFdXCIgJiYgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFiYmFibGVzID0gJCgnOnRhYmJhYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgIGkgPSB0YWJiYWJsZXMuaW5kZXgodGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSAoJCgnOnRhYmJhYmxlOmx0KCcgKyAkKCc6dGFiYmFibGUnKS5pbmRleCh0YXJnZXQpICsgJyk6Zmlyc3QnKS5mb2N1cygpLmxlbmd0aCA9PT0gMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlib2FyZC5SSUdIVDpcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGlmIChpc1RvcE5hdkl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSAodG9wbmF2aXRlbXMuZmlsdGVyKCc6Z3QoJyArIHRvcG5hdml0ZW1zLmluZGV4KHRvcGxpKSArICcpOmZpcnN0JykuZmluZCgnOnRhYmJhYmxlOmZpcnN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYW5lbEdyb3Vwcy5sZW5ndGggJiYgY3VycmVudFBhbmVsR3JvdXAubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgY3VycmVudCBwYW5lbCBjb250YWlucyBwYW5lbCBncm91cHMsIGFuZCB3ZSBhcmUgYWJsZSB0byBmb2N1cyB0aGUgZmlyc3QgdGFiYmFibGUgZWxlbWVudCBvZiB0aGUgbmV4dCBwYW5lbCBncm91cFxuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSAocGFuZWxHcm91cHMuZmlsdGVyKCc6Z3QoJyArIHBhbmVsR3JvdXBzLmluZGV4KGN1cnJlbnRQYW5lbEdyb3VwKSArICcpOmZpcnN0JykuZmluZCgnOnRhYmJhYmxlOmZpcnN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSAodG9wbGkuZmluZCgnOnRhYmJhYmxlOmZpcnN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlib2FyZC5MRUZUOlxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgaWYgKGlzVG9wTmF2SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9ICh0b3BuYXZpdGVtcy5maWx0ZXIoJzpsdCgnICsgdG9wbmF2aXRlbXMuaW5kZXgodG9wbGkpICsgJyk6bGFzdCcpLmZpbmQoJzp0YWJiYWJsZTpmaXJzdCcpLmZvY3VzKCkubGVuZ3RoID09PSAxKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFuZWxHcm91cHMubGVuZ3RoICYmIGN1cnJlbnRQYW5lbEdyb3VwLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGN1cnJlbnQgcGFuZWwgY29udGFpbnMgcGFuZWwgZ3JvdXBzLCBhbmQgd2UgYXJlIGFibGUgdG8gZm9jdXMgdGhlIGZpcnN0IHRhYmJhYmxlIGVsZW1lbnQgb2YgdGhlIHByZXZpb3VzIHBhbmVsIGdyb3VwXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IChwYW5lbEdyb3Vwcy5maWx0ZXIoJzpsdCgnICsgcGFuZWxHcm91cHMuaW5kZXgoY3VycmVudFBhbmVsR3JvdXApICsgJyk6bGFzdCcpLmZpbmQoJzp0YWJiYWJsZTpmaXJzdCcpLmZvY3VzKCkubGVuZ3RoID09PSAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICghZm91bmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKHRvcGxpLmZpbmQoJzp0YWJiYWJsZTpmaXJzdCcpLmZvY3VzKCkubGVuZ3RoID09PSAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS2V5Ym9hcmQuVEFCOlxuICAgICAgICAgICAgICAgIGkgPSB0YWJiYWJsZXMuaW5kZXgodGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkgJiYgaXNUb3BOYXZJdGVtICYmIHRhcmdldC5oYXNDbGFzcyhzZXR0aW5ncy5vcGVuQ2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIF90b2dnbGVQYW5lbC5jYWxsKHRoYXQsIGV2ZW50LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgbmV4dCA9IHRvcG5hdml0ZW1zLmZpbHRlcignOmx0KCcgKyB0b3BuYXZpdGVtcy5pbmRleCh0b3BsaSkgKyAnKTpsYXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXh0LmNoaWxkcmVuKCcuJyArIHNldHRpbmdzLnBhbmVsQ2xhc3MpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBuZXh0LmNoaWxkcmVuKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsICd0cnVlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moc2V0dGluZ3Mub3BlbkNsYXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoJy4nICsgc2V0dGluZ3MucGFuZWxDbGFzcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCc6dGFiYmFibGU6bGFzdCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnNoaWZ0S2V5ICYmIGkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKHRhYmJhYmxlcy5maWx0ZXIoJzpsdCgnICsgaSArICcpOmxhc3QnKS5mb2N1cygpLmxlbmd0aCA9PT0gMSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghZXZlbnQuc2hpZnRLZXkgJiYgaSA8IHRhYmJhYmxlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKHRhYmJhYmxlcy5maWx0ZXIoJzpndCgnICsgaSArICcpOmZpcnN0JykuZm9jdXMoKS5sZW5ndGggPT09IDEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAod2luZG93Lm9wZXJhICYmIG9wZXJhLnRvU3RyaW5nKCkgPT09IFwiW29iamVjdCBPcGVyYV1cIikge1xuICAgICAgICAgICAgICAgICAgICB0YWJiYWJsZXMgPSAkKCc6dGFiYmFibGUnKTtcbiAgICAgICAgICAgICAgICAgICAgaSA9IHRhYmJhYmxlcy5pbmRleCh0YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gKCQoJzp0YWJiYWJsZTpsdCgnICsgJCgnOnRhYmJhYmxlJykuaW5kZXgodGFyZ2V0KSArICcpOmxhc3QnKS5mb2N1cygpLmxlbmd0aCA9PT0gMSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9ICgkKCc6dGFiYmFibGU6Z3QoJyArICQoJzp0YWJiYWJsZScpLmluZGV4KHRhcmdldCkgKyAnKTpmaXJzdCcpLmZvY3VzKCkubGVuZ3RoID09PSAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChmb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS2V5Ym9hcmQuU1BBQ0U6XG4gICAgICAgICAgICAgICAgaWYgKGlzVG9wTmF2SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBfY2xpY2tIYW5kbGVyLmNhbGwodGhhdCwgZXZlbnQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS2V5Ym9hcmQuRU5URVI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIC8vIGFscGhhbnVtZXJpYyBmaWx0ZXJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5rZXlkb3duVGltZW91dElEKTtcblxuICAgICAgICAgICAgICAgIGtleWRvd25TZWFyY2hTdHJpbmcgKz0gbmV3U3RyaW5nICE9PSBrZXlkb3duU2VhcmNoU3RyaW5nID8gbmV3U3RyaW5nIDogJyc7XG5cbiAgICAgICAgICAgICAgICBpZiAoa2V5ZG93blNlYXJjaFN0cmluZy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMua2V5ZG93blRpbWVvdXRJRCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBrZXlkb3duU2VhcmNoU3RyaW5nID0gJyc7XG4gICAgICAgICAgICAgICAgfSwga2V5ZG93blRpbWVvdXREdXJhdGlvbik7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNUb3BOYXZJdGVtICYmICF0YXJnZXQuaGFzQ2xhc3Moc2V0dGluZ3Mub3BlbkNsYXNzKSkge1xuICAgICAgICAgICAgICAgICAgICB0YWJiYWJsZXMgPSB0YWJiYWJsZXMuZmlsdGVyKCc6bm90KC4nICsgc2V0dGluZ3MucGFuZWxDbGFzcyArICcgOnRhYmJhYmxlKScpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmJhYmxlcyA9IHRvcGxpLmZpbmQoJzp0YWJiYWJsZScpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgICAgICB0YWJiYWJsZXMgPSAkKHRhYmJhYmxlcy5nZXQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJldmVyc2UoKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRhYmJhYmxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBvID0gdGFiYmFibGVzLmVxKGkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoby5pcyh0YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IChrZXlkb3duU2VhcmNoU3RyaW5nLmxlbmd0aCA9PT0gMSkgPyBpICsgMSA6IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBrZXlkb3duU2VhcmNoU3RyaW5nLnJlcGxhY2UoL1tcXC1cXFtcXF17fSgpKis/LixcXFxcXFxeJHwjXFxzXS9nLCAnXFxcXCQmJyksICdpJyk7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IHRhYmJhYmxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBvID0gdGFiYmFibGVzLmVxKGkpO1xuICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICQudHJpbShvLnRleHQoKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWdleC50ZXN0KGxhYmVsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgby5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc3RhcnQ7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbyA9IHRhYmJhYmxlcy5lcShpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gJC50cmltKG8udGV4dCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWdleC50ZXN0KGxhYmVsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoYXQuanVzdEZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQG5hbWUgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudX5fbW91c2VEb3duSGFuZGxlclxuICAgICAgICAgKiBAZGVzYyBIYW5kbGUgbW91c2Vkb3duIGV2ZW50IG9uIG1lZ2EgbWVudS5cbiAgICAgICAgICogQHBhcmFtIHtldmVudH0gRXZlbnQgb2JqZWN0XG4gICAgICAgICAqIEBtZW1iZXJvZiBhY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICogQGlubmVyXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfbW91c2VEb3duSGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5pcyh0aGlzLnNldHRpbmdzLnBhbmVsQ2xhc3MpIHx8ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFwiOmZvY3VzYWJsZVwiKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vdXNlRm9jdXNlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm1vdXNlVGltZW91dElEID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZm9jdXNUaW1lb3V0SUQpO1xuICAgICAgICAgICAgfSwgMSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBuYW1lIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnV+X21vdXNlT3ZlckhhbmRsZXJcbiAgICAgICAgICogQGRlc2MgSGFuZGxlIG1vdXNlb3ZlciBldmVudCBvbiBtZWdhIG1lbnUuXG4gICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IEV2ZW50IG9iamVjdFxuICAgICAgICAgKiBAbWVtYmVyb2YgalF1ZXJ5LmZuLmFjY2Vzc2libGVNZWdhTWVudVxuICAgICAgICAgKiBAaW5uZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9tb3VzZU92ZXJIYW5kbGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5tb3VzZVRpbWVvdXRJRCk7XG4gICAgICAgICAgICAkKGV2ZW50LnRhcmdldClcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3ModGhpcy5zZXR0aW5ncy5ob3ZlckNsYXNzKTtcbiAgICAgICAgICAgIF90b2dnbGVQYW5lbC5jYWxsKHRoaXMsIGV2ZW50KTtcbiAgICAgICAgICAgIGlmICgkKGV2ZW50LnRhcmdldCkuaXMoJzp0YWJiYWJsZScpKSB7XG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLm9uKCdrZXlkb3duLmFjY2Vzc2libGUtbWVnYW1lbnUnLCAkLnByb3h5KF9rZXlEb3duSGFuZGxlciwgZXZlbnQudGFyZ2V0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBuYW1lIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnV+X21vdXNlT3V0SGFuZGxlclxuICAgICAgICAgKiBAZGVzYyBIYW5kbGUgbW91c2VvdXQgZXZlbnQgb24gbWVnYSBtZW51LlxuICAgICAgICAgKiBAcGFyYW0ge2V2ZW50fSBFdmVudCBvYmplY3RcbiAgICAgICAgICogQG1lbWJlcm9mIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICogQGlubmVyXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfbW91c2VPdXRIYW5kbGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICAkKGV2ZW50LnRhcmdldClcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3ModGhhdC5zZXR0aW5ncy5ob3ZlckNsYXNzKTtcblxuICAgICAgICAgICAgdGhhdC5tb3VzZVRpbWVvdXRJRCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90b2dnbGVQYW5lbC5jYWxsKHRoYXQsIGV2ZW50LCB0cnVlKTtcbiAgICAgICAgICAgIH0sIDI1MCk7XG4gICAgICAgICAgICBpZiAoJChldmVudC50YXJnZXQpLmlzKCc6dGFiYmFibGUnKSkge1xuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5vZmYoJ2tleWRvd24uYWNjZXNzaWJsZS1tZWdhbWVudScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIF90b2dnbGVFeHBhbmRlZEV2ZW50SGFuZGxlcnMgPSBmdW5jdGlvbiAoaGlkZSkge1xuICAgICAgICAgICAgdmFyIG1lbnUgPSB0aGlzLm1lbnU7XG4gICAgICAgICAgICBpZiAoaGlkZSkge1xuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5vZmYoJ21vdXNldXAub3V0c2lkZS1hY2Nlc3NpYmxlLW1lZ2FtZW51LCB0b3VjaGVuZC5vdXRzaWRlLWFjY2Vzc2libGUtbWVnYW1lbnUsIG1zcG9pbnRlcnVwLm91dHNpZGUtYWNjZXNzaWJsZS1tZWdhbWVudSwgIHBvaW50ZXJ1cC5vdXRzaWRlLWFjY2Vzc2libGUtbWVnYW1lbnUnKTtcblxuICAgICAgICAgICAgICAgIG1lbnUuZmluZCgnW2FyaWEtZXhwYW5kZWRdLicgKyB0aGlzLnNldHRpbmdzLnBhbmVsQ2xhc3MpLm9mZignRE9NQXR0ck1vZGlmaWVkLmFjY2Vzc2libGUtbWVnYW1lbnUnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLm9uKCdtb3VzZXVwLm91dHNpZGUtYWNjZXNzaWJsZS1tZWdhbWVudSwgdG91Y2hlbmQub3V0c2lkZS1hY2Nlc3NpYmxlLW1lZ2FtZW51LCBtc3BvaW50ZXJ1cC5vdXRzaWRlLWFjY2Vzc2libGUtbWVnYW1lbnUsICBwb2ludGVydXAub3V0c2lkZS1hY2Nlc3NpYmxlLW1lZ2FtZW51JywgJC5wcm94eShfY2xpY2tPdXRzaWRlSGFuZGxlciwgdGhpcykpO1xuXG4gICAgICAgICAgICAgICAgLyogTmFycmF0b3IgaW4gV2luZG93cyA4IGF1dG9tYXRpY2FsbHkgdG9nZ2xlcyB0aGUgYXJpYS1leHBhbmRlZCBwcm9wZXJ0eSBvbiBkb3VibGUgdGFwIG9yIGNsaWNrLlxuICAgICAgICAgICAgICAgICAgIFRvIHJlc3BvbmQgdG8gdGhlIGNoYW5nZSB0byBjb2xsYXBzZSB0aGUgcGFuZWwsIHdlIG11c3QgYWRkIGEgbGlzdGVuZXIgZm9yIGEgRE9NQXR0ck1vZGlmaWVkIGV2ZW50LiAqL1xuICAgICAgICAgICAgICAgIG1lbnUuZmluZCgnW2FyaWEtZXhwYW5kZWQ9dHJ1ZV0uJyArIHRoaXMuc2V0dGluZ3MucGFuZWxDbGFzcykub24oJ0RPTUF0dHJNb2RpZmllZC5hY2Nlc3NpYmxlLW1lZ2FtZW51JywgJC5wcm94eShfRE9NQXR0ck1vZGlmaWVkSGFuZGxlciwgdGhpcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qIHB1YmxpYyBhdHRyaWJ1dGVzIGFuZCBtZXRob2RzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBBY2Nlc3NpYmxlTWVnYU1lbnUsXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQGxlbmRzIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICAgICAqIEBkZXNjIEluaXRpYWxpemVzIGFuIGluc3RhbmNlIG9mIHRoZSBhY2Nlc3NpYmxlTWVnYU1lbnUgcGx1Z2luc1xuICAgICAgICAgICAgICogQG1lbWJlcm9mIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICAgICAgICAgICAgbmF2ID0gJCh0aGlzLmVsZW1lbnQpLFxuICAgICAgICAgICAgICAgICAgICBtZW51ID0gbmF2LmNoaWxkcmVuKCkuZmlyc3QoKSxcbiAgICAgICAgICAgICAgICAgICAgdG9wbmF2aXRlbXMgPSBtZW51LmNoaWxkcmVuKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydChzZXR0aW5ncywgbmF2LCBtZW51LCB0b3BuYXZpdGVtcyk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzdGFydDogZnVuY3Rpb24oc2V0dGluZ3MsIG5hdiwgbWVudSwgdG9wbmF2aXRlbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgICAgICAgICAgIHRoaXMubWVudSA9IG1lbnU7XG4gICAgICAgICAgICAgICAgdGhpcy50b3BuYXZpdGVtcyA9IHRvcG5hdml0ZW1zO1xuXG4gICAgICAgICAgICAgICAgbmF2LmF0dHIoXCJyb2xlXCIsIFwibmF2aWdhdGlvblwiKTtcbiAgICAgICAgICAgICAgICBtZW51LmFkZENsYXNzKHNldHRpbmdzLm1lbnVDbGFzcyk7XG4gICAgICAgICAgICAgICAgdG9wbmF2aXRlbXMuZWFjaChmdW5jdGlvbiAoaSwgdG9wbmF2aXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG9wbmF2aXRlbWxpbmssIHRvcG5hdml0ZW1wYW5lbDtcbiAgICAgICAgICAgICAgICAgICAgdG9wbmF2aXRlbSA9ICQodG9wbmF2aXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIHRvcG5hdml0ZW0uYWRkQ2xhc3Moc2V0dGluZ3MudG9wTmF2SXRlbUNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgdG9wbmF2aXRlbWxpbmsgPSB0b3BuYXZpdGVtLmZpbmQoXCI6dGFiYmFibGU6Zmlyc3RcIik7XG4gICAgICAgICAgICAgICAgICAgIHRvcG5hdml0ZW1wYW5lbCA9IHRvcG5hdml0ZW0uY2hpbGRyZW4oXCI6bm90KDp0YWJiYWJsZSk6bGFzdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgX2FkZFVuaXF1ZUlkLmNhbGwodGhhdCwgdG9wbmF2aXRlbWxpbmspO1xuICAgICAgICAgICAgICAgICAgICBpZiAodG9wbmF2aXRlbXBhbmVsLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2FkZFVuaXF1ZUlkLmNhbGwodGhhdCwgdG9wbmF2aXRlbXBhbmVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG5hdml0ZW1saW5rLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXJpYS1oYXNwb3B1cFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXJpYS1jb250cm9sc1wiOiB0b3BuYXZpdGVtcGFuZWwuYXR0cihcImlkXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXJpYS1leHBhbmRlZFwiOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG5hdml0ZW1wYW5lbC5hdHRyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJvbGVcIjogXCJncm91cFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXJpYS1leHBhbmRlZFwiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFyaWEtaGlkZGVuXCI6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKHNldHRpbmdzLnBhbmVsQ2xhc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm5vdChcIlthcmlhLWxhYmVsbGVkYnldXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJhcmlhLWxhYmVsbGVkYnlcIiwgdG9wbmF2aXRlbWxpbmsuYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5wYW5lbHMgPSBtZW51LmZpbmQoXCIuXCIgKyBzZXR0aW5ncy5wYW5lbENsYXNzKTtcblxuICAgICAgICAgICAgICAgIG1lbnUub24oXCJmb2N1c2luLmFjY2Vzc2libGUtbWVnYW1lbnVcIiwgXCI6Zm9jdXNhYmxlLCAuXCIgKyBzZXR0aW5ncy5wYW5lbENsYXNzLCAkLnByb3h5KF9mb2N1c0luSGFuZGxlciwgdGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcImZvY3Vzb3V0LmFjY2Vzc2libGUtbWVnYW1lbnVcIiwgXCI6Zm9jdXNhYmxlLCAuXCIgKyBzZXR0aW5ncy5wYW5lbENsYXNzLCAkLnByb3h5KF9mb2N1c091dEhhbmRsZXIsIHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAub24oXCJrZXlkb3duLmFjY2Vzc2libGUtbWVnYW1lbnVcIiwgJC5wcm94eShfa2V5RG93bkhhbmRsZXIsIHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAub24oXCJtb3VzZW92ZXIuYWNjZXNzaWJsZS1tZWdhbWVudVwiLCAkLnByb3h5KF9tb3VzZU92ZXJIYW5kbGVyLCB0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwibW91c2VvdXQuYWNjZXNzaWJsZS1tZWdhbWVudVwiLCAkLnByb3h5KF9tb3VzZU91dEhhbmRsZXIsIHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAub24oXCJtb3VzZWRvd24uYWNjZXNzaWJsZS1tZWdhbWVudVwiLCAkLnByb3h5KF9tb3VzZURvd25IYW5kbGVyLCB0aGlzKSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNUb3VjaCkge1xuICAgICAgICAgICAgICAgICAgICBtZW51Lm9uKFwidG91Y2hzdGFydC5hY2Nlc3NpYmxlLW1lZ2FtZW51XCIsICAkLnByb3h5KF9jbGlja0hhbmRsZXIsIHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBtZW51LmZpbmQoXCJoclwiKS5hdHRyKFwicm9sZVwiLCBcInNlcGFyYXRvclwiKTtcblxuICAgICAgICAgICAgICAgIGlmICgkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLmNsb3Nlc3QobWVudSkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLnRyaWdnZXIoXCJmb2N1c2luLmFjY2Vzc2libGUtbWVnYW1lbnVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAZGVzYyBHZXQgZGVmYXVsdCB2YWx1ZXNcbiAgICAgICAgICAgICAqIEBleGFtcGxlICQoc2VsZWN0b3IpLmFjY2Vzc2libGVNZWdhTWVudShcImdldERlZmF1bHRzXCIpO1xuICAgICAgICAgICAgICogQHJldHVybiB7b2JqZWN0fVxuICAgICAgICAgICAgICogQG1lbWJlcm9mIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBnZXREZWZhdWx0czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0cztcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQGRlc2MgR2V0IGFueSBvcHRpb24gc2V0IHRvIHBsdWdpbiB1c2luZyBpdHMgbmFtZSAoYXMgc3RyaW5nKVxuICAgICAgICAgICAgICogQGV4YW1wbGUgJChzZWxlY3RvcikuYWNjZXNzaWJsZU1lZ2FNZW51KFwiZ2V0T3B0aW9uXCIsIHNvbWVfb3B0aW9uKTtcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRcbiAgICAgICAgICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZ2V0T3B0aW9uOiBmdW5jdGlvbiAob3B0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3Nbb3B0XTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQGRlc2MgR2V0IGFsbCBvcHRpb25zXG4gICAgICAgICAgICAgKiBAZXhhbXBsZSAkKHNlbGVjdG9yKS5hY2Nlc3NpYmxlTWVnYU1lbnUoXCJnZXRBbGxPcHRpb25zXCIpO1xuICAgICAgICAgICAgICogQHJldHVybiB7b2JqZWN0fVxuICAgICAgICAgICAgICogQG1lbWJlcm9mIGpRdWVyeS5mbi5hY2Nlc3NpYmxlTWVnYU1lbnVcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBnZXRBbGxPcHRpb25zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3M7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBkZXNjIFNldCBvcHRpb25cbiAgICAgICAgICAgICAqIEBleGFtcGxlICQoc2VsZWN0b3IpLmFjY2Vzc2libGVNZWdhTWVudShcInNldE9wdGlvblwiLCBcIm9wdGlvbl9uYW1lXCIsICBcIm9wdGlvbl92YWx1ZVwiLCAgcmVpbml0aWFsaXplKTtcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvcHQgLSBPcHRpb24gbmFtZVxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHZhbCAtIE9wdGlvbiB2YWx1ZVxuICAgICAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBbcmVpbml0aWFsaXplXSAtIGJvb2xlYW4gdG8gcmUtaW5pdGlhbGl6ZSB0aGUgbWVudS5cbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiBqUXVlcnkuZm4uYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgc2V0T3B0aW9uOiBmdW5jdGlvbiAob3B0LCB2YWx1ZSwgcmVpbml0aWFsaXplKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5nc1tvcHRdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKHJlaW5pdGlhbGl6ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSgpKTtcblxuICAgIC8qIGxpZ2h0d2VpZ2h0IHBsdWdpbiB3cmFwcGVyIGFyb3VuZCB0aGUgY29uc3RydWN0b3IsXG4gICAgICAgdG8gcHJldmVudCBhZ2FpbnN0IG11bHRpcGxlIGluc3RhbnRpYXRpb25zICovXG5cbiAgICAvKipcbiAgICAgKiBAY2xhc3MgYWNjZXNzaWJsZU1lZ2FNZW51XG4gICAgICogQG1lbWJlck9mIGpRdWVyeS5mblxuICAgICAqIEBjbGFzc2Rlc2MgSW1wbGVtZW50cyBhbiBhY2Nlc3NpYmxlIG1lZ2EgbWVudSBhcyBhIGpRdWVyeSBwbHVnaW4uXG4gICAgICogPHA+VGhlIG1lZ2EtbWVudSBJdCBpcyBtb2RlbGVkIGFmdGVyIHRoZSBtZWdhIG1lbnUgb24ge0BsaW5rIGh0dHA6Ly9hZG9iZS5jb218YWRvYmUuY29tfSBidXQgaGFzIGJlZW4gc2ltcGxpZmllZCBmb3IgdXNlIGJ5IG90aGVycy4gQSBicmllZiBkZXNjcmlwdGlvbiBvZiB0aGUgaW50ZXJhY3Rpb24gZGVzaWduIGNob2ljZXMgY2FuIGJlIGZvdW5kIGluIGEgYmxvZyBwb3N0IGF0IHtAbGluayBodHRwOi8vYmxvZ3MuYWRvYmUuY29tL2FjY2Vzc2liaWxpdHkvMjAxMy8wNS9hZG9iZS1jb20uaHRtbHxNZWdhIG1lbnUgYWNjZXNzaWJpbGl0eSBvbiBhZG9iZS5jb219LjwvcD5cbiAgICAgKiA8aDM+S2V5Ym9hcmQgQWNjZXNzaWJpbGl0eTwvaDM+XG4gICAgICogPHA+VGhlIGFjY2Vzc2libGUgbWVnYSBtZW51IHN1cHBvcnRzIGtleWJvYXJkIGludGVyYWN0aW9uIG1vZGVsZWQgYWZ0ZXIgdGhlIGJlaGF2aW9yIGRlc2NyaWJlZCBpbiB0aGUge0BsaW5rIGh0dHA6Ly93d3cudzMub3JnL1RSL3dhaS1hcmlhLXByYWN0aWNlcy8jbWVudXxXQUktQVJJQSBNZW51IG9yIE1lbnUgYmFyICh3aWRnZXQpIGRlc2lnbiBwYXR0ZXJufSwgaG93ZXZlciB3ZSBhbHNvIHRyeSB0byByZXNwZWN0IHVzZXJzJyBnZW5lcmFsIGV4cGVjdGF0aW9ucyBmb3IgdGhlIGJlaGF2aW9yIG9mIGxpbmtzIGluIGEgZ2xvYmFsIG5hdmlnYXRpb24uIFRvIHRoaXMgZW5kLCB0aGUgYWNjZXNzaWJsZSBtZWdhIG1lbnUgaW1wbGVtZW50YXRpb24gcGVybWl0cyB0YWIgZm9jdXMgb24gZWFjaCBvZiB0aGUgc2l4IHRvcC1sZXZlbCBtZW51IGl0ZW1zLiBXaGVuIG9uZSBvZiB0aGUgbWVudSBpdGVtcyBoYXMgZm9jdXMsIHByZXNzaW5nIHRoZSBFbnRlciBrZXksIFNwYWNlYmFyIG9yIERvd24gYXJyb3cgd2lsbCBvcGVuIHRoZSBzdWJtZW51IHBhbmVsLCBhbmQgcHJlc3NpbmcgdGhlIExlZnQgb3IgUmlnaHQgYXJyb3cga2V5IHdpbGwgc2hpZnQgZm9jdXMgdG8gdGhlIGFkamFjZW50IG1lbnUgaXRlbS4gTGlua3Mgd2l0aGluIHRoZSBzdWJtZW51IHBhbmVscyBhcmUgaW5jbHVkZWQgaW4gdGhlIHRhYiBvcmRlciB3aGVuIHRoZSBwYW5lbCBpcyBvcGVuLiBUaGV5IGNhbiBhbHNvIGJlIG5hdmlnYXRlZCB3aXRoIHRoZSBhcnJvdyBrZXlzIG9yIGJ5IHR5cGluZyB0aGUgZmlyc3QgY2hhcmFjdGVyIGluIHRoZSBsaW5rIG5hbWUsIHdoaWNoIHNwZWVkcyB1cCBrZXlib2FyZCBuYXZpZ2F0aW9uIGNvbnNpZGVyYWJseS4gUHJlc3NpbmcgdGhlIEVzY2FwZSBrZXkgY2xvc2VzIHRoZSBzdWJtZW51IGFuZCByZXN0b3JlcyBmb2N1cyB0byB0aGUgcGFyZW50IG1lbnUgaXRlbS48L3A+XG4gICAgICogPGgzPlNjcmVlbiBSZWFkZXIgQWNjZXNzaWJpbGl0eTwvaDM+XG4gICAgICogPHA+VGhlIGFjY2Vzc2libGUgbWVnYSBtZW51IG1vZGVscyBpdHMgdXNlIG9mIFdBSS1BUklBIFJvbGVzLCBTdGF0ZXMsIGFuZCBQcm9wZXJ0aWVzIGFmdGVyIHRob3NlIGRlc2NyaWJlZCBpbiB0aGUge0BsaW5rIGh0dHA6Ly93d3cudzMub3JnL1RSL3dhaS1hcmlhLXByYWN0aWNlcy8jbWVudXxXQUktQVJJQSBNZW51IG9yIE1lbnUgYmFyICh3aWRnZXQpIGRlc2lnbiBwYXR0ZXJufSB3aXRoIHNvbWUgbm90YWJsZSBleGNlcHRpb25zLCBzbyB0aGF0IGl0IGJlaGF2ZXMgYmV0dGVyIHdpdGggc2NyZWVuIHJlYWRlciB1c2VyIGV4cGVjdGF0aW9ucyBmb3IgZ2xvYmFsIG5hdmlnYXRpb24uIFdlIGRvbid0IHVzZSA8Y29kZSBjbGFzcz1cInByZXR0eXByaW50IHByZXR0eXByaW50ZWRcIiBzdHlsZT1cIlwiPjxzcGFuIGNsYXNzPVwicGxuXCI+cm9sZTwvc3Bhbj48c3BhbiBjbGFzcz1cInB1blwiPj08L3NwYW4+PHNwYW4gY2xhc3M9XCJzdHJcIj5cIm1lbnVcIjwvc3Bhbj48L2NvZGU+IGZvciB0aGUgbWVudSBjb250YWluZXIgYW5kIDxjb2RlIGNsYXNzPVwicHJldHR5cHJpbnQgcHJldHR5cHJpbnRlZFwiIHN0eWxlPVwiXCI+PHNwYW4gY2xhc3M9XCJwbG5cIj5yb2xlPC9zcGFuPjxzcGFuIGNsYXNzPVwicHVuXCI+PTwvc3Bhbj48c3BhbiBjbGFzcz1cInN0clwiPlwibWVudWl0ZW1cIjwvc3Bhbj48L2NvZGU+IGZvciBlYWNoIG9mIHRoZSBsaW5rcyB0aGVyZWluLCBiZWNhdXNlIGlmIHdlIGRvLCBhc3Npc3RpdmUgdGVjaG5vbG9neSB3aWxsIG5vIGxvbmdlciBpbnRlcnByZXQgdGhlIGxpbmtzIGFzIGxpbmtzLCBidXQgaW5zdGVhZCwgYXMgbWVudSBpdGVtcywgYW5kIHRoZSBsaW5rcyBpbiBvdXIgZ2xvYmFsIG5hdmlnYXRpb24gd2lsbCBubyBsb25nZXIgc2hvdyB1cCB3aGVuIGEgc2NyZWVuIHJlYWRlciB1c2VyIGV4ZWN1dGVzIGEgc2hvcnRjdXQgY29tbWFuZCB0byBicmluZyB1cCBhIGxpc3Qgb2YgbGlua3MgaW4gdGhlIHBhZ2UuPC9wPlxuICAgICAqIEBleGFtcGxlIDxoND5IVE1MPC9oND48aHIvPlxuJmx0O25hdiZndDtcbiAgICAmbHQ7dWwgY2xhc3M9JnF1b3Q7bmF2LW1lbnUmcXVvdDsmZ3Q7XG4gICAgICAgICZsdDtsaSBjbGFzcz0mcXVvdDtuYXYtaXRlbSZxdW90OyZndDtcbiAgICAgICAgICAgICZsdDthIGhyZWY9JnF1b3Q7P21vdmllJnF1b3Q7Jmd0O01vdmllcyZsdDsvYSZndDtcbiAgICAgICAgICAgICZsdDtkaXYgY2xhc3M9JnF1b3Q7c3ViLW5hdiZxdW90OyZndDtcbiAgICAgICAgICAgICAgICAmbHQ7dWwgY2xhc3M9JnF1b3Q7c3ViLW5hdi1ncm91cCZxdW90OyZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZsdDthIGhyZWY9JnF1b3Q7P21vdmllJmFtcDtnZW5yZT0wJnF1b3Q7Jmd0O0FjdGlvbiAmYW1wO2FtcDsgQWR2ZW50dXJlJmx0Oy9hJmd0OyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmbHQ7YSBocmVmPSZxdW90Oz9tb3ZpZSZhbXA7Z2VucmU9MiZxdW90OyZndDtDaGlsZHJlbiAmYW1wO2FtcDsgRmFtaWx5Jmx0Oy9hJmd0OyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmYW1wOyM4MjMwOyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgJmx0Oy91bCZndDtcbiAgICAgICAgICAgICAgICAmbHQ7dWwgY2xhc3M9JnF1b3Q7c3ViLW5hdi1ncm91cCZxdW90OyZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZsdDthIGhyZWY9JnF1b3Q7P21vdmllJmFtcDtnZW5yZT03JnF1b3Q7Jmd0O0RyYW1hcyZsdDsvYSZndDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7Jmx0O2EgaHJlZj0mcXVvdDs/bW92aWUmYW1wO2dlbnJlPTkmcXVvdDsmZ3Q7Rm9yZWlnbiZsdDsvYSZndDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7JmFtcDsjODIzMDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICZsdDsvdWwmZ3Q7XG4gICAgICAgICAgICAgICAgJmx0O3VsIGNsYXNzPSZxdW90O3N1Yi1uYXYtZ3JvdXAmcXVvdDsmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmbHQ7YSBocmVmPSZxdW90Oz9tb3ZpZSZhbXA7Z2VucmU9MTQmcXVvdDsmZ3Q7TXVzaWNhbHMmbHQ7L2EmZ3Q7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZsdDthIGhyZWY9JnF1b3Q7P21vdmllJmFtcDtnZW5yZT0xNSZxdW90OyZndDtSb21hbmNlJmx0Oy9hJmd0OyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmYW1wOyM4MjMwOyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgJmx0Oy91bCZndDtcbiAgICAgICAgICAgICZsdDsvZGl2Jmd0O1xuICAgICAgICAmbHQ7L2xpJmd0O1xuICAgICAgICAmbHQ7bGkgY2xhc3M9JnF1b3Q7bmF2LWl0ZW0mcXVvdDsmZ3Q7XG4gICAgICAgICAgICAmbHQ7YSBocmVmPSZxdW90Oz90diZxdW90OyZndDtUViBTaG93cyZsdDsvYSZndDtcbiAgICAgICAgICAgICZsdDtkaXYgY2xhc3M9JnF1b3Q7c3ViLW5hdiZxdW90OyZndDtcbiAgICAgICAgICAgICAgICAmbHQ7dWwgY2xhc3M9JnF1b3Q7c3ViLW5hdi1ncm91cCZxdW90OyZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZsdDthIGhyZWY9JnF1b3Q7P3R2JmFtcDtnZW5yZT0yMCZxdW90OyZndDtDbGFzc2ljIFRWJmx0Oy9hJmd0OyZsdDsvbGkmZ3Q7XG4gICAgICAgICAgICAgICAgICAgICZsdDtsaSZndDsmbHQ7YSBocmVmPSZxdW90Oz90diZhbXA7Z2VucmU9MjEmcXVvdDsmZ3Q7Q3JpbWUgVFYmbHQ7L2EmZ3Q7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZhbXA7IzgyMzA7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAmbHQ7L3VsJmd0O1xuICAgICAgICAgICAgICAgICZsdDt1bCBjbGFzcz0mcXVvdDtzdWItbmF2LWdyb3VwJnF1b3Q7Jmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7Jmx0O2EgaHJlZj0mcXVvdDs/dHYmYW1wO2dlbnJlPTI3JnF1b3Q7Jmd0O1JlYWxpdHkgVFYmbHQ7L2EmZ3Q7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZsdDthIGhyZWY9JnF1b3Q7P3R2JmFtcDtnZW5yZT0zMCZxdW90OyZndDtUViBBY3Rpb24mbHQ7L2EmZ3Q7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAgICAgJmx0O2xpJmd0OyZhbXA7IzgyMzA7Jmx0Oy9saSZndDtcbiAgICAgICAgICAgICAgICAmbHQ7L3VsJmd0O1xuICAgICAgICAgICAgICAgICZsdDt1bCBjbGFzcz0mcXVvdDtzdWItbmF2LWdyb3VwJnF1b3Q7Jmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7Jmx0O2EgaHJlZj0mcXVvdDs/dHYmYW1wO2dlbnJlPTMzJnF1b3Q7Jmd0O1RWIERyYW1hcyZsdDsvYSZndDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7Jmx0O2EgaHJlZj0mcXVvdDs/dHYmYW1wO2dlbnJlPTM0JnF1b3Q7Jmd0O1RWIEhvcnJvciZsdDsvYSZndDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICAgICAmbHQ7bGkmZ3Q7JmFtcDsjODIzMDsmbHQ7L2xpJmd0O1xuICAgICAgICAgICAgICAgICZsdDsvdWwmZ3Q7XG4gICAgICAgICAgICAmbHQ7L2RpdiZndDtcbiAgICAgICAgJmx0Oy9saSZndDtcbiAgICAmbHQ7L3VsJmd0O1xuJmx0Oy9uYXYmZ3Q7XG4gICAgICogQGV4YW1wbGUgPGg0PkNTUzwvaDQ+PGhyLz5cbiYjNDc7KiBSdWRpbWVudGFyeSBtZWdhIG1lbnUgQ1NTIGZvciBkZW1vbnN0cmF0aW9uIComIzQ3O1xuXG4mIzQ3OyogbWVnYSBtZW51IGxpc3QgKiYjNDc7XG4ubmF2LW1lbnUge1xuICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICBsaXN0LXN0eWxlOiBub25lO1xuICAgIG1hcmdpbjogMDtcbiAgICBwYWRkaW5nOiAwO1xuICAgIHotaW5kZXg6IDE1O1xufVxuXG4mIzQ3OyogYSB0b3AgbGV2ZWwgbmF2aWdhdGlvbiBpdGVtIGluIHRoZSBtZWdhIG1lbnUgKiYjNDc7XG4ubmF2LWl0ZW0ge1xuICAgIGxpc3Qtc3R5bGU6IG5vbmU7XG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgIHBhZGRpbmc6IDA7XG4gICAgbWFyZ2luOiAwO1xufVxuXG4mIzQ3OyogZmlyc3QgZGVzY2VuZGFudCBsaW5rIHdpdGhpbiBhIHRvcCBsZXZlbCBuYXZpZ2F0aW9uIGl0ZW0gKiYjNDc7XG4ubmF2LWl0ZW0gJmd0OyBhIHtcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgIHBhZGRpbmc6IDAuNWVtIDFlbTtcbiAgICBtYXJnaW46IDAgMCAtMXB4IDA7XG4gICAgYm9yZGVyOiAxcHggc29saWQgdHJhbnNwYXJlbnQ7XG59XG5cbiYjNDc7KiBmb2N1cy9vcGVuIHN0YXRlcyBvZiBmaXJzdCBkZXNjZW5kYW50IGxpbmsgd2l0aGluIGEgdG9wIGxldmVsXG4gICBuYXZpZ2F0aW9uIGl0ZW0gKiYjNDc7XG4ubmF2LWl0ZW0gJmd0OyBhOmZvY3VzLFxuLm5hdi1pdGVtICZndDsgYS5vcGVuIHtcbiAgICBib3JkZXI6IDFweCBzb2xpZCAjZGVkZWRlO1xufVxuXG4mIzQ3Oyogb3BlbiBzdGF0ZSBvZiBmaXJzdCBkZXNjZW5kYW50IGxpbmsgd2l0aGluIGEgdG9wIGxldmVsXG4gICBuYXZpZ2F0aW9uIGl0ZW0gKiYjNDc7XG4ubmF2LWl0ZW0gJmd0OyBhLm9wZW4ge1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7XG4gICAgYm9yZGVyLWJvdHRvbTogbm9uZTtcbiAgICB6LWluZGV4OiAxO1xufVxuXG4mIzQ3Oyogc3ViLW5hdmlnYXRpb24gcGFuZWwgKiYjNDc7XG4uc3ViLW5hdiB7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIGRpc3BsYXk6IG5vbmU7XG4gICAgdG9wOiAyLjJlbTtcbiAgICBtYXJnaW4tdG9wOiAtMXB4O1xuICAgIHBhZGRpbmc6IDAuNWVtIDFlbTtcbiAgICBib3JkZXI6IDFweCBzb2xpZCAjZGVkZWRlO1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7XG59XG5cbiYjNDc7KiBzdWItbmF2aWdhdGlvbiBwYW5lbCBvcGVuIHN0YXRlIComIzQ3O1xuLnN1Yi1uYXYub3BlbiB7XG4gICAgZGlzcGxheTogYmxvY2s7XG59XG5cbiYjNDc7KiBsaXN0IG9mIGl0ZW1zIHdpdGhpbiBzdWItbmF2aWdhdGlvbiBwYW5lbCAqJiM0Nztcbi5zdWItbmF2IHVsIHtcbiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgdmVydGljYWwtYWxpZ246IHRvcDtcbiAgICBtYXJnaW46IDAgMWVtIDAgMDtcbiAgICBwYWRkaW5nOiAwO1xufVxuXG4mIzQ3OyogbGlzdCBpdGVtIHdpdGhpbiBzdWItbmF2aWdhdGlvbiBwYW5lbCAqJiM0Nztcbi5zdWItbmF2IGxpIHtcbiAgICBkaXNwbGF5OiBibG9jaztcbiAgICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7XG4gICAgbWFyZ2luOiAwO1xuICAgIHBhZGRpbmc6IDA7XG59XG4gICAgICogQGV4YW1wbGUgPGg0PkphdmFTY3JpcHQ8L2g0Pjxoci8+XG4mbHQ7IS0tIGluY2x1ZGUganF1ZXJ5IC0tJmd0O1xuJmx0O3NjcmlwdCBzcmM9JnF1b3Q7aHR0cDovL2NvZGUuanF1ZXJ5LmNvbS9qcXVlcnktMS4xMC4xLm1pbi5qcyZxdW90OyZndDsmbHQ7L3NjcmlwdCZndDtcblxuJmx0OyEtLSBpbmNsdWRlIHRoZSBqcXVlcnktYWNjZXNzaWJsZU1lZ2FNZW51IHBsdWdpbiBzY3JpcHQgLS0mZ3Q7XG4mbHQ7c2NyaXB0IHNyYz0mcXVvdDtqcy9qcXVlcnktYWNjZXNzaWJsZU1lZ2FNZW51LmpzJnF1b3Q7Jmd0OyZsdDsvc2NyaXB0Jmd0O1xuXG4mbHQ7IS0tIGluaXRpYWxpemUgYSBzZWxlY3RvciBhcyBhbiBhY2Nlc3NpYmxlTWVnYU1lbnUgLS0mZ3Q7XG4mbHQ7c2NyaXB0Jmd0O1xuICAgICQoJnF1b3Q7bmF2OmZpcnN0JnF1b3Q7KS5hY2Nlc3NpYmxlTWVnYU1lbnUoe1xuICAgICAgICAmIzQ3OyogcHJlZml4IGZvciBnZW5lcmF0ZWQgdW5pcXVlIGlkIGF0dHJpYnV0ZXMsIHdoaWNoIGFyZSByZXF1aXJlZCB0byBpbmRpY2F0ZSBhcmlhLW93bnMsIGFyaWEtY29udHJvbHMgYW5kIGFyaWEtbGFiZWxsZWRieSAqJiM0NztcbiAgICAgICAgdXVpZFByZWZpeDogJnF1b3Q7YWNjZXNzaWJsZS1tZWdhbWVudSZxdW90OyxcblxuICAgICAgICAmIzQ3OyogY3NzIGNsYXNzIHVzZWQgdG8gZGVmaW5lIHRoZSBtZWdhbWVudSBzdHlsaW5nIComIzQ3O1xuICAgICAgICBtZW51Q2xhc3M6ICZxdW90O25hdi1tZW51JnF1b3Q7LFxuXG4gICAgICAgICYjNDc7KiBjc3MgY2xhc3MgZm9yIGEgdG9wLWxldmVsIG5hdmlnYXRpb24gaXRlbSBpbiB0aGUgbWVnYW1lbnUgKiYjNDc7XG4gICAgICAgIHRvcE5hdkl0ZW1DbGFzczogJnF1b3Q7bmF2LWl0ZW0mcXVvdDssXG5cbiAgICAgICAgJiM0NzsqIGNzcyBjbGFzcyBmb3IgYSBtZWdhbWVudSBwYW5lbCAqJiM0NztcbiAgICAgICAgcGFuZWxDbGFzczogJnF1b3Q7c3ViLW5hdiZxdW90OyxcblxuICAgICAgICAmIzQ3OyogY3NzIGNsYXNzIGZvciBhIGdyb3VwIG9mIGl0ZW1zIHdpdGhpbiBhIG1lZ2FtZW51IHBhbmVsIComIzQ3O1xuICAgICAgICBwYW5lbEdyb3VwQ2xhc3M6ICZxdW90O3N1Yi1uYXYtZ3JvdXAmcXVvdDssXG5cbiAgICAgICAgJiM0NzsqIGNzcyBjbGFzcyBmb3IgdGhlIGhvdmVyIHN0YXRlIComIzQ3O1xuICAgICAgICBob3ZlckNsYXNzOiAmcXVvdDtob3ZlciZxdW90OyxcblxuICAgICAgICAmIzQ3OyogY3NzIGNsYXNzIGZvciB0aGUgZm9jdXMgc3RhdGUgKiYjNDc7XG4gICAgICAgIGZvY3VzQ2xhc3M6ICZxdW90O2ZvY3VzJnF1b3Q7LFxuXG4gICAgICAgICYjNDc7KiBjc3MgY2xhc3MgZm9yIHRoZSBvcGVuIHN0YXRlIComIzQ3O1xuICAgICAgICBvcGVuQ2xhc3M6ICZxdW90O29wZW4mcXVvdDtcbiAgICB9KTtcbiZsdDsvc2NyaXB0Jmd0O1xuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gTWVnYSBNZW51IG9wdGlvbnNcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMudXVpZFByZWZpeD1hY2Nlc3NpYmxlLW1lZ2FtZW51XSAtIFByZWZpeCBmb3IgZ2VuZXJhdGVkIHVuaXF1ZSBpZCBhdHRyaWJ1dGVzLCB3aGljaCBhcmUgcmVxdWlyZWQgdG8gaW5kaWNhdGUgYXJpYS1vd25zLCBhcmlhLWNvbnRyb2xzIGFuZCBhcmlhLWxhYmVsbGVkYnlcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMubWVudUNsYXNzPWFjY2Vzc2libGUtbWVnYW1lbnVdIC0gQ1NTIGNsYXNzIHVzZWQgdG8gZGVmaW5lIHRoZSBtZWdhbWVudSBzdHlsaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnRvcE5hdkl0ZW1DbGFzcz1hY2Nlc3NpYmxlLW1lZ2FtZW51LXRvcC1uYXYtaXRlbV0gLSBDU1MgY2xhc3MgZm9yIGEgdG9wLWxldmVsIG5hdmlnYXRpb24gaXRlbSBpbiB0aGUgbWVnYW1lbnVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMucGFuZWxDbGFzcz1hY2Nlc3NpYmxlLW1lZ2FtZW51LXBhbmVsXSAtIENTUyBjbGFzcyBmb3IgYSBtZWdhbWVudSBwYW5lbFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5wYW5lbEdyb3VwQ2xhc3M9YWNjZXNzaWJsZS1tZWdhbWVudS1wYW5lbC1ncm91cF0gLSBDU1MgY2xhc3MgZm9yIGEgZ3JvdXAgb2YgaXRlbXMgd2l0aGluIGEgbWVnYW1lbnUgcGFuZWxcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuaG92ZXJDbGFzcz1ob3Zlcl0gLSBDU1MgY2xhc3MgZm9yIHRoZSBob3ZlciBzdGF0ZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5mb2N1c0NsYXNzPWZvY3VzXSAtIENTUyBjbGFzcyBmb3IgdGhlIGZvY3VzIHN0YXRlXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLm9wZW5DbGFzcz1vcGVuXSAtIENTUyBjbGFzcyBmb3IgdGhlIG9wZW4gc3RhdGVcbiAgICAgKi9cbiAgICAkLmZuW3BsdWdpbk5hbWVdID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoISQuZGF0YSh0aGlzLCBcInBsdWdpbl9cIiArIHBsdWdpbk5hbWUpKSB7XG4gICAgICAgICAgICAgICAgJC5kYXRhKHRoaXMsIFwicGx1Z2luX1wiICsgcGx1Z2luTmFtZSwgbmV3ICQuZm5bcGx1Z2luTmFtZV0uQWNjZXNzaWJsZU1lZ2FNZW51KHRoaXMsIG9wdGlvbnMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICQuZm5bcGx1Z2luTmFtZV0uQWNjZXNzaWJsZU1lZ2FNZW51ID0gQWNjZXNzaWJsZU1lZ2FNZW51O1xuXG4gICAgLyogOmZvY3VzYWJsZSBhbmQgOnRhYmJhYmxlIHNlbGVjdG9ycyBmcm9tXG4gICAgICAgaHR0cHM6Ly9yYXcuZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LXVpL21hc3Rlci91aS9qcXVlcnkudWkuY29yZS5qcyAqL1xuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB2aXNpYmxlKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuICQuZXhwci5maWx0ZXJzLnZpc2libGUoZWxlbWVudCkgJiYgISQoZWxlbWVudCkucGFyZW50cygpLmFkZEJhY2soKS5maWx0ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICQuY3NzKHRoaXMsIFwidmlzaWJpbGl0eVwiKSA9PT0gXCJoaWRkZW5cIjtcbiAgICAgICAgfSkubGVuZ3RoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gZm9jdXNhYmxlKGVsZW1lbnQsIGlzVGFiSW5kZXhOb3ROYU4pIHtcbiAgICAgICAgdmFyIG1hcCwgbWFwTmFtZSwgaW1nLFxuICAgICAgICAgICAgbm9kZU5hbWUgPSBlbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGlmIChcImFyZWFcIiA9PT0gbm9kZU5hbWUpIHtcbiAgICAgICAgICAgIG1hcCA9IGVsZW1lbnQucGFyZW50Tm9kZTtcbiAgICAgICAgICAgIG1hcE5hbWUgPSBtYXAubmFtZTtcbiAgICAgICAgICAgIGlmICghZWxlbWVudC5ocmVmIHx8ICFtYXBOYW1lIHx8IG1hcC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBcIm1hcFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW1nID0gJChcImltZ1t1c2VtYXA9I1wiICsgbWFwTmFtZSArIFwiXVwiKVswXTtcbiAgICAgICAgICAgIHJldHVybiAhIWltZyAmJiB2aXNpYmxlKGltZyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICgvaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QvLnRlc3Qobm9kZU5hbWUpID8gIWVsZW1lbnQuZGlzYWJsZWQgOlxuICAgICAgICAgICAgICAgIFwiYVwiID09PSBub2RlTmFtZSA/XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmhyZWYgfHwgaXNUYWJJbmRleE5vdE5hTiA6XG4gICAgICAgICAgICAgICAgICAgICAgICBpc1RhYkluZGV4Tm90TmFOKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBlbGVtZW50IGFuZCBhbGwgb2YgaXRzIGFuY2VzdG9ycyBtdXN0IGJlIHZpc2libGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlKGVsZW1lbnQpO1xuICAgIH1cblxuICAgICQuZXh0ZW5kKCQuZXhwcltcIjpcIl0sIHtcbiAgICAgICAgZGF0YTogJC5leHByLmNyZWF0ZVBzZXVkbyA/ICQuZXhwci5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24gKGRhdGFOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gISEkLmRhdGEoZWxlbSwgZGF0YU5hbWUpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkgOiAvLyBzdXBwb3J0OiBqUXVlcnkgPDEuOFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlbGVtLCBpLCBtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gISEkLmRhdGEoZWxlbSwgbWF0Y2hbM10pO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgZm9jdXNhYmxlOiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGZvY3VzYWJsZShlbGVtZW50LCAhaXNOYU4oJC5hdHRyKGVsZW1lbnQsIFwidGFiaW5kZXhcIikpKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0YWJiYWJsZTogZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciB0YWJJbmRleCA9ICQuYXR0cihlbGVtZW50LCBcInRhYmluZGV4XCIpLFxuICAgICAgICAgICAgICAgIGlzVGFiSW5kZXhOYU4gPSBpc05hTih0YWJJbmRleCk7XG4gICAgICAgICAgICByZXR1cm4gKGlzVGFiSW5kZXhOYU4gfHwgdGFiSW5kZXggPj0gMCkgJiYgZm9jdXNhYmxlKGVsZW1lbnQsICFpc1RhYkluZGV4TmFOKTtcbiAgICAgICAgfVxuICAgIH0pO1xufShqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQpKTtcbiJdfQ==
